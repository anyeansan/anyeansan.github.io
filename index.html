<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/anyeansan.github.io/images/an-apple-180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/anyeansan.github.io/images/an-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/anyeansan.github.io/images/an-16.png">
  <link rel="mask-icon" href="/anyeansan.github.io/images/an.svg" color="#222">
  <link rel="alternate" href="/anyeansan.github.io/atom.xml" title="安₃" type="application/atom+xml">

<link rel="stylesheet" href="/anyeansan.github.io/css/main.css">


<link rel="stylesheet" href="/anyeansan.github.io/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/anyeansan.github.io/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="一蓑烟雨任平生">
<meta property="og:type" content="website">
<meta property="og:title" content="安₃">
<meta property="og:url" content="https:&#x2F;&#x2F;anyeansan.github.io&#x2F;">
<meta property="og:site_name" content="安₃">
<meta property="og:description" content="一蓑烟雨任平生">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://anyeansan.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>安₃</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/anyeansan.github.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">安₃</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">我未成名君未嫁 可能俱是不如人</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/anyeansan.github.io/" rel="section"><i class="fa fa-fw fa-home"></i>安府</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/anyeansan.github.io/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>琅嬛福地</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/anyeansan.github.io/categories/" rel="section"><i class="fa fa-fw fa-th"></i>门派</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/anyeansan" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E5%A4%87%E4%BB%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E5%A4%87%E4%BB%BD/" class="post-title-link" itemprop="url">Mysql备份</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:49 / 修改时间：21:15:48" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:49+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-备份策略"><a href="#一-备份策略" class="headerlink" title="一 备份策略"></a>一 备份策略</h1><h2 id="1-1备份策略"><a href="#1-1备份策略" class="headerlink" title="1.1备份策略"></a>1.1备份策略</h2><ol>
<li>全量备份<ul>
<li>完整备份所有数据</li>
</ul>
</li>
<li>增量备份<ul>
<li>做一次完全备份，以后每次只备份新增的数据</li>
</ul>
</li>
<li>差异备份<ul>
<li>做一次完全备份，以后每次只备份和第一次完全备份不同的数据</li>
</ul>
</li>
</ol>
<h2 id="1-2-备份周期"><a href="#1-2-备份周期" class="headerlink" title="1.2 备份周期"></a>1.2 备份周期</h2><ol>
<li>根据数据量</li>
<li>自动</li>
</ol>
<h2 id="1-3-备份类型"><a href="#1-3-备份类型" class="headerlink" title="1.3 备份类型"></a>1.3 备份类型</h2><ol>
<li>热备<ul>
<li>在数据库正常业务时,备份数据,并且能够一致性恢复（只能是innodb）</li>
</ul>
</li>
<li>温备<ul>
<li>锁表备份,只能查询不能修改（myisam）</li>
</ul>
</li>
<li>冷备<ul>
<li>关闭数据库业务,数据库没有任何变更的情况下,进行备份数据.</li>
</ul>
</li>
</ol>
<h2 id="1-4-备份工具"><a href="#1-4-备份工具" class="headerlink" title="1.4 备份工具"></a>1.4 备份工具</h2><ol>
<li><code>mysqldump</code></li>
<li><code>Xtrabackup</code><ul>
<li>percona 数据库默认</li>
</ul>
</li>
<li><code>mysqlbinlog</code></li>
</ol>
<h2 id="1-5-备份方式"><a href="#1-5-备份方式" class="headerlink" title="1.5 备份方式"></a>1.5 备份方式</h2><ol>
<li>逻辑（基于 SQL 语句备份）<ol>
<li>全备：<code>mysqldump</code></li>
<li>增量：<code>mysqlbinlog</code></li>
</ol>
</li>
<li>物理（基于磁盘数据文件备份）<ol>
<li>全备：<code>Xtrabackup</code></li>
<li>增量：<code>Xtrabackup</code></li>
</ol>
</li>
</ol>
<h1 id="二-mysqldump"><a href="#二-mysqldump" class="headerlink" title="二 mysqldump"></a>二 mysqldump</h1><h2 id="2-1-连接数据库"><a href="#2-1-连接数据库" class="headerlink" title="2.1 连接数据库"></a>2.1 连接数据库</h2><ul>
<li><code>mysqldupm OPTION</code><ul>
<li><code>OPTION</code><ul>
<li><code>-u</code></li>
<li><code>-p</code></li>
<li><code>-S</code></li>
<li><code>-h</code></li>
<li><code>-P</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-2-基础参数"><a href="#2-2-基础参数" class="headerlink" title="2.2 基础参数"></a>2.2 基础参数</h2><ol>
<li><code>-A</code><ul>
<li>全备</li>
</ul>
</li>
<li><code>-B db1 db2 ...</code><ul>
<li>备份多个数据库</li>
</ul>
</li>
<li><code>db t1 t2 ...</code><ul>
<li>备份指定数据的表</li>
</ul>
</li>
</ol>
<h2 id="2-3-特殊参数"><a href="#2-3-特殊参数" class="headerlink" title="2.3 特殊参数"></a>2.3 特殊参数</h2><ol>
<li><code>-R</code><ul>
<li>备份备份存储过程及函数</li>
</ul>
</li>
<li><code>-E</code><ul>
<li>备份事件</li>
</ul>
</li>
<li><code>--triggers</code><ul>
<li>备份触发器</li>
</ul>
</li>
<li><code>-F</code><ul>
<li>在备份开始时,刷新一个新 binlog 日志</li>
</ul>
</li>
<li><code>--master-data=2</code><ul>
<li>以注释的形式，保存备份开始时间点的 binlog 的状态信息</li>
</ul>
</li>
<li><code>--single-transaction</code><ol>
<li>不加 ，温备份，所有表都锁定</li>
<li>加上，对 innodb 表进行快照备份（不锁表），对非 innodb 表可以实现自动锁表功能</li>
</ol>
</li>
<li><code>--set-gtid-purged=auto/on/off</code></li>
<li><code>--max-allowed-packet=#</code></li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E6%97%A5%E5%BF%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E6%97%A5%E5%BF%97/" class="post-title-link" itemprop="url">Mysql日志</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:44 / 修改时间：21:16:15" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:44+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-日志分类"><a href="#一-日志分类" class="headerlink" title="一 日志分类"></a>一 日志分类</h1><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Error log</code></td>
<td>错误日志</td>
</tr>
<tr>
<td><code>Binary log</code></td>
<td>二进制日志</td>
</tr>
<tr>
<td><code>Slow query log</code></td>
<td>慢查询日志</td>
</tr>
<tr>
<td><code>General query log</code></td>
<td>常规日志</td>
</tr>
</tbody></table>
<h1 id="二-错误日志"><a href="#二-错误日志" class="headerlink" title="二 错误日志"></a>二 错误日志</h1><ol>
<li>默认开启</li>
<li>默认存储位置 <code>datadir/hostname.err</code></li>
<li><code>select @@log_error</code><ul>
<li>查看错误日志位置</li>
</ul>
</li>
<li>手动配置 <code>/etc/my.cnf</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log_error=路径</span><br></pre></td></tr></table></figure>

<h1 id="三-二进制日志"><a href="#三-二进制日志" class="headerlink" title="三 二进制日志"></a>三 二进制日志</h1><h2 id="3-1-作用"><a href="#3-1-作用" class="headerlink" title="3.1 作用"></a>3.1 作用</h2><ol>
<li>主从环境必须依赖二进制日志</li>
<li>备份恢复必须依赖二进制日志</li>
</ol>
<h2 id="3-2-配置"><a href="#3-2-配置" class="headerlink" title="3.2 配置"></a>3.2 配置</h2><ol>
<li>默认没有开启</li>
<li>手动配置 <code>/etc/my.cnf</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">1 server_id= </span><br><span class="line">	# 服务ID号 0 ~ 65535</span><br><span class="line">2 log_bin=1</span><br><span class="line">	# 开启二进制日志</span><br><span class="line">3 log_bin_basename=/目录/二进制日志文件名前缀</span><br><span class="line">	# 设置存储目录及文件前缀</span><br><span class="line">4 log_bin=/目录/二进制日志文件名前缀</span><br><span class="line">	# 等同于 2,3两步</span><br><span class="line">5 binlog_format=row</span><br><span class="line">	# 二进制日志格式，5.7 默认配置，可以省略</span><br><span class="line">6 sync_binlog=1</span><br><span class="line">	# 每次提交都立即刷写binlog到磁盘</span><br></pre></td></tr></table></figure>

<h2 id="3-3-二进制日志记录内容"><a href="#3-3-二进制日志记录内容" class="headerlink" title="3.3 二进制日志记录内容"></a>3.3 二进制日志记录内容</h2><h3 id="1-内容"><a href="#1-内容" class="headerlink" title="1 内容"></a>1 内容</h3><ul>
<li>记录了数据库所有变更类的操作日志<ol>
<li>DDL：原封不动的记录当前 DDL（statement 语句方式），即原样记录语句</li>
<li>DCL：原封不动的记录当前 DCL（statement 语句方式）</li>
<li>DML：只记录已经提交的事务 DML</li>
</ol>
</li>
</ul>
<h3 id="2-DML-记录模式"><a href="#2-DML-记录模式" class="headerlink" title="2 DML 记录模式"></a>2 DML 记录模式</h3><ol>
<li><code>statment</code><ul>
<li>SBR（statement based replication）模式</li>
<li>语句模式，原封不动的记录当前DML</li>
<li>可读性较高，日志量少，但是不够严谨</li>
</ul>
</li>
<li><code>row</code><ul>
<li>RBR（ROW based replication）模式</li>
<li>记录数据行的变化（用户看不懂，需要工具分析）</li>
<li>可读性很低，日志量大，足够严谨</li>
</ul>
</li>
<li><code>mixed</code><ul>
<li>MBR（mixed based replication）模式 </li>
<li>以上两种模式的混合</li>
</ul>
</li>
</ol>
<h2 id="3-4-二进制日记记录单元-event"><a href="#3-4-二进制日记记录单元-event" class="headerlink" title="3.4 二进制日记记录单元 event"></a>3.4 二进制日记记录单元 event</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>event 是二进制日志的最小记录单元</li>
<li>DDL DCL<ul>
<li>一个语句就是一个 event</li>
</ul>
</li>
<li>DML ：只记录已提交的事务<ol>
<li>begin 是一个 event</li>
<li>DML 语句的 event</li>
<li>commit 是一个 event</li>
</ol>
</li>
</ol>
<h3 id="2-event-组成"><a href="#2-event-组成" class="headerlink" title="2 event 组成"></a>2 event 组成</h3><ol>
<li>事件的开始标识：<code>position</code> 号</li>
<li>事件内容</li>
<li>事件的结束标识：<code>end_log_position</code> 号</li>
</ol>
<h2 id="3-5-二进制日志-操作"><a href="#3-5-二进制日志-操作" class="headerlink" title="3.5 二进制日志 操作"></a>3.5 二进制日志 操作</h2><h3 id="1-查看信息"><a href="#1-查看信息" class="headerlink" title="1 查看信息"></a>1 查看信息</h3><ol>
<li><code>show variables like &#39;%log_bin%&#39;</code><ul>
<li>查看二进制日志路径</li>
</ul>
</li>
<li><code>show binary logs</code><ul>
<li>查看所有二进制日志</li>
</ul>
</li>
<li><code>show master status</code><ul>
<li>查看当前使用的二进制日志</li>
</ul>
</li>
<li><code>show binlog events in &#39;log_name&#39; [from pos] [limit]</code><ul>
<li>查看二进制日志 event 信息</li>
</ul>
</li>
</ol>
<h3 id="2-查看内容-mysqlbinlog"><a href="#2-查看内容-mysqlbinlog" class="headerlink" title="2 查看内容 mysqlbinlog"></a>2 查看内容 mysqlbinlog</h3><ul>
<li><code>mysqlbinlog [OPTION] 日志路径</code><ul>
<li><code>--base64-output=decode-rows</code><ul>
<li>以指定格式输出</li>
</ul>
</li>
<li><code>-vvv</code><ul>
<li>更详细</li>
</ul>
</li>
<li><code>--start-position</code><ul>
<li>开始位置</li>
</ul>
</li>
<li><code>--stop-position</code><ul>
<li>结束位置</li>
</ul>
</li>
<li><code>-d db_name</code><ul>
<li>只查看指定库的日志</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-恢复"><a href="#3-恢复" class="headerlink" title="3 恢复"></a>3 恢复</h3><ol>
<li><code>mysqlbinlog --start-position= --stop--position= &gt;/tmp/log.sql</code><ul>
<li>将指定位置的二进制日志内容截取出来输出到一个文件，其实就是sql脚本，执行即可</li>
</ul>
</li>
<li><code>set sql_log_bin=0</code><ul>
<li>临时关闭二进制日志，因为恢复时也会产生二进制日志，没有必要</li>
</ul>
</li>
<li><code>source /tmp/log.sql</code></li>
<li><code>set sql_log_bin=1</code></li>
</ol>
<h2 id="3-6-GTID-模式管理二进制日志"><a href="#3-6-GTID-模式管理二进制日志" class="headerlink" title="3.6 GTID 模式管理二进制日志"></a>3.6 GTID 模式管理二进制日志</h2><h3 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>GTID <code>Global Transaction ID</code></li>
<li>对二进制日志中每一个事务，自动生成一个 GTID 号<ol>
<li>DDL DCL<ul>
<li>一个 event 就是一个事务，就有一个 GTID</li>
</ul>
</li>
<li>DML<ul>
<li>一个事务（从 begin 到 commit）一个 GTID</li>
</ul>
</li>
</ol>
</li>
<li>GTID 幂等性<ul>
<li>使用有 GTID 的二进制日志做恢复时，会检查当前系统是否有相同的 GTID，若有则跳过不再执行。</li>
<li>会影响恢复和主从复制</li>
</ul>
</li>
</ol>
<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2 配置"></a>2 配置</h3><ol>
<li>默认未开启</li>
<li><code>/etc/my.cnf</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">gtid-mode=on</span><br><span class="line">enforce-gtid-consistency=true</span><br></pre></td></tr></table></figure>

<h3 id="3-GTID-组成"><a href="#3-GTID-组成" class="headerlink" title="3 GTID 组成"></a>3 GTID 组成</h3><ul>
<li><code>server_uuid:transaction_id</code><ul>
<li><code>server_uuid</code><ul>
<li>启动 mysql 自动生成，存储在 <code>datadir/auto.cnf</code></li>
</ul>
</li>
<li><code>transaction_id</code><ul>
<li>从 1 开始，自增长</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-查看有-GTID-的日志内容"><a href="#4-查看有-GTID-的日志内容" class="headerlink" title="4 查看有 GTID 的日志内容"></a>4 查看有 GTID 的日志内容</h3><ul>
<li><code>mysqlbinlog [OPTION] 日志路径</code><ul>
<li><code>OPTION</code><ul>
<li><code>--incude-gtids</code><ul>
<li>包含指定 gtid，多个逗号隔开，连续可以 <code>server_uuid:1-8</code></li>
</ul>
</li>
<li><code>--exclude-gtids</code><ul>
<li>排除指定 gtid</li>
</ul>
</li>
<li><code>--skip-gtids</code><ul>
<li>由于 gtid 的幂等性，导出的 sql 执行时会报错，因为已经存在相同 gtid</li>
<li>此选项表示：导出时，忽略原有的 GTID 信息，恢复时当作新事务对待</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-基于-GTID-的恢复"><a href="#5-基于-GTID-的恢复" class="headerlink" title="5  基于 GTID 的恢复"></a>5  基于 GTID 的恢复</h3><ol>
<li><code>mysqlbinlog --skip-gtids --include-gtids= 日志路径&gt;/tmp/log.sql</code></li>
<li><code>set sql_log_bin=0</code></li>
<li><code>source /tmp/log.sql</code></li>
<li><code>set sql_log_bin=1</code></li>
</ol>
<h2 id="3-7-二进制日志清理"><a href="#3-7-二进制日志清理" class="headerlink" title="3.7 二进制日志清理"></a>3.7 二进制日志清理</h2><h3 id="1-自动清理"><a href="#1-自动清理" class="headerlink" title="1 自动清理"></a>1 自动清理</h3><ul>
<li><code>expire_logs_days</code><ul>
<li>二进制日志过期天数，<code>0</code> 表示永不过期</li>
<li>建议至少保留两个全备周期 +1</li>
</ul>
</li>
</ul>
<h3 id="2-手动清理"><a href="#2-手动清理" class="headerlink" title="2 手动清理"></a>2 手动清理</h3><ol>
<li><code>purge binary logs to &#39;log_name&#39;</code><ul>
<li>删除指定日志之前的日志</li>
</ul>
</li>
<li><code>purge binary logs before &#39;time&#39;</code><ul>
<li>删除指定日期之前的日志</li>
</ul>
</li>
</ol>
<h2 id="3-8-日志滚动"><a href="#3-8-日志滚动" class="headerlink" title="3.8 日志滚动"></a>3.8 日志滚动</h2><ol>
<li><code>flush logs</code></li>
<li>重启 mysql 会自动滚动一个新的</li>
<li>日志文件达到 <code>max_binlog_size</code></li>
</ol>
<h1 id="四-慢查询日志"><a href="#四-慢查询日志" class="headerlink" title="四 慢查询日志"></a>四 慢查询日志</h1><h2 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h2><ul>
<li>记录运行较慢的 SQL语句，优化常用</li>
</ul>
<h2 id="4-2-配置"><a href="#4-2-配置" class="headerlink" title="4.2 配置"></a>4.2 配置</h2><ol>
<li>默认未开启</li>
<li><code>/etc/my.cnf</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">1 slow_query_log=1 </span><br><span class="line">	# 开启 </span><br><span class="line">2 slow_query_log_file=/目录/文件</span><br><span class="line">	# 日志文件路径</span><br><span class="line">3 long_query_time=0.1</span><br><span class="line">	# 设置慢查询时间，超过此时间就算慢，默认 10.000000 10秒，小数位表示粒度</span><br><span class="line">4 log_queries_not_using_indexes</span><br><span class="line">	# 没走索引的语句也记录</span><br></pre></td></tr></table></figure>

<h2 id="4-3-分析"><a href="#4-3-分析" class="headerlink" title="4.3 分析"></a>4.3 分析</h2><ul>
<li><code>mysqldumpslow -s c -t N 日志路径</code><ul>
<li><code>-s c</code><ul>
<li>sort，按次数排序</li>
</ul>
</li>
<li><code>-t N</code><ul>
<li>top，取前多少个</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4-4-相关参数"><a href="#4-4-相关参数" class="headerlink" title="4.4 相关参数"></a>4.4 相关参数</h2><ol>
<li><code>slow_query_log</code></li>
<li><code>long_query_time</code></li>
<li><code>log_throttle_queries_not_using_indexes</code></li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%A7%A6%E5%8F%91%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%A7%A6%E5%8F%91%E5%99%A8/" class="post-title-link" itemprop="url">Mysql触发器</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:39 / 修改时间：21:15:53" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:39+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><ol>
<li>事先为某张表绑定好一段代码 ,当表中的某些内容发生改变的时候（增删改）系统会自动触发代码执行</li>
<li>事件类型<ul>
<li>增 <code>insert</code></li>
<li>删 <code>delete</code></li>
<li>改 <code>update</code></li>
</ul>
</li>
<li>触发时间<ul>
<li>前 <code>before</code></li>
<li>后 <code>after</code></li>
</ul>
</li>
<li>一张表最多能有 6 种触发器（事件类型 + 触发事件）<ol>
<li><code>增 前/后</code></li>
<li><code>删 前/后</code></li>
<li><code>改 前/后</code></li>
</ol>
</li>
<li>触发对象<ul>
<li>表中的每一条记录（行）</li>
</ul>
</li>
<li><code>new/old</code><ul>
<li>可以用来获取新添加的或者删除的记录</li>
</ul>
</li>
</ol>
<h1 id="二-创建触发器"><a href="#二-创建触发器" class="headerlink" title="二 创建触发器"></a>二 创建触发器</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- 1 临时修改语句结束符</span><br><span class="line">Delimiter 自定义符号</span><br><span class="line">-- 2 </span><br><span class="line">Create trigger 触发器名字 触发时间 事件类型 on 表名 for each row</span><br><span class="line">-- 3 </span><br><span class="line">Begin		</span><br><span class="line">	触发器的内容</span><br><span class="line">End	</span><br><span class="line">-- 4 语句结束符</span><br><span class="line">自定义符号</span><br><span class="line">-- 5 将临时修改修正过来</span><br><span class="line">Delimiter ;</span><br></pre></td></tr></table></figure>

<h1 id="三-触发器管理"><a href="#三-触发器管理" class="headerlink" title="三 触发器管理"></a>三 触发器管理</h1><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show triggers</code></td>
<td>查看所有触发器</td>
</tr>
<tr>
<td><code>show create trigger 触发器名</code></td>
<td>查看触发器创建语句</td>
</tr>
<tr>
<td><code>drop trigger 触发器名</code></td>
<td>删除触发器</td>
</tr>
</tbody></table>
<ul>
<li><code>Information_schema.triggers</code><ul>
<li>所有的触发器信息都保存此表中</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" class="post-title-link" itemprop="url">Mysql存储过程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:34 / 修改时间：21:15:59" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:34+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-Procedure概述"><a href="#一-Procedure概述" class="headerlink" title="一 Procedure概述"></a>一 Procedure概述</h1><ol>
<li>存储过程是一组为了完成特定功能的 sql 语句和流程控制语句的预编译集合，存储在数据库内，可以由应用程序调用。</li>
<li>存储过程的好处<ol>
<li>可复用</li>
<li>预编译：只在创建时编译一次，以后调用时不再编译，速度快</li>
<li>减少网络流量：存储过程存储在数据库服务器上，都在数据库服务器上运行，调用存储过程时只需要传递名称和参数即可。</li>
<li>安全：可防止sql注入</li>
</ol>
</li>
</ol>
<h1 id="二-存储过程和自定义函数的区别"><a href="#二-存储过程和自定义函数的区别" class="headerlink" title="二 存储过程和自定义函数的区别"></a>二 存储过程和自定义函数的区别</h1><ol>
<li>存储过程实现的功能更复杂，函数的针对性更强</li>
<li>存储过程可以返回多个值，函数只能返回一个值</li>
<li>存储过程一般单独执行，函数可以作为其它sql语句的组成部分。</li>
</ol>
<h1 id="三-语法"><a href="#三-语法" class="headerlink" title="三 语法"></a>三 语法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE</span><br><span class="line">	[DEFINER = user]</span><br><span class="line">	PROCEDURE sp_name ([proc_parameter[,...]])</span><br><span class="line">	[characteristic ...]</span><br><span class="line">	routine_body</span><br><span class="line"></span><br><span class="line">proc_parameter:</span><br><span class="line">    [ IN | OUT | INOUT ] param_name type</span><br></pre></td></tr></table></figure>

<h1 id="四-创建"><a href="#四-创建" class="headerlink" title="四 创建"></a>四 创建</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS 存储过程名;</span><br><span class="line">-- 1 修改结束符，自定义，如$$</span><br><span class="line">DELIMITER [结束标记]</span><br><span class="line">CREATE PROCEDURE 存储过程名([参数列表])</span><br><span class="line">BEGIN</span><br><span class="line">        [存储过程体(一组合法的SQL语句)]</span><br><span class="line">END [结束标记]</span><br><span class="line">-- 2 将结束符改回分号</span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<ul>
<li>形参：参数名 参数类型<ul>
<li><code>in</code><ul>
<li>输入参数，调用存储过程时传入的值</li>
<li>可以省略</li>
</ul>
</li>
<li><code>out</code><ul>
<li>输出参数，可在存储过程内部被改变并返回。</li>
<li><code>into</code>：使用 <code>into</code> 为out参数赋值</li>
</ul>
</li>
<li><code>inout</code><ul>
<li>输入输出参数，调用存储过程时传入值，在存储过程内部可以改变并返回。</li>
</ul>
</li>
</ul>
</li>
<li>返回值<ul>
<li>存储过程可以有返回值也可以没有返回值。</li>
</ul>
</li>
</ul>
<h1 id="五-管理"><a href="#五-管理" class="headerlink" title="五 管理"></a>五 管理</h1><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show procedure status</code></td>
<td>查看所有存储过程</td>
</tr>
<tr>
<td><code>show create procedure 存储过程名</code></td>
<td>查看存储过程创建语句</td>
</tr>
<tr>
<td><code>drop procedoure [if exists] 存储过程名</code></td>
<td>删除存储过程</td>
</tr>
</tbody></table>
<h1 id="六-调用"><a href="#六-调用" class="headerlink" title="六 调用"></a>六 调用</h1><ul>
<li><code>call 存储过程名(in参数, @out参数, @inout参数)</code><ol>
<li>存储过程没有返回值（通过out返回），不能用select调用。</li>
<li>实参<ol>
<li>in参数：直接传递即可</li>
<li>out参数：定义一个变量接收返回值<code>@变量名</code></li>
<li>inout参数：在外部定义一个变量，并设置值</li>
</ol>
</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// in</span><br><span class="line">call inpr(3);</span><br><span class="line">// out</span><br><span class="line">call outpr(@name);</span><br><span class="line">select @name;</span><br><span class="line">// inout</span><br><span class="line">set @age = 10;</span><br><span class="line">call inoutpr(@age);</span><br><span class="line">select @age;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%A7%86%E5%9B%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%A7%86%E5%9B%BE/" class="post-title-link" itemprop="url">Mysql视图</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:28 / 修改时间：21:16:25" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:28+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-View-概述"><a href="#一-View-概述" class="headerlink" title="一 View 概述"></a>一 View 概述</h1><ol>
<li>view可以看作是一张虚拟表，是表通过某种运算得到的一个投影。</li>
<li>视图中并没有真正存储数据。</li>
<li>表的改变会影响视图(视图就好像表的影子一样)</li>
<li>视图的改变也能影响表。(如果可以改变的话)</li>
<li>可以跟基本表一样，进行增删改查操作</li>
</ol>
<h1 id="二-数据操作"><a href="#二-数据操作" class="headerlink" title="二 数据操作"></a>二 数据操作</h1><ol>
<li>主要是用来查询</li>
<li>增删改操作有条件限制<ul>
<li>如果视图的数据与表的数据是一一对应出来的，改变不会影响其它数据，就可以增删改。</li>
<li>如果视图的数据是通过计算得来的，改变则会影响表中的其它数据，不可以增删改。</li>
</ul>
</li>
<li>可更新视图：没有以下语句<ul>
<li><code>distinct</code></li>
<li>聚合函数</li>
<li><code>group by / having</code></li>
<li><code>union</code></li>
</ul>
</li>
<li><code>with check option</code><ul>
<li>在视图的 <code>select</code> 语句后添加可以防止更新或删除已有的视图数据</li>
</ul>
</li>
</ol>
<h1 id="三-视图作用"><a href="#三-视图作用" class="headerlink" title="三 视图作用"></a>三 视图作用</h1><ol>
<li>方便操作，特别是查询操作，减少复杂的SQL语句<ul>
<li>将一条复杂的查询语句使用视图进行保存: 以后可以直接对视图进行操作</li>
</ul>
</li>
<li>数据安全<ul>
<li>视图操作是主要针对查询的, 如果对视图结构进行处理(删除), 不会影响基表数据(相对安全).</li>
<li>可以对外提供有用的数据, 但是隐藏关键(无用)的数据</li>
<li>数据库授权命令不能限定到特定行和特定列，但是通过合理创建视图，可以把权限限定到行列级别</li>
</ul>
</li>
<li>权限控制<ul>
<li>不希望用户访问表中某些含敏感信息的列,可以通过view开放某几个列</li>
</ul>
</li>
<li>数据过多时，分表用</li>
</ol>
<h1 id="四-视图管理"><a href="#四-视图管理" class="headerlink" title="四 视图管理"></a>四 视图管理</h1><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>create [or replace] view 视图名 as select语句</code></td>
<td>创建视图</td>
</tr>
<tr>
<td><code>show create view 视图名</code></td>
<td>查看视图</td>
</tr>
<tr>
<td><code>desc 视图名</code></td>
<td></td>
</tr>
<tr>
<td><code>drop view 视图名</code></td>
<td>删除视图</td>
</tr>
<tr>
<td><code>alter view 视图名 as 新的select语句</code></td>
<td>视图本身不可修改，但视图来源可以修改</td>
</tr>
</tbody></table>
<ul>
<li>视图是一张虚拟表，表的所有查看方式，视图都能用，且视图比表多一个关键字 <code>view</code> </li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">Mysql索引</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:23 / 修改时间：21:16:30" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:23+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><ol>
<li>系统根据某种算法，将已有的数据（或未来可能新增的数据）单独建立一个文件，此文件能够实现快速的匹配数据，并且能够快速的找到对应表中的记录</li>
<li>几乎所有的索引都是建立在字段之上</li>
<li>索引本身会产生索引文件(有时候有可能比数据文件还大)，会占用磁盘空间.</li>
<li>索引类似书或字典前边的目录，提升查询速度，但是增删改时，索引也要动态的维护，降低了效率。</li>
<li>索引是在存储引擎中实现的，也就是说不同的存储引擎，会使用不同算法的索引<ol>
<li><code>B-tree</code></li>
<li><code>FullText</code></li>
<li><code>Hash</code></li>
<li><code>GIS</code></li>
<li><code>R-tree</code></li>
</ol>
</li>
</ol>
<h1 id="二-作用"><a href="#二-作用" class="headerlink" title="二 作用"></a>二 作用</h1><ol>
<li>优化查询<ul>
<li>如果某个字段需要作为查询的条件经常使用，那么可以使用索引</li>
</ul>
</li>
<li>约束数据的有效性<ul>
<li>如果某个字段需要进行数据的有效性约束, 也可能使用索引（主键,唯一键 …）</li>
</ul>
</li>
</ol>
<h1 id="三-索引分类"><a href="#三-索引分类" class="headerlink" title="三 索引分类"></a>三 索引分类</h1><ol>
<li>普通索引 <code>MUL</code><ol>
<li>单列索引</li>
<li>多列索引（联合索引）</li>
<li>前缀索引（建索引时，可以只索引列的一部分内容）</li>
</ol>
</li>
<li>唯一索引 <code>UNI</code></li>
<li>主键索引 <code>PRI</code>（也叫聚合索引，MySql 会自动将主键索引添加到所有从属索引中）</li>
<li>全文索引</li>
</ol>
<h1 id="四-索引管理"><a href="#四-索引管理" class="headerlink" title="四 索引管理"></a>四 索引管理</h1><h2 id="4-1-查"><a href="#4-1-查" class="headerlink" title="4.1 查"></a>4.1 查</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>desc 表名</code></td>
<td>通过表结构可以查看索引</td>
</tr>
<tr>
<td><code>show index in/from 表名</code></td>
<td>查看索引详细信息</td>
</tr>
</tbody></table>
<h2 id="4-2-增"><a href="#4-2-增" class="headerlink" title="4.2 增"></a>4.2 增</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alter table 表名 add index 索引名(字段列表)</code></td>
<td>添加普通索引</td>
</tr>
<tr>
<td><code>create index 索引名 on 表名(字段列表)</code></td>
<td>添加普通索引</td>
</tr>
<tr>
<td><code>alter table 表名 add unique index 索引名(字段列表)</code></td>
<td>添加唯一索引</td>
</tr>
<tr>
<td><code>create unique index 索引名 on 表名(字段列表)</code></td>
<td>添加唯一索引</td>
</tr>
<tr>
<td><code>alter table 表名 add primary key(字段列表)</code></td>
<td>添加主键索引</td>
</tr>
</tbody></table>
<h2 id="4-3-删"><a href="#4-3-删" class="headerlink" title="4.3 删"></a>4.3 删</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alter table 表名 drop index 索引名</code></td>
<td>删除索引</td>
</tr>
<tr>
<td><code>drop index 索引名 on 表名</code></td>
<td>删除索引</td>
</tr>
</tbody></table>
<h1 id="五-执行计划"><a href="#五-执行计划" class="headerlink" title="五 执行计划"></a>五 执行计划</h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><ol>
<li>SQL 层解析器会生成多个执行计划，优化器会选择最优的执行计划</li>
<li>执行计划分析<ul>
<li>就是在执行前获取这个最优执行计划，查看其计划信息，可以有效的防止性能较差的语句带来的性能问题</li>
</ul>
</li>
</ol>
<h2 id="5-2-获取执行计划"><a href="#5-2-获取执行计划" class="headerlink" title="5.2 获取执行计划"></a>5.2 获取执行计划</h2><ol>
<li><code>desc sql语句</code></li>
<li><code>explain sql语句</code></li>
</ol>
<h2 id="5-3-执行计划分析"><a href="#5-3-执行计划分析" class="headerlink" title="5.3 执行计划分析"></a>5.3 执行计划分析</h2><ol>
<li><code>table</code><ul>
<li>查询所操作的表</li>
</ul>
</li>
<li><code>type</code><ol>
<li>全表扫描：<code>all</code><ul>
<li>不走索引<ol>
<li>没有查询条件，或者查询条件列无索引</li>
<li>查询结构集是原表中的大部分数据，一般25%以上</li>
<li><code>! not</code><ul>
<li>普通索引列</li>
</ul>
</li>
<li><code>like %xxx</code></li>
<li>联合索引有时只走部分索引</li>
</ol>
</li>
</ul>
</li>
<li>索引扫描（性能依次变好）<ol>
<li><code>index</code><ul>
<li>全索引扫描<ul>
<li>无条件查询索引列 <code>select id from t</code></li>
</ul>
</li>
</ul>
</li>
<li><code>range</code><ul>
<li>索引范围扫描<ol>
<li><code>&gt; &gt;= &lt; &lt;= between and or in()</code></li>
<li><code>like xxx%</code></li>
<li><code>! not</code><ul>
<li>主键索引或唯一索引列</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
<li><code>ref</code><ul>
<li>普通索引列的等值查询</li>
</ul>
</li>
<li><code>eq_ref</code><ul>
<li>在多表连接时，子表（被连接表）使用主键列或者唯一列作为连接条件</li>
</ul>
</li>
<li><code>consist(system)</code><ul>
<li>主键索引或唯一索引列的等值查询</li>
</ul>
</li>
<li><code>null</code></li>
</ol>
</li>
</ol>
</li>
<li><code>possible_key</code><ul>
<li>可能会用到的索引</li>
</ul>
</li>
<li><code>key</code><ul>
<li>真正使用的索引</li>
</ul>
</li>
<li><code>key_len</code><ul>
<li>索引最大预留长度</li>
</ul>
</li>
<li><code>extra</code><ul>
<li><code>using filesort</code><ul>
<li>说明查询中有关排序的条件列没有合理的应用索引，因为索引本身已经是有序的</li>
</ul>
</li>
</ul>
</li>
<li><code>rows</code><ul>
<li>扫描行数</li>
</ul>
</li>
</ol>
<h1 id="六-联合索引"><a href="#六-联合索引" class="headerlink" title="六 联合索引"></a>六 联合索引</h1><h2 id="6-1-联合索引说明"><a href="#6-1-联合索引说明" class="headerlink" title="6.1 联合索引说明"></a>6.1 联合索引说明</h2><ul>
<li>优化器会自动对查询条件按照索引创建时的顺序排序<ol>
<li>最终使用的索引列是排序后连续的等值比较查询</li>
<li>也就是说碰到不连续的或者非等值比较查询（&gt; &gt;= &lt; &lt;= like …）就会停止</li>
</ol>
</li>
<li>例：创建联合索引 <code>inx_haha(a,b,c,d)</code><ol>
<li>查询条件是 <code>b= c= a= d=</code>，排序后 <code>a= b= c= d=</code>，最终使用的索引列 <code>abcd</code></li>
<li>查询条件是 <code>b= a= d=</code>，排序后 <code>a= b= d=</code>，最终使用的索引列 <code>ab</code></li>
<li>查询条件是 <code>c= a= d=</code>，排序后 <code>a= c= d=</code>，最终使用的索引列 <code>a</code></li>
<li>查询条件是 <code>b&gt; a= c= d=</code>，排序后 <code>a= b&gt; c= d=</code>，最终使用的索引列 <code>ab</code></li>
</ol>
</li>
</ul>
<h2 id="6-2-联合索引优化"><a href="#6-2-联合索引优化" class="headerlink" title="6.2 联合索引优化"></a>6.2 联合索引优化</h2><ol>
<li>创建联合索引时唯一键多的列放在最左侧</li>
<li>创建联合索引时等值比较的列放在最左侧</li>
<li>如果查询中出现多种子句（where group by …），要按照子句的执行顺序建立索引</li>
</ol>
<h1 id="七-索引应用规范"><a href="#七-索引应用规范" class="headerlink" title="七 索引应用规范"></a>七 索引应用规范</h1><ol>
<li>建表必须有主键，一般是个无关列，自增值</li>
<li>经常需要where 、ORDER BY、GROUP BY,join on等操作的列建立索引，</li>
<li>值长度较长的列，建议使用前缀索引</li>
<li>索引不是越多越好，不要创建无用索引，不常使用的索引要清理</li>
<li>索引维护避开业务繁忙期</li>
<li>小表不建索引</li>
<li>联合索引优化</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">Mysql事务</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:18 / 修改时间：21:16:21" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:18+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-ACID-特性"><a href="#一-ACID-特性" class="headerlink" title="一 ACID 特性"></a>一 ACID 特性</h1><table>
<thead>
<tr>
<th>特性</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Atomicity</code></td>
<td>原子性</td>
<td>一个事务是一个不可分割的单元，事务中的操作要么都成功，要么都取消</td>
</tr>
<tr>
<td><code>Consistency</code></td>
<td>一致性</td>
<td>事务的执行不能破坏数据库数据的完整性和一致性</td>
</tr>
<tr>
<td><code>Isolation</code></td>
<td>隔离性</td>
<td>事务之间是互不干扰的</td>
</tr>
<tr>
<td><code>Durability</code></td>
<td>持久性</td>
<td>一个事务一旦被提交，它对数据库中数据的改变就是永久性的</td>
</tr>
</tbody></table>
<h1 id="二-事务的生命周期"><a href="#二-事务的生命周期" class="headerlink" title="二 事务的生命周期"></a>二 事务的生命周期</h1><h2 id="2-1-标准生命周期"><a href="#2-1-标准生命周期" class="headerlink" title="2.1 标准生命周期"></a>2.1 标准生命周期</h2><table>
<thead>
<tr>
<th>阶段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>begin &#124; start transction &#124; set autocommit=0</code></td>
<td>开启事务</td>
</tr>
<tr>
<td><code>DML（insert update delete）</code></td>
<td>数据操作</td>
</tr>
<tr>
<td><code>commit &#124; rollback</code></td>
<td>结束事务</td>
</tr>
</tbody></table>
<ul>
<li>注意：开启事务后，在事务中执行一些语句会触发隐式提交（应避免）<ol>
<li>DDL（<code>alte</code> <code>create</code> <code>drop</code> <code>truncate</code>）</li>
<li>DCL（<code>grant</code> <code>revoke</code> <code>set password</code>）</li>
<li>锁（<code>lock tables</code> <code>unlock tables</code>）</li>
<li>…</li>
</ol>
</li>
</ul>
<h2 id="2-2-自动提交（atutocommit）"><a href="#2-2-自动提交（atutocommit）" class="headerlink" title="2.2 自动提交（atutocommit）"></a>2.2 自动提交（atutocommit）</h2><ol>
<li>默认 <code>atutocommit = 1</code> 即开启自动提交，执行 <code>DML</code> 时会自动开启事务并提交</li>
<li>关闭自动提交<ol>
<li><code>set autocommit = 0</code><ul>
<li>会话级别</li>
</ul>
</li>
<li><code>set global autocommit = 0</code><ul>
<li>全局级别，影响所有会话，重启失效</li>
</ul>
</li>
<li><code>vim /etc/my.cnf</code> 中添加 <code>autocommit=0</code><ul>
<li>永久生效</li>
</ul>
</li>
</ol>
</li>
</ol>
<h1 id="三-隔离级别"><a href="#三-隔离级别" class="headerlink" title="三 隔离级别"></a>三 隔离级别</h1><h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h2><ol>
<li>对于同时运行的多个事务（多线程并发）, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题</li>
<li>问题的本质就是线程安全问题，共享数据的问题</li>
</ol>
<h2 id="3-2-问题"><a href="#3-2-问题" class="headerlink" title="3.2 问题"></a>3.2 问题</h2><table>
<thead>
<tr>
<th>问题</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>脏读</td>
<td>事务 T1 读取到了事务 T2 未提交的数据，如果 T2 回滚，那么 T1 读取到的数据是临时且无效的</td>
</tr>
<tr>
<td>不可重复读</td>
<td>事务 T1 读取到了事务 T2 已提交的数据（update），导致 T1 多次读取同一个字段但是结果不同</td>
</tr>
<tr>
<td>幻读</td>
<td>事务 T1 读取到了事务 T2 已提交的数据（insert / delete），导致 T1 多次读取同一张表，但记录数不同</td>
</tr>
</tbody></table>
<h2 id="3-3-隔离级别分类"><a href="#3-3-隔离级别分类" class="headerlink" title="3.3 隔离级别分类"></a>3.3 隔离级别分类</h2><table>
<thead>
<tr>
<th>隔离级别</th>
<th align="center">脏读</th>
<th align="center">不可重复读</th>
<th align="center">幻读</th>
</tr>
</thead>
<tbody><tr>
<td><code>read uncommitted</code></td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td><code>read committed</code></td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td><code>repeatable read</code></td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td><code>serializable</code></td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
</tr>
</tbody></table>
<ul>
<li><code>repeatable read</code><ul>
<li>是 MySQl 默认 隔离级别，Mysql 5.0 之后此级别也可以避免幻读?</li>
</ul>
</li>
</ul>
<h2 id="3-4-隔离级别管理"><a href="#3-4-隔离级别管理" class="headerlink" title="3.4 隔离级别管理"></a>3.4 隔离级别管理</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>select @@tx_isolation</code></td>
<td>查看会话隔离级别</td>
</tr>
<tr>
<td><code>set tx_isolation=隔离级别</code></td>
<td>设置会话隔离级别，必须在开启事务之前</td>
</tr>
<tr>
<td><code>set [global/session] transaction isolation level 隔离级别</code></td>
<td>设置下次事务的隔离级别</td>
</tr>
<tr>
<td><code>tx_isolation=隔离级别</code></td>
<td>在 <code>/etc/my.cnf</code> 中添加，永久设置</td>
</tr>
</tbody></table>
<h1 id="四-锁"><a href="#四-锁" class="headerlink" title="四 锁"></a>四 锁</h1><h2 id="4-1-悲观锁"><a href="#4-1-悲观锁" class="headerlink" title="4.1 悲观锁"></a>4.1 悲观锁</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>数据库提供实现</li>
<li>悲观的认为别人一定会修改我使用的数据，我就未为我使用的数据加锁，防止别人修改</li>
</ol>
<h3 id="2-锁粒度划分"><a href="#2-锁粒度划分" class="headerlink" title="2 锁粒度划分"></a>2 锁粒度划分</h3><ol>
<li>表锁<ul>
<li>开销小，加锁快；不会出现死锁；但锁粒度大，锁冲突概率高，并发度低</li>
</ul>
</li>
<li>行锁<ul>
<li>开销大，加锁慢；会出现死锁；锁定粒度小，锁冲突概率低，并发度高。</li>
</ul>
</li>
</ol>
<h3 id="3-锁机制划分"><a href="#3-锁机制划分" class="headerlink" title="3 锁机制划分"></a>3 锁机制划分</h3><ol>
<li>读锁/共享锁<ul>
<li>其他事务可以读，但不能写</li>
</ul>
</li>
<li>写锁/排他锁<ul>
<li>其他事务不能读取，也不能写</li>
</ul>
</li>
</ol>
<h2 id="4-2-乐观锁"><a href="#4-2-乐观锁" class="headerlink" title="4.2 乐观锁"></a>4.2 乐观锁</h2><ol>
<li>需要自己实现</li>
<li>乐观的认为数据一般是不会造成冲突的。只有在提交数据的时候，才会对数据的冲突进行检测</li>
<li>类似与 版本控制（git / svn），会有一个版本号，在提交时会对比版本号，如果冲突则不能提交。</li>
<li>例：<ul>
<li><code>id=1 money=100 version=1</code>甲乙同时操作money-10</li>
<li>甲先提交<code>id=1 money=90 version=2</code>提交成功。</li>
<li>乙后提交<code>id=1 money=90 version=2</code>提交失败</li>
<li>乙需要从新查询，然后修改提交<code>id=1 money=80 version=3</code></li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%AF%AD%E5%8F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%AF%AD%E5%8F%A5/" class="post-title-link" itemprop="url">Mysql语句</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:13 / 修改时间：21:16:42" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:13+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><h2 id="1-1-SQL（Structure-Query-Language）"><a href="#1-1-SQL（Structure-Query-Language）" class="headerlink" title="1.1 SQL（Structure Query Language）"></a>1.1 SQL（Structure Query Language）</h2><ol>
<li>结构化查询语言，关系型数据库通用命令</li>
<li>遵循SQL92标准</li>
<li>注释<ol>
<li><code>-- 单行注释</code></li>
<li><code>#单行注释</code>（mysql 特有）</li>
<li><code>/* 多行注释 */</code></li>
</ol>
</li>
</ol>
<h2 id="1-2-严格模式（SQL-MODE）"><a href="#1-2-严格模式（SQL-MODE）" class="headerlink" title="1.2 严格模式（SQL_MODE）"></a>1.2 严格模式（SQL_MODE）</h2><ol>
<li><code>set sql_mode = &#39;traditional&#39;</code><ul>
<li>设置严格模式（默认）</li>
</ul>
</li>
<li><code>set sql_mode = &#39;&#39;</code><ul>
<li>关闭严格模式</li>
</ul>
</li>
</ol>
<h2 id="1-3-规范"><a href="#1-3-规范" class="headerlink" title="1.3 规范"></a>1.3 规范</h2><h3 id="1-SQL-规范"><a href="#1-SQL-规范" class="headerlink" title="1 SQL 规范"></a>1 SQL 规范</h3><ol>
<li>SQL 语句不区分大小写，关键字和函数名建议大写</li>
<li>值：除了数值类型外都使用单引号 <code>&#39;&#39;</code></li>
<li>别名建议使用双引号 <code>&quot;&quot;</code>，且不省略 <code>as</code> 关键字</li>
<li>数据库必须设置字符集，表必须设置字符集和存储引擎</li>
<li>列选择合适的数据类型及长度，且要有注释</li>
<li>每列设置 <code>NOT NULL + DEFAULT</code><ol>
<li>数值默认为 <code>0</code> 或其它有效数字</li>
<li>字符串默认为空格字符串 <code>&#39; &#39;</code> 或其它有效字符串</li>
</ol>
</li>
<li>enum 类型不要用于数值，只能用于字符串</li>
<li>主键列最好是无关数值列，且自增长</li>
</ol>
<h3 id="2-命名规范"><a href="#2-命名规范" class="headerlink" title="2 命名规范"></a>2 命名规范</h3><ol>
<li>库名和表名小写，只能使用 <code>A-Z a-z 0-9</code>，不能以数字开头</li>
<li>不能使用关键字和保留字</li>
</ol>
<h2 id="1-4-SQL-常用分类"><a href="#1-4-SQL-常用分类" class="headerlink" title="1.4 SQL 常用分类"></a>1.4 SQL 常用分类</h2><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>DDL（Data Definition Language）</code></td>
<td>数据定义语言，如 <code>create alter drop truncate</code></td>
</tr>
<tr>
<td><code>DML（Data Manipulation Language）</code></td>
<td>数据操作语言，如 <code>insert delete update</code></td>
</tr>
<tr>
<td><code>DQL（Data Query Language）</code></td>
<td>数据查询语言，如 <code>select show</code></td>
</tr>
<tr>
<td><code>DCL（Data Control Language）</code></td>
<td>数据控制语言，如 <code>grant revoke</code></td>
</tr>
</tbody></table>
<h1 id="二-库"><a href="#二-库" class="headerlink" title="二 库"></a>二 库</h1><h2 id="2-1-查"><a href="#2-1-查" class="headerlink" title="2.1 查"></a>2.1 查</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show databases</code></td>
<td>查看所有库</td>
</tr>
<tr>
<td><code>use 库名</code></td>
<td>使用指定数据库</td>
</tr>
<tr>
<td><code>select database()</code></td>
<td>查看正在使用的数据库</td>
</tr>
<tr>
<td><code>show create database db_name</code></td>
<td>查看建库语句</td>
</tr>
<tr>
<td><code>show variables like &#39;character_set_database&#39;</code></td>
<td>查看当前数据库字符集</td>
</tr>
<tr>
<td><code>show variables like &#39;collation_database&#39;</code></td>
<td>查看当前数据库校对集</td>
</tr>
</tbody></table>
<h2 id="2-2-增"><a href="#2-2-增" class="headerlink" title="2.2 增"></a>2.2 增</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database [if not exists] 库名 [default character set 字符集 collate 校对集]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>character set</code> 都可以简写为 <code>charset</code></li>
</ul>
<h2 id="2-3-删"><a href="#2-3-删" class="headerlink" title="2.3 删"></a>2.3 删</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database [if exists] 库名</span><br></pre></td></tr></table></figure>

<h2 id="2-4-改"><a href="#2-4-改" class="headerlink" title="2.4 改"></a>2.4 改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter database 库名 [charset 字符集 collate 校对集]</span><br></pre></td></tr></table></figure>

<ol>
<li>库名不可修改</li>
<li>只能修改库属性（字符集和校对集）</li>
</ol>
<h1 id="三-表"><a href="#三-表" class="headerlink" title="三 表"></a>三 表</h1><h2 id="3-1-查"><a href="#3-1-查" class="headerlink" title="3.1 查"></a>3.1 查</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show tables [from 库名]</code></td>
<td>查看库（默认为当前库）中的所有表</td>
</tr>
<tr>
<td><code>show create table 表名</code></td>
<td>查看建表语句</td>
</tr>
<tr>
<td><code>desc 表名</code></td>
<td>查看表结构</td>
</tr>
</tbody></table>
<h2 id="3-2-增"><a href="#3-2-增" class="headerlink" title="3.2 增"></a>3.2 增</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 1 </span><br><span class="line">create table [if not exists] 表名(</span><br><span class="line">	列名 列属性,</span><br><span class="line">	......</span><br><span class="line">	列名 列属性</span><br><span class="line">)[engine=INNODB character set 字符集 collate 校对集]</span><br><span class="line"></span><br><span class="line">// 2 根据已有表结构创建新表</span><br><span class="line">create table 新表名 like 旧表名</span><br><span class="line"></span><br><span class="line">// 3 根据已有表创建新表并添加数据</span><br><span class="line">create table 新表名 AS 子查询</span><br></pre></td></tr></table></figure>

<h2 id="3-3-删"><a href="#3-3-删" class="headerlink" title="3.3 删"></a>3.3 删</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table [if exists] 表名</span><br></pre></td></tr></table></figure>

<h2 id="3-4-改"><a href="#3-4-改" class="headerlink" title="3.4 改"></a>3.4 改</h2><h3 id="1-表信息（表名-表属性）"><a href="#1-表信息（表名-表属性）" class="headerlink" title="1 表信息（表名 表属性）"></a>1 表信息（表名 表属性）</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>rename table 表名 to 新表名</code></td>
<td>修改表名</td>
</tr>
<tr>
<td><code>alter table 表名 rename 新表名</code></td>
<td>修改表名</td>
</tr>
<tr>
<td><code>alter table 表名 表属性</code></td>
<td>修改表属性</td>
</tr>
</tbody></table>
<h3 id="2-表结构（列信息）"><a href="#2-表结构（列信息）" class="headerlink" title="2 表结构（列信息）"></a>2 表结构（列信息）</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alter table 表名 add [column] 列名 列属性 [位置]</code></td>
<td>默认在最后添加一列，可指定位置：<code>first</code> 或 <code>after 某列</code></td>
</tr>
<tr>
<td><code>alter table 表名 add [column] (列名 列属性, ...)</code></td>
<td>在最后添加多列</td>
</tr>
<tr>
<td><code>alter table 表名 drop [column] 列名</code></td>
<td>删除列</td>
</tr>
<tr>
<td><code>alter table 表名 modify 列名 列属性</code></td>
<td>修改列属性</td>
</tr>
<tr>
<td><code>alter table 表名 change 列名 新列名 列属性</code></td>
<td>修改列名和列属性</td>
</tr>
</tbody></table>
<h1 id="四-数据"><a href="#四-数据" class="headerlink" title="四 数据"></a>四 数据</h1><h2 id="4-1-增删改"><a href="#4-1-增删改" class="headerlink" title="4.1 增删改"></a>4.1 增删改</h2><h3 id="1-insert"><a href="#1-insert" class="headerlink" title="1 insert"></a>1 insert</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>insert [into] 表名 values(值列表)[, (值列表)]</code></td>
<td>向表所有列插入 1 或多条记录，列与值一一对应</td>
</tr>
<tr>
<td><code>insert [into] 表名(字段列表) values(值列表)[, (值列表)]</code></td>
<td>向表指定列插入 1 或多条记录，列与值一一对应</td>
</tr>
<tr>
<td><code>insert [into] 表名 set 列=值, ...</code></td>
<td>向表指定列插入 1 条记录，值可以使用子查询</td>
</tr>
</tbody></table>
<h3 id="2-update"><a href="#2-update" class="headerlink" title="2 update"></a>2 update</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>update 表名 set 列=值 [where 子句]</code></td>
<td>不加条件会更新所有行</td>
</tr>
</tbody></table>
<h3 id="3-delete"><a href="#3-delete" class="headerlink" title="3 delete"></a>3 delete</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>delete from 表名 [where 子句]</code></td>
<td>不加条件会删除所有行</td>
</tr>
<tr>
<td><code>truncate [table] 表名</code></td>
<td>清空表</td>
</tr>
</tbody></table>
<ul>
<li>truncate 和 delete 区别<ul>
<li>DELETE <ol>
<li>DML 操作，是逻辑性质删除，逐行删除速度慢</li>
<li>删除表中的数据，表结构还在，删除后的数据可以找回</li>
<li>自增长不会重置</li>
</ol>
</li>
<li>TRUNCATE <ol>
<li>DDL 操作，对表段中的数据页进行清空，速度快</li>
<li>相当于把表扔了又创建一个同样表结构的新表</li>
<li>自增长会重置</li>
</ol>
</li>
</ul>
</li>
</ul>
<h2 id="4-2-查"><a href="#4-2-查" class="headerlink" title="4.2 查"></a>4.2 查</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">select [选项] 表达式 [as 列别名] [, [选项] 表达式 [as 列别名], ...]</span><br><span class="line">[</span><br><span class="line">	from 数据源 [as 表别名]</span><br><span class="line">	[where 子句]</span><br><span class="line">	[group by 子句]</span><br><span class="line">	[having 子句]</span><br><span class="line">	[order by 子句]</span><br><span class="line">	[limit 子句]</span><br><span class="line">]</span><br><span class="line">[union | union all]</span><br><span class="line">select ...</span><br><span class="line"></span><br><span class="line">// 查询过程</span><br><span class="line">1. from</span><br><span class="line">   - 确定数据源</span><br><span class="line">2. where</span><br><span class="line">   - 从原表中筛选出符合条件的数据形成一个概念中的临时结果集，存入内存</span><br><span class="line">3. group by</span><br><span class="line">   - 按照指定列进行分组</span><br><span class="line">4. select</span><br><span class="line">   - 处理表达式（函数, 别名, 运算 ...），形成结果集</span><br><span class="line">5. having</span><br><span class="line">   - 对结果集进行过滤</span><br><span class="line">6. order by</span><br><span class="line">   - 对过滤后的结果集进行排序</span><br><span class="line">7. limit</span><br><span class="line">   - 对排序后的结果集进行条目限制，形成最终结果集</span><br></pre></td></tr></table></figure>

<h3 id="1-select-子句"><a href="#1-select-子句" class="headerlink" title="1 select 子句"></a>1 select 子句</h3><ol>
<li>选项<ul>
<li><code>all</code>：保留所有结果（默认）</li>
<li><code>distinct</code>：去除重复</li>
<li><code>distinct row</code></li>
<li><code>top</code></li>
</ul>
</li>
<li>表达式<ul>
<li>每一个表达式代表一列，可以是列名，*，变量，函数，…</li>
</ul>
</li>
<li>别名<ul>
<li>表别名可用于全局</li>
<li>列别名可用于 <code>having</code> 和 <code>order by</code> </li>
</ul>
</li>
</ol>
<h3 id="2-from-子句"><a href="#2-from-子句" class="headerlink" title="2 from 子句"></a>2 from 子句</h3><ul>
<li>本质上只要数据类似二维表，都可以作为数据源<ol>
<li>单表数据源</li>
<li>多表数据源</li>
<li>查询语句</li>
</ol>
</li>
</ul>
<h3 id="3-where-子句"><a href="#3-where-子句" class="headerlink" title="3 where 子句"></a>3 where 子句</h3><ol>
<li>从原表中的记录中进行筛选</li>
<li>where 是直接对表中数据进行判断，所以只能使用表中的列，且不能使用别名</li>
</ol>
<h3 id="4-group-by-子句"><a href="#4-group-by-子句" class="headerlink" title="4 group by 子句"></a>4 group by 子句</h3><h4 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h4><ol>
<li>通常配合聚合函数使用</li>
<li>可以有多个分组列，以逗号分隔</li>
<li>select 中可以查询的列：<ol>
<li>分组的列</li>
<li>聚合函数的列</li>
<li>与分组列一对一的列（不报错，但不推荐）</li>
</ol>
</li>
</ol>
<h4 id="2-group-by-原理"><a href="#2-group-by-原理" class="headerlink" title="2 group by 原理"></a>2 group by 原理</h4><ol>
<li>先按照分组列排序、去重，形成一张虚拟表</li>
<li>虚拟表的结构：分组列与其它列的对应关系<ol>
<li>分组列一对一的列可以直接查询（即与分组列对应的列只有一行记录）</li>
<li>分组列一对多的列不能直接查询（即与分组列对应的列有多行记录）<ol>
<li>使用聚合函数将多行记录统计为一行记录</li>
<li>使用 <code>group_concat()</code> 将多行记录合并连接为一行记录</li>
</ol>
</li>
</ol>
</li>
</ol>
<h4 id="3-聚合函数"><a href="#3-聚合函数" class="headerlink" title="3 聚合函数"></a>3 聚合函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>max([distinct] expr)</code></td>
<td>返回 expr 最大值</td>
</tr>
<tr>
<td><code>min([distinct] expr)</code></td>
<td>返回 expr 最小值</td>
</tr>
<tr>
<td><code>count([distinct] expr)</code></td>
<td>返回 expr 记录总数</td>
</tr>
<tr>
<td><code>sum([distinct] expr)</code></td>
<td>返回 expr 总和</td>
</tr>
<tr>
<td><code>avg([distinct] expr)</code></td>
<td>返回 expr 平均值</td>
</tr>
<tr>
<td><code>group_concat()</code></td>
<td>将group by产生的同一个分组中的其它列的所有值连接成一个字符串（多行记录变一行）</td>
</tr>
</tbody></table>
<ul>
<li><code>count()</code><ol>
<li><code>count(*)</code> 和 <code>count(常量)</code><ul>
<li>记录总数（包含空行）</li>
<li>此类参数表示数数，有一行记录总数就+1，也就是说总数与记录内容无关</li>
<li><code>count(*)</code> 效率底不建议</li>
</ul>
</li>
<li><code>count(列名)</code><ul>
<li>记录总数（不包含空行）</li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="4-with-rollup"><a href="#4-with-rollup" class="headerlink" title="4 with rollup"></a>4 with rollup</h4><ul>
<li>分组后跟 <code>with rollup</code> 会对分组进行统计</li>
<li>只有 mysql 支持</li>
</ul>
<h3 id="5-having-子句"><a href="#5-having-子句" class="headerlink" title="5 having 子句"></a>5 having 子句</h3><ul>
<li>having 是对其之前子句筛选出的数据进行条件过滤</li>
</ul>
<h3 id="6-order-by子句"><a href="#6-order-by子句" class="headerlink" title="6 order by子句"></a>6 order by子句</h3><table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>asc</code></td>
<td>升序（默认）</td>
</tr>
<tr>
<td><code>desc</code></td>
<td>降序</td>
</tr>
</tbody></table>
<ol>
<li>排序依赖校对集</li>
<li>可以有多个排序条件，前一个条件结果相同则比较下一个条件</li>
</ol>
<h3 id="7-limit-子句"><a href="#7-limit-子句" class="headerlink" title="7 limit 子句"></a>7 limit 子句</h3><table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>limit [startIndex, ]length</code></td>
<td>从指定索引（若省略，默认为 0）开始，取 <code>length</code> 条数据</td>
</tr>
<tr>
<td><code>limit length offset startIndex</code></td>
<td>同上，也可以把索引理解为偏移量（即跳过 <code>startIndex</code> 个）</td>
</tr>
</tbody></table>
<h3 id="8-union-amp-union-all"><a href="#8-union-amp-union-all" class="headerlink" title="8 union &amp; union all"></a>8 union &amp; union all</h3><table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>union all</code></td>
<td>合并多个查询结果集，保留所有</td>
</tr>
<tr>
<td><code>union</code></td>
<td>合并多个查询结果集，去除重复</td>
</tr>
</tbody></table>
<ul>
<li>要合并的查询结果列数必须相同，合并后结果集的列名取决于第一个要合并的查询</li>
<li>一般情况下,会将 <code>in()</code> 或者 <code>OR</code> 语句 改写成 <code>UNION ALL</code> ，来提高性能</li>
</ul>
<h1 id="五-关联查询（SQL-JOIN）"><a href="#五-关联查询（SQL-JOIN）" class="headerlink" title="五 关联查询（SQL JOIN）"></a>五 关联查询（SQL JOIN）</h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><h3 id="1-关联查询结果"><a href="#1-关联查询结果" class="headerlink" title="1 关联查询结果"></a>1 关联查询结果</h3><p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/sql-join.png" alt=""></p>
<ol>
<li>关联查询有七种结果（行/记录）</li>
<li>关联查询的列都是两表组合在一起，即 A 表的列 + B 表的列</li>
</ol>
<h3 id="2-关联查询分类"><a href="#2-关联查询分类" class="headerlink" title="2 关联查询分类"></a>2 关联查询分类</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>查询结果</th>
</tr>
</thead>
<tbody><tr>
<td><code>inner/cross join</code></td>
<td>内连接</td>
<td><code>A ∩ B</code></td>
</tr>
<tr>
<td><code>left [outer] join</code></td>
<td>左外连接</td>
<td><code>A</code>，<code>A - A ∩ B</code></td>
</tr>
<tr>
<td><code>right [outer] join</code></td>
<td>右外连接</td>
<td><code>B</code>，<code>B - A ∩ B</code></td>
</tr>
<tr>
<td><code>full [outer] join</code></td>
<td>全外连接</td>
<td><code>A ∪ B</code>，<code>A ∪ B - A ∩ B</code></td>
</tr>
</tbody></table>
<ol>
<li>如果连接的表是同一张表，又称为<strong>自连接</strong></li>
<li>mysql 不支持全外连接，可通过 <code>union</code> 实现</li>
</ol>
<h2 id="5-2-语法"><a href="#5-2-语法" class="headerlink" title="5.2 语法"></a>5.2 语法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">表1 </span><br><span class="line">&#123;[inner | cross] | &#123;left | right&#125; [outer]&#125;  join</span><br><span class="line">表2</span><br><span class="line">on 条件表达式</span><br><span class="line">[</span><br><span class="line">	&#123;[inner | cross] | &#123;left | right&#125; [outer]&#125;  join</span><br><span class="line">	表3</span><br><span class="line">	on 条件表达式</span><br><span class="line">	......</span><br><span class="line">]</span><br><span class="line">[</span><br><span class="line">	[where 子句]</span><br><span class="line">	[group by 子句]</span><br><span class="line">	[having 子句]</span><br><span class="line">	[order by 子句]</span><br><span class="line">	[limit 子句]</span><br><span class="line">]</span><br><span class="line">[union | union all]</span><br><span class="line">select ...</span><br></pre></td></tr></table></figure>

<h2 id="5-3-关联条件"><a href="#5-3-关联条件" class="headerlink" title="5.3 关联条件"></a>5.3 关联条件</h2><h3 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>内连接如果没有关联条件，会形成笛卡尔积</li>
<li>外连接如果没有关联条件，会报错</li>
</ol>
<h3 id="2-笛卡尔积"><a href="#2-笛卡尔积" class="headerlink" title="2 笛卡尔积"></a>2 笛卡尔积</h3><ol>
<li>笛卡儿积是元素相组合，不是数学相乘</li>
<li>数学中的笛卡儿积<ul>
<li>集合 A 有 <code>m</code> 个元素，集合 B 有 <code>n</code> 个元素，则笛卡尔积共 <code>m * n</code>个元素</li>
<li>集合 <code>A = {a, b}</code>，集合 <code>B = {0, 1, 2}</code>，笛卡尔积 = <code>{(a, 0), (a, 1), (a, 2), (b, 0), (b, 1), (b, 2)}</code></li>
</ul>
</li>
<li>数据库中的笛卡儿积<ul>
<li>表 A 有 <code>m</code> 条记录，表 B 中有 n 条记录，则笛卡尔积共有 <code>m*n</code> 条记录</li>
</ul>
</li>
</ol>
<h3 id="3-关联条件的方式"><a href="#3-关联条件的方式" class="headerlink" title="3 关联条件的方式"></a>3 关联条件的方式</h3><ol>
<li><code>where</code><ul>
<li>用于所有关联查询</li>
</ul>
</li>
<li><code>join on</code><ul>
<li>只能写关联条件，虽然关联条件可以并到 <code>where</code> 中，但单独写可读性更好</li>
</ul>
</li>
<li><code>join using(列名列表)</code><ul>
<li>表示两个关联字段值相同，要求两个关联字段列名必须一致</li>
</ul>
</li>
</ol>
<h2 id="5-4-内连接"><a href="#5-4-内连接" class="headerlink" title="5.4 内连接"></a>5.4 内连接</h2><h3 id="1-语法"><a href="#1-语法" class="headerlink" title="1 语法"></a>1 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 1 隐式</span><br><span class="line">from 表1, 表2 where 条件</span><br><span class="line"></span><br><span class="line">// 2 显式</span><br><span class="line">from 表1 [inner | cross] join 表2 on 关联条件</span><br></pre></td></tr></table></figure>

<h3 id="2-结果"><a href="#2-结果" class="headerlink" title="2 结果"></a>2 结果</h3><p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/INNER_JOIN.png" alt=""></p>
<h2 id="5-5-外连接"><a href="#5-5-外连接" class="headerlink" title="5.5 外连接"></a>5.5 外连接</h2><h3 id="1-左外连接"><a href="#1-左外连接" class="headerlink" title="1 左外连接"></a>1 左外连接</h3><h4 id="1-语法-1"><a href="#1-语法-1" class="headerlink" title="1 语法"></a>1 语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表1 left [outer] join 表2 on 条件</span><br></pre></td></tr></table></figure>

<h4 id="2-结果-1"><a href="#2-结果-1" class="headerlink" title="2 结果"></a>2 结果</h4><p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/LEFT_JOIN.png" alt=""></p>
<ul>
<li>查出左表所有行，左表中的行在右表没有匹配则右表对应行返回空</li>
</ul>
<p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/LEFT_EXCLUDING_JOIN.png" alt=""></p>
<ul>
<li>查出左表在右表中没有匹配的行，右表肯定都返回空</li>
</ul>
<h3 id="2-右外连接"><a href="#2-右外连接" class="headerlink" title="2 右外连接"></a>2 右外连接</h3><h4 id="1-语法-2"><a href="#1-语法-2" class="headerlink" title="1 语法"></a>1 语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表1 right [outer] join 表2 on 条件</span><br></pre></td></tr></table></figure>

<h4 id="2-结果-2"><a href="#2-结果-2" class="headerlink" title="2 结果"></a>2 结果</h4><p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/RIGHT_JOIN.png" alt=""></p>
<ul>
<li>查出右表所有行，右表中的行在左表没有匹配则左表对应行返回空</li>
</ul>
<p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/RIGHT_EXCLUDING_JOIN.png" alt=""></p>
<ul>
<li>查出右表在左表中没有匹配的行，左表肯定都返回空</li>
</ul>
<h3 id="3-全外连接"><a href="#3-全外连接" class="headerlink" title="3 全外连接"></a>3 全外连接</h3><h4 id="1-语法-3"><a href="#1-语法-3" class="headerlink" title="1 语法"></a>1 语法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">表1 full [outer] join 表2 on 条件</span><br></pre></td></tr></table></figure>

<h4 id="2-结果-3"><a href="#2-结果-3" class="headerlink" title="2 结果"></a>2 结果</h4><p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/FULL_OUTER_JOIN.png" alt=""></p>
<ul>
<li>查出左表和右表的所有行，在彼此表中没有匹配的行则返回空</li>
</ul>
<p><img src="https://github.com/anyeansan/pics/raw/master/CS/SQL/OUTER_EXCLUDING_JOIN.png" alt=""></p>
<ul>
<li>查出在左表和右表中彼此没有匹配的行</li>
</ul>
<h2 id="5-6-例"><a href="#5-6-例" class="headerlink" title="5.6 例"></a>5.6 例</h2><h3 id="1-原始表-t1-和-t2"><a href="#1-原始表-t1-和-t2" class="headerlink" title="1 原始表 t1 和 t2"></a>1 原始表 t1 和 t2</h3><table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>D</td>
</tr>
<tr>
<td>3</td>
<td>E</td>
</tr>
<tr>
<td>4</td>
<td>F</td>
</tr>
</tbody></table>
<h3 id="2-内连接"><a href="#2-内连接" class="headerlink" title="2 内连接"></a>2 内连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 inner join t2 on t1.id=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>a</td>
<td>2</td>
<td>D</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>3</td>
<td>E</td>
</tr>
</tbody></table>
<h3 id="3-左外连接"><a href="#3-左外连接" class="headerlink" title="3 左外连接"></a>3 左外连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 left join t2 on t1.id=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
<td>2</td>
<td>D</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>3</td>
<td>E</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 left join t2 on t1.id!=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
<td>null</td>
<td>null</td>
</tr>
</tbody></table>
<h3 id="4-右外连接"><a href="#4-右外连接" class="headerlink" title="4 右外连接"></a>4 右外连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 right join t2 on t1.id=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>b</td>
<td>2</td>
<td>D</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>3</td>
<td>E</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
<td>4</td>
<td>F</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 right join t2 on t1.id!=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>null</td>
<td>null</td>
<td>4</td>
<td>F</td>
</tr>
</tbody></table>
<h3 id="5-全外连接"><a href="#5-全外连接" class="headerlink" title="5 全外连接"></a>5 全外连接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 full join t2 on t1.id=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
<td>2</td>
<td>D</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>3</td>
<td>E</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
<td>4</td>
<td>F</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from t1 full join t2 on t1.id!=t2.id;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>id</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>a</td>
<td>null</td>
<td>null</td>
</tr>
<tr>
<td>null</td>
<td>null</td>
<td>4</td>
<td>F</td>
</tr>
</tbody></table>
<h1 id="六-子查询"><a href="#六-子查询" class="headerlink" title="六 子查询"></a>六 子查询</h1><h2 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h2><ul>
<li>一个查询需要的条件或数据是另一个查询的结果，即一个查询中嵌套了另一个查询，嵌套在里面的查询就是子查询</li>
</ul>
<h2 id="6-2-子查询根据位置分类"><a href="#6-2-子查询根据位置分类" class="headerlink" title="6.2 子查询根据位置分类"></a>6.2 子查询根据位置分类</h2><ol>
<li><p>from 型子查询：子查询必须有别名</p>
<ul>
<li><code>from (子查询) 别名</code></li>
</ul>
</li>
<li><p>where 型子查询</p>
<ul>
<li><code>where 字段 = (子查询)</code></li>
<li><code>where 字段 in (子查询)</code></li>
<li><code>...</code></li>
</ul>
</li>
<li><p>exists 型子查询</p>
<ul>
<li><code>where exists(子查询)</code><ol>
<li>子查询返回记录，则 <code>exists</code> 为 <code>true</code>，添加记录</li>
<li>子查询没有记录，则 <code>exists</code> 为 <code>false</code>，不添加记录</li>
</ol>
</li>
</ul>
</li>
<li><p>相关子查询：子查询和外部查询有关系</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM invoices i</span><br><span class="line">WHERE invoice_total &gt; (</span><br><span class="line">	SELECT AVG(invoice_total)</span><br><span class="line">	FROM invoices</span><br><span class="line">	WHERE client_id = i.client_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>select 子查询</p>
</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">Mysql语法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:08 / 修改时间：21:16:37" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:08+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-元数据"><a href="#一-元数据" class="headerlink" title="一 元数据"></a>一 元数据</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><ol>
<li>元数据可以简单理解为描述数据的数据，除了存储在数据库中的数据外，其它大多可以理解为元数据</li>
<li>元数据存储在“基表”中，不能直接访问<ol>
<li><code>infomation_schema</code> 数据库中保存了大量元数据查询的视图</li>
<li><code>show</code> 命令是封装好的，提供元数据查询的基础功能</li>
</ol>
</li>
</ol>
<h2 id="1-2-information-schema"><a href="#1-2-information-schema" class="headerlink" title="1.2 information_schema"></a>1.2 information_schema</h2><table>
<thead>
<tr>
<th>表</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>schemata</code></td>
<td>存储当前 mysql 实例中所有数据库的信息，<code>show databases</code> 命令从这个表获取数据</td>
</tr>
<tr>
<td><code>tables</code></td>
<td>存储数据库中的表信息（包括视图），<code>show tables [from db_name]</code> 命令从这个表获取结果</td>
</tr>
<tr>
<td><code>columns</code></td>
<td>存储数据库中每张表的列信息（如属于哪张表哪个库，属性信息…)</td>
</tr>
<tr>
<td><code>table_constraints</code></td>
<td>存储表约束信息</td>
</tr>
<tr>
<td><code>statistics</code></td>
<td>存储表索引信息</td>
</tr>
<tr>
<td><code>collations</code></td>
<td>存储了字符集和校对集对照信息</td>
</tr>
</tbody></table>
<h3 id="tables-表"><a href="#tables-表" class="headerlink" title="tables 表"></a>tables 表</h3><table>
<thead>
<tr>
<th>列</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>table_schema</code></td>
<td>表所在库名</td>
</tr>
<tr>
<td><code>table_name</code></td>
<td>表名</td>
</tr>
<tr>
<td><code>engine</code></td>
<td>存储引擎</td>
</tr>
<tr>
<td><code>table_rows</code></td>
<td>总行数</td>
</tr>
<tr>
<td><code>avg_row_length</code></td>
<td>行平均长度</td>
</tr>
<tr>
<td><code>index_length</code></td>
<td>索引长度</td>
</tr>
</tbody></table>
<ul>
<li><code>表大小 = avg_row_length * table_rows + index_length</code></li>
</ul>
<h2 id="1-3-show"><a href="#1-3-show" class="headerlink" title="1.3 show"></a>1.3 show</h2><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show databases</code></td>
<td>查看所有库名</td>
</tr>
<tr>
<td><code>show tables [from db_name]</code></td>
<td>查看库中所有表名</td>
</tr>
<tr>
<td><code>show create database db_name</code></td>
<td>查看建库语句</td>
</tr>
<tr>
<td><code>show create table t_name</code></td>
<td>查看建表语句</td>
</tr>
<tr>
<td><code>show processlist</code></td>
<td>查看数据库连接情况</td>
</tr>
<tr>
<td><code>show charset</code></td>
<td>查看支持的字符集</td>
</tr>
<tr>
<td><code>show collation</code></td>
<td>查看支持的校对集</td>
</tr>
<tr>
<td><code>show engines</code></td>
<td>查看支持的存储引擎</td>
</tr>
<tr>
<td><code>show grants for user_name</code></td>
<td>查看用户权限</td>
</tr>
<tr>
<td><code>shwo variables [like pattern]</code></td>
<td>查看变量信息</td>
</tr>
<tr>
<td><code>show index from t_name</code></td>
<td>查看表的索引信息</td>
</tr>
<tr>
<td><code>show engine innodb statsu\G</code></td>
<td>查看 innodb 引擎详细状态信息（横向）</td>
</tr>
<tr>
<td><code>show status [like pattern]</code></td>
<td>查看数据库状态信息</td>
</tr>
<tr>
<td><code>show binary logs</code></td>
<td>查看二进制日志的列表信息</td>
</tr>
<tr>
<td><code>show binlog events in log_name</code></td>
<td>查看二进制日志的事件信息</td>
</tr>
<tr>
<td><code>show master status</code></td>
<td>查看 mysql 当前使用的二进制日志信息</td>
</tr>
<tr>
<td><code>show relaylog events in log_name</code></td>
<td>查看中继日志的事件信息</td>
</tr>
</tbody></table>
<h1 id="二-运算符-和-语句"><a href="#二-运算符-和-语句" class="headerlink" title="二 运算符 和 语句"></a>二 运算符 和 语句</h1><h2 id="2-1-算术运算符"><a href="#2-1-算术运算符" class="headerlink" title="2.1 算术运算符"></a>2.1 算术运算符</h2><table>
<thead>
<tr>
<th align="left">运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>+</code></td>
<td>加</td>
</tr>
<tr>
<td align="left"><code>-</code></td>
<td>减</td>
</tr>
<tr>
<td align="left"><code>*</code></td>
<td>乘</td>
</tr>
<tr>
<td align="left"><code>/</code></td>
<td>除</td>
</tr>
<tr>
<td align="left"><code>DIV</code></td>
<td>整除</td>
</tr>
<tr>
<td align="left"><code>%, MOD</code></td>
<td>模</td>
</tr>
</tbody></table>
<h2 id="2-2-比较运算符"><a href="#2-2-比较运算符" class="headerlink" title="2.2 比较运算符"></a>2.2 比较运算符</h2><table>
<thead>
<tr>
<th align="left">运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>&gt;</code></td>
<td>大于</td>
</tr>
<tr>
<td align="left"><code>&gt;=</code></td>
<td>大于等于</td>
</tr>
<tr>
<td align="left"><code>&lt;</code></td>
<td>小于</td>
</tr>
<tr>
<td align="left"><code>&lt;=</code></td>
<td>小于等于</td>
</tr>
<tr>
<td align="left"><code>=</code></td>
<td>等于，<code>null = null</code> 返回 null</td>
</tr>
<tr>
<td align="left"><code>&lt;=&gt;</code></td>
<td>等于，<code>null = null</code> 返回 1</td>
</tr>
<tr>
<td align="left"><code>&lt;&gt;, !=</code></td>
<td>不等于</td>
</tr>
</tbody></table>
<h2 id="2-3-逻辑运算符"><a href="#2-3-逻辑运算符" class="headerlink" title="2.3 逻辑运算符"></a>2.3 逻辑运算符</h2><table>
<thead>
<tr>
<th align="left">运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>and, &amp;&amp;</code></td>
<td>逻辑与</td>
</tr>
<tr>
<td align="left"><code>or, &#124;&#124;</code></td>
<td>逻辑或</td>
</tr>
<tr>
<td align="left"><code>not, !</code></td>
<td>逻辑非</td>
</tr>
<tr>
<td align="left"><code>xor</code></td>
<td>逻辑异或</td>
</tr>
</tbody></table>
<ul>
<li><code>and</code> 优先级高于 <code>or</code></li>
</ul>
<h2 id="2-4-正则"><a href="#2-4-正则" class="headerlink" title="2.4 正则"></a>2.4 正则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regexp pattern</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>^</code></td>
<td>开头</td>
</tr>
<tr>
<td><code>$</code></td>
<td>结尾</td>
</tr>
<tr>
<td>`</td>
<td>`</td>
</tr>
<tr>
<td><code>[abc] [a-z]</code></td>
<td>范围</td>
</tr>
<tr>
<td><code>{n} {m,} {m,n} * + ?</code></td>
<td>数量</td>
</tr>
</tbody></table>
<h2 id="2-5-语句"><a href="#2-5-语句" class="headerlink" title="2.5 语句"></a>2.5 语句</h2><table>
<thead>
<tr>
<th>语句</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>like pattern</code></td>
<td>模糊查询，<code>pattern</code> 中：<code>%</code> 匹配任意个任意字符，<code>_</code> 匹配一个任意字符</td>
</tr>
<tr>
<td><code>between ... and ...</code></td>
<td>在某个范围之间</td>
</tr>
<tr>
<td><code>is null</code></td>
<td>是否为空</td>
</tr>
<tr>
<td><code>is not null</code></td>
<td>是否不为空</td>
</tr>
<tr>
<td><code>in()</code></td>
<td>匹配其中任意一个值，则为 true，类似逻辑或</td>
</tr>
<tr>
<td><code>any()</code></td>
<td>必须配合比较运算符使用，代表（大于, 小于, …）其中任意一个值则为 true</td>
</tr>
<tr>
<td><code>some()</code></td>
<td>是 <code>any()</code> 的别名</td>
</tr>
<tr>
<td><code>all()</code></td>
<td>必须配合比较运算符使用，代表（大于, 小于, …）其中所有值则为 true</td>
</tr>
</tbody></table>
<h1 id="三-变量"><a href="#三-变量" class="headerlink" title="三 变量"></a>三 变量</h1><h2 id="3-1-分类"><a href="#3-1-分类" class="headerlink" title="3.1 分类"></a>3.1 分类</h2><table>
<thead>
<tr>
<th>类型</th>
<th>级别</th>
</tr>
</thead>
<tbody><tr>
<td>系统变量</td>
<td>全局级别，会话级别</td>
</tr>
<tr>
<td>自定义变量</td>
<td>会话级别</td>
</tr>
</tbody></table>
<h2 id="3-2-系统变量"><a href="#3-2-系统变量" class="headerlink" title="3.2 系统变量"></a>3.2 系统变量</h2><h3 id="1-查看系统变量"><a href="#1-查看系统变量" class="headerlink" title="1 查看系统变量"></a>1 查看系统变量</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show global variables</code></td>
<td>查看全局级别所有系统变量的信息</td>
</tr>
<tr>
<td><code>show session variables</code></td>
<td>查看会话级别所有系统变量的信息</td>
</tr>
<tr>
<td><code>select @@global.变量名</code></td>
<td>查看全局级别的指定系统变量的信息</td>
</tr>
<tr>
<td><code>select @@session.变量名</code></td>
<td>查看会话级别的指定系统变量的信息</td>
</tr>
<tr>
<td><code>select @@变量名</code></td>
<td>查看会话级别的指定系统变量的信息</td>
</tr>
</tbody></table>
<h3 id="2-修改系统变量"><a href="#2-修改系统变量" class="headerlink" title="2 修改系统变量"></a>2 修改系统变量</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>set global 变量名=值</code></td>
<td>修改全局级别的系统变量，影响新会话，重启失效</td>
</tr>
<tr>
<td><code>set @@global.变量名=值</code></td>
<td>修改全局级别的系统变量，影响新会话，重启失效</td>
</tr>
<tr>
<td><code>set session 变量名=值</code></td>
<td>修改会话级别的系统变量</td>
</tr>
<tr>
<td><code>set @@session.变量名=值</code></td>
<td>修改会话级别的系统变量</td>
</tr>
</tbody></table>
<h2 id="3-3-自定义变量"><a href="#3-3-自定义变量" class="headerlink" title="3.3 自定义变量"></a>3.3 自定义变量</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>为了区分系统变量, 规定用户自定义变量必须使用一个 <code>@</code> 符号</li>
<li>所有自定义变量不区分数据库</li>
<li>所有自定义的变量都是会话级别，但根据作用域可以分为<ol>
<li>全局变量（user/session variable）: 作用域为当前会话</li>
<li>局部变量（local variable） ：作用域为所在的 <code>begin end</code></li>
</ol>
</li>
</ol>
<h3 id="2-全局变量"><a href="#2-全局变量" class="headerlink" title="2 全局变量"></a>2 全局变量</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>set @变量名=值</code></td>
<td>声明并赋值</td>
</tr>
<tr>
<td><code>set @变量名 := 值</code></td>
<td>声明并赋值</td>
</tr>
<tr>
<td><code>select @变量名 := 值</code></td>
<td>声明并赋值</td>
</tr>
<tr>
<td><code>select 字段 into @变量名 from t_name</code></td>
<td>声明并从表中查询数据赋值</td>
</tr>
<tr>
<td><code>select @变量名</code></td>
<td>查看变量值</td>
</tr>
</tbody></table>
<ul>
<li>全局变量可以不声明直接使用，默认值为 <code>null</code></li>
</ul>
<h3 id="3-局部变量"><a href="#3-局部变量" class="headerlink" title="3 局部变量"></a>3 局部变量</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>declare 变量名 类型</code></td>
<td>声明局部变量</td>
</tr>
<tr>
<td><code>declare 变量名 类型 default 默认值</code></td>
<td>声明局部变量并设置默认值</td>
</tr>
</tbody></table>
<ol>
<li>局部变量需要先声明后使用</li>
<li>局部变量的赋值与查看命令与全局变量完全一致</li>
</ol>
<h1 id="四-函数"><a href="#四-函数" class="headerlink" title="四 函数"></a>四 函数</h1><h2 id="4-1-信息函数"><a href="#4-1-信息函数" class="headerlink" title="4.1 信息函数"></a>4.1 信息函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>user()</code></td>
<td>返回当前用户及所在主机</td>
</tr>
<tr>
<td><code>database()</code></td>
<td>返回当前数据库名</td>
</tr>
<tr>
<td><code>version()</code></td>
<td>返回数据库的版本号</td>
</tr>
<tr>
<td><code>connection_id()</code></td>
<td>返回连接id</td>
</tr>
<tr>
<td><code>last_insert_id()</code></td>
<td>最后插入记录的id</td>
</tr>
</tbody></table>
<h2 id="4-2-数学函数"><a href="#4-2-数学函数" class="headerlink" title="4.2 数学函数"></a>4.2 数学函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>abs(X)</code></td>
<td>绝对值</td>
</tr>
<tr>
<td><code>ceil(X)</code></td>
<td>向上取整</td>
</tr>
<tr>
<td><code>floor(X)</code></td>
<td>向下取整</td>
</tr>
<tr>
<td><code>round(X, D)</code></td>
<td>四舍五入，保留D位小数</td>
</tr>
<tr>
<td><code>truncate(X, D)</code></td>
<td>数字截断，保留D位小数</td>
</tr>
<tr>
<td><code>rand(X)</code></td>
<td><code>0~1</code> 的随机数</td>
</tr>
<tr>
<td><code>mod(N, M)</code></td>
<td>等价于 <code>N % M</code> 或者 <code>N MOD M</code></td>
</tr>
<tr>
<td><code>sort(X)</code></td>
<td>平方</td>
</tr>
<tr>
<td><code>pow(X,Y)</code></td>
<td>Y次方</td>
</tr>
<tr>
<td><code>conv(X, from_base, to_base)</code></td>
<td>将X从进制 <code>from_base</code> 转为进制 <code>to_base</code> 的字符串</td>
</tr>
</tbody></table>
<h2 id="4-3-字符串函数"><a href="#4-3-字符串函数" class="headerlink" title="4.3 字符串函数"></a>4.3 字符串函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>md5(str)</code></td>
<td>返回字符串的 md5 加密版本</td>
</tr>
<tr>
<td><code>password(str)</code></td>
<td>返回字符串的加密版本，41位的字符串</td>
</tr>
<tr>
<td><code>concat(str1, str2, ...)</code></td>
<td>连接字符串，有一个参数为 <code>null</code>，则返回 <code>null</code></td>
</tr>
<tr>
<td><code>concat_ws(separator, str1, str2, ...)</code></td>
<td>使用指定分隔符连接字符串</td>
</tr>
<tr>
<td><code>length(str)</code></td>
<td>字节数</td>
</tr>
<tr>
<td><code>char_length(str)</code></td>
<td>字符数</td>
</tr>
<tr>
<td><code>lower(str)</code></td>
<td>转小写</td>
</tr>
<tr>
<td><code>upper(str)</code></td>
<td>转大写</td>
</tr>
<tr>
<td><code>format(X, D)</code></td>
<td>将数字 X 转为 <code>#,###,###.##</code> 形式的字符串，D为小数位数</td>
</tr>
<tr>
<td><code>trim([{both &#124; leading &#124; trailing}] [remstr from] str)</code></td>
<td>去除两端空格，<code>remstr</code> 默认空格可指定字符</td>
</tr>
<tr>
<td><code>ltrim(str)</code></td>
<td>去除左端空格</td>
</tr>
<tr>
<td><code>rtrim(str)</code></td>
<td>去除右端空格</td>
</tr>
<tr>
<td><code>reverse(str)</code></td>
<td>反转</td>
</tr>
<tr>
<td><code>left(str, len)</code></td>
<td>返回 str 从左开始 <code>len</code> 个字符的字符串</td>
</tr>
<tr>
<td><code>right(str, len)</code></td>
<td>返回 str 从右开始 <code>len</code> 个字符的字符串</td>
</tr>
<tr>
<td><code>substring(str, [from] pos, [[for] len])</code></td>
<td>返回 str 从 <code>pos</code> 开始的len个字符的字符串</td>
</tr>
<tr>
<td><code>substr()</code></td>
<td>等价于  <code>substring()</code></td>
</tr>
<tr>
<td><code>locate(substr, str[, pos])</code></td>
<td>返回子串在 str 中第一次出现的位置，默认从 1 开始，没有则返回 0</td>
</tr>
<tr>
<td><code>instr(str, substr)</code></td>
<td>等价于 <code>locate(substr, str)</code></td>
</tr>
<tr>
<td><code>insert(str, pos, len, newstr)</code></td>
<td>将 str 从 <code>pos</code> 开始的 <code>len</code> 个字符替换为 <code>newstr</code></td>
</tr>
<tr>
<td><code>replace(str, from_str, to_str)</code></td>
<td>替换 str 的子串</td>
</tr>
<tr>
<td><code>strcmp(expr1,expr2)</code></td>
<td>比较两个字符串</td>
</tr>
<tr>
<td><code>repeat(str, count)</code></td>
<td>返回 str 重复 count 次组成的字符串</td>
</tr>
<tr>
<td><code>isnull(expr)</code></td>
<td>判断表达式是否为空</td>
</tr>
</tbody></table>
<h2 id="4-4-日期函数"><a href="#4-4-日期函数" class="headerlink" title="4.4 日期函数"></a>4.4 日期函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>now()</code></td>
<td>返回当前日期和时间 <code>yyyy-MM--dd HH:mm:ss</code></td>
</tr>
<tr>
<td><code>curdate()</code></td>
<td>返回当前日期 <code>yyyy-MM-dd</code></td>
</tr>
<tr>
<td><code>curtime()</code></td>
<td>返回当前时间 <code>HH:mm:ss</code></td>
</tr>
<tr>
<td><code>date_format(date, format)</code></td>
<td>日期格式化</td>
</tr>
<tr>
<td><code>year(date)/month(date)/day(date)/hour(time)</code></td>
<td>返回指定项</td>
</tr>
<tr>
<td><code>extract(year/month/day from now())</code></td>
<td>提取日期中的年月日…</td>
</tr>
<tr>
<td><code>datediff(expr1, expr2)</code></td>
<td>返回 <code>expr1 - expr2</code> 的日期差值</td>
</tr>
<tr>
<td><code>dayofyear(date)</code></td>
<td>返回指定日期是当年的第几天</td>
</tr>
<tr>
<td><code>dayofmonth(date)</code></td>
<td>返回指定日期是当月的第几天</td>
</tr>
<tr>
<td><code>dayofweek(date)</code></td>
<td>返回指定日期是当周的第几天（周日是第一天）</td>
</tr>
<tr>
<td><code>date_add(date, INTERVAL expr unit)</code></td>
<td>给日期加上指定值，unit 用来指定日期项，expr 为值</td>
</tr>
<tr>
<td><code>date_sub(date, INTERVAL expr unit)</code></td>
<td>给日期减去指定值</td>
</tr>
</tbody></table>
<h2 id="4-4-JSON-函数"><a href="#4-4-JSON-函数" class="headerlink" title="4.4 JSON 函数"></a>4.4 JSON 函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>json_array([val[, val ...]])</code></td>
<td>返回由参数组成json数组</td>
</tr>
<tr>
<td><code>json_object([key, val[, key, val ...]])</code></td>
<td>返回由参数组成的 json 对象，奇数参数是 key，偶数参数是 value</td>
</tr>
<tr>
<td><code>json_pretty(json_val)</code></td>
<td>漂亮的打印 json</td>
</tr>
<tr>
<td><code>json_array_append(json_doc, path, val[, path, val ...])</code></td>
<td>在 <code>json_doc</code> 指定位置上的值后追加值</td>
</tr>
<tr>
<td><code>json_array_insert(json_doc, path, val[, path, val ...])</code></td>
<td>向 json 数组指定位置插入值，返回新数组，不改变原有数组</td>
</tr>
<tr>
<td><code>json_insert(json_doc, path, val[, path, val ...])</code></td>
<td>向 json 对象添加新的键值对，返回新对象，不改变原对象</td>
</tr>
<tr>
<td><code>json_set(json_doc, path, val[, path, val ...])</code></td>
<td>替换 <code>json_doc</code> 指定位置现有的值，如果不存在则添加</td>
</tr>
<tr>
<td><code>json_replace(json_doc, path, val[, path, val ...])</code></td>
<td>仅替换现有的值</td>
</tr>
<tr>
<td><code>json_remove(json_doc, path[, path...])</code></td>
<td>删除 <code>json_doc</code> 指定位置的值</td>
</tr>
<tr>
<td><code>json_extract(json_doc, path[, path...])</code></td>
<td>获取 <code>json_doc</code> 指定位置的值</td>
</tr>
<tr>
<td><code>json_contains_path(json_doc, one_or_all, path[, path...])</code></td>
<td>判断是否包含指定路径（索引或者key）</td>
</tr>
<tr>
<td><code>json_contains(target, candidate[, path])</code></td>
<td>判断是否包含指定值</td>
</tr>
<tr>
<td><code>json_length(json_doc[, path])</code></td>
<td>返回 <code>json_doc</code> 的长度</td>
</tr>
</tbody></table>
<h2 id="4-5-自定义函数"><a href="#4-5-自定义函数" class="headerlink" title="4.5 自定义函数"></a>4.5 自定义函数</h2><h3 id="1-语法"><a href="#1-语法" class="headerlink" title="1 语法"></a>1 语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE</span><br><span class="line">	[DEFINER = user]</span><br><span class="line">	FUNCTION sp_name ([func_parameter[,...]])</span><br><span class="line">	RETURNS type</span><br><span class="line">	[characteristic ...] </span><br><span class="line">	routine_body</span><br><span class="line"></span><br><span class="line">func_parameter: </span><br><span class="line">	param_name type</span><br><span class="line">type:</span><br><span class="line">	Any valid MySQL data type</span><br><span class="line">characteristic:</span><br><span class="line">	  COMMENT &apos;string&apos;</span><br><span class="line">	| LANGUAGE SQL</span><br><span class="line">	| [NOT] DETERMINISTIC</span><br><span class="line">	| &#123; CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA &#125;</span><br><span class="line">	| SQL SECURITY &#123; DEFINER | INVOKER &#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-创建"><a href="#2-创建" class="headerlink" title="2 创建"></a>2 创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DROP FUNCTION IF EXISTS 函数名;</span><br><span class="line">DELIMITER 结束标记</span><br><span class="line">CREATE FUNCTION 函数名 ([参数列表]) RETURNS 返回值类型</span><br><span class="line">BEGIN </span><br><span class="line">    函数体</span><br><span class="line">    RETURN 返回值;</span><br><span class="line">END 结束标记</span><br><span class="line">DELIMITER ; -- 将结束标记改回默认分号</span><br></pre></td></tr></table></figure>

<ul>
<li>形参<ul>
<li><code>形参名 形参类型</code></li>
</ul>
</li>
<li>返回值<ul>
<li><code>{STRING | INTEGER | REAL | DECIMAL}</code></li>
<li>必须有返回值且只有一个</li>
</ul>
</li>
</ul>
<h3 id="3-查看"><a href="#3-查看" class="headerlink" title="3 查看"></a>3 查看</h3><ol>
<li><code>show function status [like pattern]</code><ul>
<li>查看所有函数</li>
</ul>
</li>
<li><code>show create function 函数名</code><ul>
<li>查看函数的创建语句</li>
</ul>
</li>
</ol>
<h3 id="4-修改-删除-函数"><a href="#4-修改-删除-函数" class="headerlink" title="4 修改/删除 函数"></a>4 修改/删除 函数</h3><ol>
<li>函数不能修改</li>
<li>删除<ul>
<li><code>drop function [if exists] 函数名</code></li>
</ul>
</li>
</ol>
<h1 id="五-流程控制语句"><a href="#五-流程控制语句" class="headerlink" title="五 流程控制语句"></a>五 流程控制语句</h1><h2 id="5-1-if"><a href="#5-1-if" class="headerlink" title="5.1 if"></a>5.1 if</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">If  条件判断  then</span><br><span class="line">	-- 满足条件要执行的代码;</span><br><span class="line">Else</span><br><span class="line">	-- 不满足条件要执行的代码;</span><br><span class="line">End if;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-while"><a href="#5-2-while" class="headerlink" title="5.2 while"></a>5.2 while</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">While 条件判断 do</span><br><span class="line">	-- 循环体</span><br><span class="line">End while;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-Iterate-amp-Leave"><a href="#5-3-Iterate-amp-Leave" class="headerlink" title="5.3 Iterate &amp; Leave"></a>5.3 Iterate &amp; Leave</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">循环名:While 条件判断 do</span><br><span class="line">	-- 循环体</span><br><span class="line">	itrate/leave 循环名;</span><br><span class="line">End while;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>Iterate</code> 类似 <code>continue</code></li>
<li><code>Leave</code> 类似 <code>break</code></li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/SQL/Mysql%E5%BA%93%E8%A1%A8%E5%88%97%E5%B1%9E%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/SQL/Mysql%E5%BA%93%E8%A1%A8%E5%88%97%E5%B1%9E%E6%80%A7/" class="post-title-link" itemprop="url">Mysql库表列属性</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 21:14:02 / 修改时间：21:16:04" itemprop="dateCreated datePublished" datetime="2020-11-08T21:14:02+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-库表属性"><a href="#一-库表属性" class="headerlink" title="一 库表属性"></a>一 库表属性</h1><h2 id="1-1-字符集（charset）"><a href="#1-1-字符集（charset）" class="headerlink" title="1.1 字符集（charset）"></a>1.1 字符集（charset）</h2><h3 id="1-MySQL-的-UTF-8"><a href="#1-MySQL-的-UTF-8" class="headerlink" title="1 MySQL 的 UTF-8"></a>1 MySQL 的 UTF-8</h3><ol>
<li>MySQL 中的 <code>utf8mb4</code> 才是真正的 <code>UTF-8</code>，而 <code>utf8</code> 是 <code>utf8mb3</code> 的别名，是 MySQL 脑残的产物</li>
<li>MySQL 表示未来会删除 <code>utf8mb3</code>，然后 <code>utf8</code> 指代 <code>utf8mb4</code>（真是个小机灵鬼）</li>
</ol>
<h3 id="2-字符集说明"><a href="#2-字符集说明" class="headerlink" title="2 字符集说明"></a>2 字符集说明</h3><ol>
<li><code>show charset</code><ul>
<li>查看数据库支持的字符集</li>
</ul>
</li>
<li><code>show variables like &#39;character%&#39;</code><ul>
<li>查看数据库默认字符集设置</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>配置</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>character_set_database</code></td>
<td>数据库默认字符集，若没设置则使用 <code>character_set_server</code></td>
</tr>
<tr>
<td><code>character_set_client</code></td>
<td>客户端字符集</td>
</tr>
<tr>
<td><code>character_set_connection</code></td>
<td>客户端连接数据库使用的字符集</td>
</tr>
<tr>
<td><code>character_set_results</code></td>
<td>数据库给客户端返回数据使用的字符集</td>
</tr>
<tr>
<td><code>character_set_server</code></td>
<td>服务器字符集，建议由系统自己管理，不要人为定义</td>
</tr>
<tr>
<td><code>character_set_filesystem</code></td>
<td>用于将系统文件名转化成此字符集，默认 <code>binary</code> 不做转换（建议不改动）</td>
</tr>
<tr>
<td><code>character_set_system</code></td>
<td>数据库系统用来存储元数据的编码，通常是 <code>utf8</code>（不要改动）</td>
</tr>
<tr>
<td><code>character_sets_dir</code></td>
<td>字符集安装目录</td>
</tr>
</tbody></table>
<h3 id="3-乱码问题"><a href="#3-乱码问题" class="headerlink" title="3 乱码问题"></a>3 乱码问题</h3><h4 id="1-存"><a href="#1-存" class="headerlink" title="1 存"></a>1 存</h4><ul>
<li><code>数据本身字符集</code> → <code>客户端字符集</code> → <code>连接字符集</code> → <code>数据库字符集</code><ol>
<li><code>数据本身字符集 = 客户端字符集</code>，若不一致则会乱码</li>
<li>将数据从 <code>客户端字符集</code> 转为 <code>连接字符集</code>，若一致则不转换</li>
<li>将数据从 <code>连接字符集</code> 转为 <code>数据库字符集</code>，若一致则不转换</li>
<li>存数据最终是按照 <code>数据库字符集</code> 存储</li>
</ol>
</li>
<li>结论<ol>
<li>保证 <code>数据本身字符集 = 客户端字符集</code></li>
<li>连接字符集不要太小导致转换损失数据</li>
</ol>
</li>
</ul>
<h4 id="2-取"><a href="#2-取" class="headerlink" title="2 取"></a>2 取</h4><ul>
<li><code>数据库字符集</code> → <code>连接字符集</code> → <code>结果字符集</code> → <code>客户端字符集</code><ol>
<li>将数据从 <code>数据库字符集</code> 转为 <code>连接字符集</code> ，若一致则不转换</li>
<li>将数据从 <code>连接字符集</code> 转为 <code>结果字符集</code>，若一致则不转换</li>
<li>取数据最终是按照结果字符集返回给客户端</li>
<li>比较 <code>结果字符集</code> 与 <code>客户端字符集</code> 是否一致</li>
</ol>
</li>
<li>结论<ol>
<li>保证 <code>结果字符集 = 客户端字符集</code></li>
<li>连接字符集不要太小导致转换损失数据</li>
</ol>
</li>
</ul>
<h2 id="1-2-校对集（collation）"><a href="#1-2-校对集（collation）" class="headerlink" title="1.2 校对集（collation）"></a>1.2 校对集（collation）</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>校对集，就是数据的比较方式，或者排序规则</li>
<li>只有当数据产生比较的时候，校对集才会生效</li>
<li>必须在没有数据之前声明好校对集，如果有了数据再进行校对集修改，修改无效</li>
<li>校对集依赖字符集，每个字符集都对应 1 或 多个校对集，如 <code>utf8mb4</code> 默认校对集 <code>utf8mb4_general_ci</code></li>
</ol>
<h3 id="2-校对集格式"><a href="#2-校对集格式" class="headerlink" title="2 校对集格式"></a>2 校对集格式</h3><ul>
<li><code>show collation</code><ul>
<li>查看数据库支持的校对集</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>格式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>_bin</code></td>
<td><code>binary</code>，二进制比较, 大小写敏感（适用比较特殊的数据，如拼音，日文…）</td>
</tr>
<tr>
<td><code>_ci</code></td>
<td><code>case insensitive</code>，大小写不敏感</td>
</tr>
<tr>
<td><code>_cs</code></td>
<td><code>case sensitive</code>，大小写敏感</td>
</tr>
</tbody></table>
<h2 id="1-3-存储引擎（engine）"><a href="#1-3-存储引擎（engine）" class="headerlink" title="1.3 存储引擎（engine）"></a>1.3 存储引擎（engine）</h2><h3 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>MySQL进行存储数据的方式。</li>
<li>每一种存储引擎使用不同的存储机制，索引技巧，锁定水平，最终提供广泛且不同的功能。</li>
</ol>
<h3 id="2-分类"><a href="#2-分类" class="headerlink" title="2 分类"></a>2 分类</h3><ol>
<li><code>show engines</code><ul>
<li>查看支持的存储引擎</li>
</ul>
</li>
<li><code>select @@default_storage_engine</code><ul>
<li>查看默认的存储引擎</li>
</ul>
</li>
<li><code>alter table 表名 engine=存储引擎</code><ul>
<li>除了修改存储引擎外，还会做碎片整理</li>
</ul>
</li>
</ol>
<table>
<thead>
<tr>
<th>存储引擎</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>InnoDB</code></td>
<td>新版 MySQL 默认存储引擎</td>
</tr>
<tr>
<td><code>Myisam</code></td>
<td>速度快，不支持事务，安全性不够</td>
</tr>
<tr>
<td><code>Memory</code></td>
<td>数据存在内存中，不存在磁盘，一关闭服务器就消失。适合临时数据</td>
</tr>
<tr>
<td><code>XtraDB</code></td>
<td><code>PerconaDB</code> 默认存储引擎</td>
</tr>
<tr>
<td><code>TokuDB RocksDB MyRocks</code></td>
<td>第三方存储引擎：共同点是压缩比较高,数据插入性能极高</td>
</tr>
</tbody></table>
<h3 id="3-InnoDB"><a href="#3-InnoDB" class="headerlink" title="3 InnoDB"></a>3 InnoDB</h3><h4 id="1-特性"><a href="#1-特性" class="headerlink" title="1 特性"></a>1 特性</h4><ol>
<li>事务（Transaction）</li>
<li>行级锁（Row-level Lock）</li>
<li>多版本并发控制 MVCC（Multi-Version Concurrency Control）</li>
<li>自动故障安全恢复 ACSR（Auto Crash Safey Recovery）</li>
<li>热备份（Hot Backup）</li>
<li>外键</li>
<li>复制 Replication<ol>
<li>Group Commit</li>
<li>GTID (Global Transaction ID)</li>
<li>多线程（Multi-Threads-SQL）</li>
</ol>
</li>
</ol>
<h4 id="2-物理存储结构"><a href="#2-物理存储结构" class="headerlink" title="2 物理存储结构"></a>2 物理存储结构</h4><h5 id="1-共享表空间"><a href="#1-共享表空间" class="headerlink" title="1 共享表空间"></a>1 共享表空间</h5><table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>idbdata1</code></td>
<td>系统数据字典信息（统计信息），Undo 回滚日志等数据</td>
</tr>
<tr>
<td><code>ib_logfile0~ib_logfile1</code></td>
<td>Redo 重做日志文件，事务日志文件</td>
</tr>
<tr>
<td><code>ibtmp1</code></td>
<td>临时表空间，存储临时表（如 join union 等操作）</td>
</tr>
</tbody></table>
<h5 id="2-独立表空间"><a href="#2-独立表空间" class="headerlink" title="2 独立表空间"></a>2 独立表空间</h5><table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>.frm</code></td>
<td>存储表列信息（列名，列属性）</td>
</tr>
<tr>
<td><code>.ibd</code></td>
<td>存储表数据行和索引</td>
</tr>
<tr>
<td><code>opt</code></td>
<td>存储库属性</td>
</tr>
</tbody></table>
<ul>
<li>一张 InnoDB 表 = <code>ibdata1 + frm + ibd（段、区、页）</code></li>
</ul>
<h5 id="3-表空间（Tablespace）说明"><a href="#3-表空间（Tablespace）说明" class="headerlink" title="3 表空间（Tablespace）说明"></a>3 表空间（Tablespace）说明</h5><ol>
<li>共享表空间：将所有数据存储到同一个表空间中 ，管理比较混乱</li>
<li>独立表空间：一张表一个 <code>frm</code> 存储列信息，一个 <code>ibd</code> 存储数据行和索引</li>
<li>说明<ol>
<li>共享表空间是 5.5 版本出现的管理模式</li>
<li>5.6 版本开始默认使用独立表空间，保留共享表空间，只用来存储：数据字典信息，undo，临时表</li>
<li>5.7 版本临时表被独立出去，共享表空间只存储：数据字典信息，undo</li>
<li>8.0 版本undo也被独立出去，共享表空间只存储：数据字典信息</li>
</ol>
</li>
</ol>
<h3 id="4-核心参数"><a href="#4-核心参数" class="headerlink" title="4 核心参数"></a>4 核心参数</h3><h4 id="1-存储引擎"><a href="#1-存储引擎" class="headerlink" title="1 存储引擎"></a>1 存储引擎</h4><ol>
<li><code>default_storage_engine=innodb</code><ul>
<li>默认存储引擎</li>
</ul>
</li>
</ol>
<h4 id="2-表空间"><a href="#2-表空间" class="headerlink" title="2 表空间"></a>2 表空间</h4><ol>
<li><code>innobd_file_pre_table=1</code><ul>
<li>表空间模式，1 独立表空间</li>
</ul>
</li>
<li><code>innodb_data_file_path=ibdata1:512M:ibdata2:512M:autoextend</code><ul>
<li>共享表空间文件个数和大小</li>
</ul>
</li>
</ol>
<h4 id="3-缓冲区"><a href="#3-缓冲区" class="headerlink" title="3 缓冲区"></a>3 缓冲区</h4><ol>
<li><code>innodb_flush_log_at_trx_commit=1</code><ul>
<li>双一标准之一</li>
<li>控制了 innodb 将 <code>log buffer</code> 中的数据写入日志文件并 flush 磁盘的时间点，取值分别为 0、1、2 三个</li>
</ul>
</li>
<li><code>Innodb_flush_method=(O_DIRECT, fdatasync)</code><ul>
<li>双一标准之一</li>
<li>控制 <code>log buffer</code> 和 <code>data buffer</code> 刷写磁盘的时候是否经过文件系统缓存 <code>OS buffer</code></li>
</ul>
</li>
<li><code>innodb_max_dirty_pages_pct=75</code><ul>
<li>脏页刷写策略</li>
</ul>
</li>
</ol>
<h4 id="4-redo-日志"><a href="#4-redo-日志" class="headerlink" title="4 redo 日志"></a>4 redo 日志</h4><ol>
<li><code>innodb_log_buffer_size</code></li>
<li><code>innodb_log_file_size</code></li>
<li><code>innodb_log_files_in_group</code></li>
</ol>
<h1 id="二-列属性"><a href="#二-列属性" class="headerlink" title="二 列属性"></a>二 列属性</h1><h2 id="2-1-数据类型"><a href="#2-1-数据类型" class="headerlink" title="2.1 数据类型"></a>2.1 数据类型</h2><h3 id="1-数值类型"><a href="#1-数值类型" class="headerlink" title="1 数值类型"></a>1 数值类型</h3><h4 id="1-整型"><a href="#1-整型" class="headerlink" title="1 整型"></a>1 整型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>大小</th>
<th>无符号范围</th>
<th>有符号范围</th>
</tr>
</thead>
<tbody><tr>
<td><strong>tinyint</strong></td>
<td>1 Byte</td>
<td><code>0 ~ 255</code></td>
<td><code>-128 ~ 127</code></td>
</tr>
<tr>
<td><code>smallint</code></td>
<td>2 Byte</td>
<td><code>0 ~ 65535</code></td>
<td><code>-2<sup>15</sup> ~ 2<sup>15</sup>-1</code></td>
</tr>
<tr>
<td><code>mediumint</code></td>
<td>3 Byte</td>
<td><code>0 ~ 2<sup>24</sup>-1</code>`</td>
<td><code>-2<sup>23</sup> ~ 2<sup>23</sup>-1</code></td>
</tr>
<tr>
<td><strong>int</strong></td>
<td>4 Byte</td>
<td><code>0 ~ 2<sup>32</sup>-1</code>`</td>
<td><code>-2<sup>31</sup> ~ 2<sup>31</sup>-1</code></td>
</tr>
<tr>
<td><code>bigint</code></td>
<td>8 Byte</td>
<td><code>0 ~ 2<sup>64</sup>-1</code>`</td>
<td><code>-2<sup>63</sup> ~ 2<sup>63</sup>-1</code></td>
</tr>
</tbody></table>
<ul>
<li><code>int(M)</code><ul>
<li><code>M</code> 与存储无关，只是标识显示长度，且要配合 <code>zerofill</code> 才有意义</li>
</ul>
</li>
</ul>
<h4 id="2-浮点型-amp-定点型"><a href="#2-浮点型-amp-定点型" class="headerlink" title="2 浮点型 &amp; 定点型"></a>2 浮点型 &amp; 定点型</h4><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>语法</th>
<th><code>M</code></th>
<th><code>D</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>float</code></td>
<td>单精度浮点型 4 Byte</td>
<td><code>float(M,D)</code></td>
<td>总位数</td>
<td>小数点后的位数（不足用0补，超过则四舍五入）</td>
</tr>
<tr>
<td><code>double</code></td>
<td>双精度浮点型 8 Byte</td>
<td><code>double(M,D)</code></td>
<td>总位数</td>
<td>小数点后的位数（不足用0补，超过则四舍五入）</td>
</tr>
<tr>
<td><code>decimal</code></td>
<td>定点型，底层使用字符串存储</td>
<td><code>decimal(M,D)</code></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-字符串类型"><a href="#2-字符串类型" class="headerlink" title="2 字符串类型"></a>2 字符串类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>语法</th>
<th><code>M</code></th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>char</strong></td>
<td>定长字符串</td>
<td><code>char(M)</code></td>
<td>字符数 <code>[1,255]</code></td>
<td>char 会立即分配 M 个字符长度的存储空间，未占满用空格填充</td>
</tr>
<tr>
<td><strong>varchar</strong></td>
<td>变长字符串</td>
<td><code>varchar(M)</code></td>
<td>最大字符数 <code>[1,65535]</code></td>
<td>varchar 存储前会先判断长度，按需分配空间</td>
</tr>
<tr>
<td><code>tinytext</code></td>
<td>短文本</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>text</code></td>
<td>文本</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>mediumtext</code></td>
<td>中长文本</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>longtext</code></td>
<td>长文本</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="1-char"><a href="#1-char" class="headerlink" title="1 char"></a>1 char</h4><ol>
<li>非空 char 的最大长度是 255【字节】</li>
<li>可空 char 的最大长度是 254【字节】，因为允许为空时，系统会自动从整个记录中保留一个字节来存储 NULL</li>
</ol>
<h4 id="2-varchar"><a href="#2-varchar" class="headerlink" title="2 varchar"></a>2 varchar</h4><ol>
<li>非空 varchar 的最大长度是 65532【字节】<ol>
<li>如果存储值小于 255 字节，则使用 1 个字节标记长度</li>
<li>如果存储值超过 255 字节，则使用 2 个字节标记长度</li>
<li>varchar是从第二个字节开始存储的</li>
</ol>
</li>
<li>可空 varchar 的最大长度是 65531【字节】</li>
</ol>
<h4 id="3-以-utf8-为例比较"><a href="#3-以-utf8-为例比较" class="headerlink" title="3 以 utf8 为例比较"></a>3 以 utf8 为例比较</h4><table>
<thead>
<tr>
<th>类型</th>
<th>可存字符</th>
<th>实存字符</th>
<th>实占字节</th>
<th>利用率</th>
</tr>
</thead>
<tbody><tr>
<td><code>char(M)</code></td>
<td>M</td>
<td>n</td>
<td><code>M * 3</code></td>
<td><code>n / M</code></td>
</tr>
<tr>
<td><code>varchar(M)</code></td>
<td>M</td>
<td>n</td>
<td><code>n * 3 + (1~2)</code></td>
<td><code>n * 3 / （n * 3 + (1~2)）</code></td>
</tr>
</tbody></table>
<h3 id="3-枚举-enum"><a href="#3-枚举-enum" class="headerlink" title="3 枚举 enum"></a>3 枚举 enum</h3><ul>
<li><code>enum(value1, value2, value3, ...)</code><ol>
<li>建表时在字段上定义枚举列表，按照定义顺序索引值从 1 开始编号<ul>
<li>空字符串 <code>&quot;&quot;</code> 索引为 0</li>
<li><code>null</code> 索引为 <code>null</code></li>
</ul>
</li>
<li>插入数据时（单选），可以使用索引值或者枚举值</li>
<li>数据库存储时存储索引，读取时再根据枚举列表将索引转为枚举值</li>
</ol>
</li>
</ul>
<h3 id="4-集合-set"><a href="#4-集合-set" class="headerlink" title="4 集合 set"></a>4 集合 set</h3><ul>
<li><code>set(value1, value2, value3, ...)</code><ol>
<li>建表时在字段上定义集合列表，集合中每个值对应一个二进制位<ul>
<li>第一个值对应 <code>1 = 1</code></li>
<li>第二个值对应 <code>10 = 2</code></li>
<li>第三个值对应 <code>100 = 4</code></li>
<li>第四个值对应 <code>1000 = 8</code></li>
<li>…</li>
<li>也就是说一个二进制数，从低位向高位依次对应集合从 1 开始的值</li>
</ul>
</li>
<li>插入数据时（多选），可以使用二进制对应的十进制数字，插入数字对应的二进制，相应位置为 1 代表插入该值，例如<ul>
<li>插入 <code>6</code>，转为二进制 <code>110</code>，即插入第二和第三个值</li>
<li>插入 <code>7</code>，转为二进制 <code>111</code>，即插入前三个值</li>
<li>插入 <code>8</code>，转为二进制 <code>1000</code>，即插入第四个值</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="5-日期类型"><a href="#5-日期类型" class="headerlink" title="5 日期类型"></a>5 日期类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>格式</th>
<th>大小</th>
<th>最小值</th>
<th>最大值</th>
<th>零值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>datetime</strong></td>
<td><code>yyyy-mm-dd hh:mm:ss</code></td>
<td>8 Byte</td>
<td><code>1000-01-01 00:00:00</code></td>
<td><code>9999-12-31 23:59:59</code></td>
<td><code>0000-00-00 00:00:00</code></td>
<td>表示日期时间</td>
</tr>
<tr>
<td><strong>timestamp</strong></td>
<td><code>yyyy-mm-dd hh:mm:ss</code></td>
<td>4 Byte</td>
<td><code>1970-01-01 00:00:00</code></td>
<td><code>2038-01-19 03:14:07</code></td>
<td><code>0000-00-00 00:00:00</code></td>
<td></td>
</tr>
<tr>
<td><code>date</code></td>
<td><code>yyyy-mm-dd</code></td>
<td>3 Byte</td>
<td><code>1000-01-01</code></td>
<td><code>9999-12-31</code></td>
<td><code>0000-00-00</code></td>
<td>表示日期</td>
</tr>
<tr>
<td><code>time</code></td>
<td><code>hh:mm:ss</code></td>
<td>3 Byte</td>
<td><code>-838:59:59</code></td>
<td><code>838:59:59</code></td>
<td><code>00:00:00</code></td>
<td>表示时间</td>
</tr>
</tbody></table>
<ol>
<li><code>datatime</code><ul>
<li>存储日期时间</li>
</ul>
</li>
<li><code>timestamp</code><ol>
<li>时间戳（从 <code>1970-01-01 00:00:00</code> 到指定时间的毫秒值）</li>
<li>存储毫秒值，显示时，根据毫秒值计算出一个本地化的日期时间（即可以自动根据时区显示）</li>
<li><code>timestamp</code> 因为存储的毫秒值，比较或计算时效率更高</li>
<li>插入时未指定值或插入 <code>null</code>，则会插入系统当前时间</li>
</ol>
</li>
<li>插入 Mysql 的日期时间格式为  <code>yyyy-MM-dd HH:mm:ss</code></li>
</ol>
<h3 id="6-二进制类型"><a href="#6-二进制类型" class="headerlink" title="6 二进制类型"></a>6 二进制类型</h3><table>
<thead>
<tr>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>tinyblob</code></td>
<td>最大长度为255B</td>
</tr>
<tr>
<td><code>blob</code></td>
<td>最大长度为64KB</td>
</tr>
<tr>
<td><code>mediumblob</code></td>
<td>最大长度为16MB</td>
</tr>
<tr>
<td><code>longblob</code></td>
<td>最大长度为4GB</td>
</tr>
</tbody></table>
<ul>
<li>二进制数据类型可存储任何数据（甚至包括二进制信息），如图像、多媒体、字处理文档等</li>
</ul>
<h2 id="2-2-注释"><a href="#2-2-注释" class="headerlink" title="2.2 注释"></a>2.2 注释</h2><ul>
<li><code>comment &#39;注释&#39;</code><ul>
<li>用于描述字段信息</li>
</ul>
</li>
</ul>
<h2 id="2-3-unsigned"><a href="#2-3-unsigned" class="headerlink" title="2.3 unsigned"></a>2.3 unsigned</h2><ul>
<li><code>unsigned</code><ol>
<li>将数值类型声明为无符号</li>
<li>MySQL 中的数值默认都是有符号的。</li>
</ol>
</li>
</ul>
<h2 id="2-4-zerofill"><a href="#2-4-zerofill" class="headerlink" title="2.4 zerofill"></a>2.4 zerofill</h2><ul>
<li><code>zerofill</code><ol>
<li>数值类型的列位数不足时用 0 补填充</li>
<li>如果声明 <code>zerofill</code>，则会自动声明为 <code>unsigned</code></li>
</ol>
</li>
</ul>
<h2 id="2-5-自增长"><a href="#2-5-自增长" class="headerlink" title="2.5 自增长"></a>2.5 自增长</h2><h3 id="1-添加自增长"><a href="#1-添加自增长" class="headerlink" title="1 添加自增长"></a>1 添加自增长</h3><ul>
<li><code>字段 auto_increment</code><ol>
<li>一张表只能有一个自增长，因为一张表只有一个维护自增长的变量</li>
<li>自增的列必须是整数列</li>
<li>自增的列必须是键列（主键，唯一键，外键）</li>
<li>建表后，增删自增长通过修改列属性来实现</li>
</ol>
</li>
</ul>
<h3 id="2-使用自增长"><a href="#2-使用自增长" class="headerlink" title="2 使用自增长"></a>2 使用自增长</h3><ol>
<li>自增列指定了值且非 <code>0 null</code>，则使用指定值<ol>
<li>如果指定值 &lt; 自增值，则表的自增值不变</li>
<li>如果指定值 &gt; 自增值，则表的自增值会变成指定值</li>
</ol>
</li>
<li>使用自增值<ol>
<li>自增列没有指定值</li>
<li>自增列指定值为 <code>0 null default</code></li>
</ol>
</li>
</ol>
<h3 id="3-自增长管理"><a href="#3-自增长管理" class="headerlink" title="3 自增长管理"></a>3 自增长管理</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>show variables like &#39;auto_increment%&#39;</code></td>
<td>查看自增长初始值和种子</td>
</tr>
<tr>
<td><code>select last_insert_id()</code></td>
<td>获取自增的最后一个值</td>
</tr>
<tr>
<td><code>show create database 库名</code></td>
<td>通过查看表创建语句查看下一次自增长的值</td>
</tr>
<tr>
<td><code>alter table 表名 auto_increment = 值</code></td>
<td>修改自增长的值，只能比当前自增长的最大值大，不能小（小则不生效）</td>
</tr>
</tbody></table>
<h2 id="2-6-约束（Constraint）"><a href="#2-6-约束（Constraint）" class="headerlink" title="2.6 约束（Constraint）"></a>2.6 约束（Constraint）</h2><h3 id="1-概述-2"><a href="#1-概述-2" class="headerlink" title="1 概述"></a>1 概述</h3><table>
<thead>
<tr>
<th>约束</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Primary key</code></td>
<td>主键约束</td>
<td>唯一，非空，一张表只能有一个</td>
</tr>
<tr>
<td><code>Foreign key</code></td>
<td>外键约束</td>
<td>用于在两表之间建立关系，需指定引用主表的哪一列</td>
</tr>
<tr>
<td><code>Unique key</code></td>
<td>唯一键约束</td>
<td>唯一，非空，一张表可有多个唯一键</td>
</tr>
<tr>
<td><code>Not Null</code></td>
<td>非空约束</td>
<td>要求该列值不能为空</td>
</tr>
<tr>
<td><code>Default</code></td>
<td>默认约束</td>
<td>设置该列默认值</td>
</tr>
<tr>
<td><code>Check</code></td>
<td>检查约束（Mysql 不支持）</td>
<td>限制该列取值范围是否合适</td>
</tr>
</tbody></table>
<ul>
<li><code>select * from information_schema.table_constraints where table_name = &#39;表名&#39;</code><ul>
<li>查看某表的约束信息</li>
<li>表的约束信息存储在 <code>information_shcema</code> 数据库的 <code>table_constraints</code> 表中</li>
</ul>
</li>
</ul>
<h3 id="2-主键约束"><a href="#2-主键约束" class="headerlink" title="2 主键约束"></a>2 主键约束</h3><h4 id="1-概述-3"><a href="#1-概述-3" class="headerlink" title="1 概述"></a>1 概述</h4><ol>
<li>主键列唯一，非空，一张表只能有一个主键</li>
<li>主键分为：<ol>
<li>单列主键（单列） </li>
<li>复合主键（多列）</li>
</ol>
</li>
<li>创建主键会自动创建对应的索引，删除主键会自动删除对应的索引</li>
<li>主键无法修改</li>
<li>主键约束名称为 <code>PRIMARY</code></li>
</ol>
<h4 id="2-添加主键约束"><a href="#2-添加主键约束" class="headerlink" title="2 添加主键约束"></a>2 添加主键约束</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>字段 primaray key</code></td>
<td>建表时，为当前列添加单列主键</td>
</tr>
<tr>
<td><code>primary key(字段列表)</code></td>
<td>建表时，单独一行，添加单列主键或复合主键</td>
</tr>
<tr>
<td><code>alter table 表名 add primary key(字段列表)</code></td>
<td>建表后，添加单列主键或复合主键</td>
</tr>
</tbody></table>
<h4 id="3-删除主键约束"><a href="#3-删除主键约束" class="headerlink" title="3 删除主键约束"></a>3 删除主键约束</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alter table 表名 drop primary key</code></td>
<td>有自增长先要删除自增长，因为自增长的列必须有索引</td>
</tr>
</tbody></table>
<h3 id="3-唯一键约束"><a href="#3-唯一键约束" class="headerlink" title="3 唯一键约束"></a>3 唯一键约束</h3><h4 id="1-概述-4"><a href="#1-概述-4" class="headerlink" title="1 概述"></a>1 概述</h4><ol>
<li>唯一约束列唯一，可以为 <code>null</code>，且可以有多个 <code>null</code>，因为 <code>null = null -&gt; false</code></li>
<li>一张表可以有多个唯一约束 </li>
<li>唯一键分为：<ol>
<li>单列唯一键（约束名：列名）</li>
<li>复合唯一键（约束名：该多列组合的第一列的列名）</li>
</ol>
</li>
<li>创建唯一键约束会自动创建对应的索引，删除唯一键约束是通过删除对应索引来删除</li>
</ol>
<h4 id="2-添加唯一键约束"><a href="#2-添加唯一键约束" class="headerlink" title="2 添加唯一键约束"></a>2 添加唯一键约束</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>字段 unique key</code></td>
<td>建表时，为当前列添加单列唯一键</td>
</tr>
<tr>
<td><code>unique key(字段列表)</code></td>
<td>建表时，单独一行，添加单列唯一键或复合唯一键</td>
</tr>
<tr>
<td><code>alter table 表名 add unique key(字段列表)</code></td>
<td>建表后，添加单列唯一键或复合唯一键</td>
</tr>
</tbody></table>
<h4 id="3-删除唯一键约束"><a href="#3-删除唯一键约束" class="headerlink" title="3 删除唯一键约束"></a>3 删除唯一键约束</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alter table 表名 drop [index/key] 唯一键约束名</code></td>
<td>通过删除索引删除唯一键约束</td>
</tr>
</tbody></table>
<h3 id="4-外键约束"><a href="#4-外键约束" class="headerlink" title="4 外键约束"></a>4 外键约束</h3><h4 id="1-概述-5"><a href="#1-概述-5" class="headerlink" title="1 概述"></a>1 概述</h4><ol>
<li>外键约束建立在从表之上，一个表可以有多个外键约束</li>
<li>主表和从表必须使用相同的存储引擎 <code>InnoDB</code>，且禁止使用临时表</li>
<li>从表的外键列和主表的被引用列的名称可以不同，列属性必须一致</li>
<li>主表被引用列必须是键列</li>
<li>从表添加外键约束时会自动创建索引，删除外键约束不会删除索引</li>
</ol>
<h4 id="2-外键约束模式"><a href="#2-外键约束模式" class="headerlink" title="2 外键约束模式"></a>2 外键约束模式</h4><h5 id="1-概述-6"><a href="#1-概述-6" class="headerlink" title="1 概述"></a>1 概述</h5><ol>
<li>外键约束同时约束双方行为<ul>
<li>主表：<code>update delete</code><ul>
<li>因为从表有可能引用了主表要更新或删除的数据</li>
</ul>
</li>
<li>从表：<code>insert update</code><ul>
<li>从表的数据必须存在于主表之中</li>
</ul>
</li>
</ul>
</li>
<li>建表时：先建主表再建从表，删表时：先删从表再删主表</li>
<li>删除和修改可以分别指定外键约束模式<ol>
<li><code>on update 模式</code></li>
<li><code>on delete 模式</code></li>
</ol>
</li>
</ol>
<h5 id="2-模式"><a href="#2-模式" class="headerlink" title="2 模式"></a>2 模式</h5><table>
<thead>
<tr>
<th>模式</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>restrict（默认）</code></td>
<td>严格模式</td>
<td>如果从表外键列有引用，则主表不能 <code>update/delete</code> 被引用列的值</td>
</tr>
<tr>
<td><code>no action</code></td>
<td>严格模式</td>
<td>标准 SQL 的关键字，在 MySQL 中同 <code>restrict</code></td>
</tr>
<tr>
<td><code>cascade</code></td>
<td>级联模式</td>
<td>主表被引用列的值<br>1. <code>update</code>，则从表外键列对应值 <code>update</code><br>2. <code>delete</code> ，则从表删除对应的整行记录</td>
</tr>
<tr>
<td><code>set null</code></td>
<td>置空模式</td>
<td>主表被引用列的值 <code>update/delete</code> 时， 从表外键列对应值设为 <code>null</code>（外键列要可以为空）</td>
</tr>
<tr>
<td><code>set default</code></td>
<td>默认值模式</td>
<td>Mysql Innodb不支持</td>
</tr>
</tbody></table>
<h4 id="3-添加外键约束"><a href="#3-添加外键约束" class="headerlink" title="3 添加外键约束"></a>3 添加外键约束</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>foreign key(从表外键列) references 主表名(被引用列) [on delete 模式 on update 模式]</code></td>
<td>建表时，单独一行，添加外键约束</td>
</tr>
<tr>
<td><code>alter table 从表名 add foreign key(从表外键列) references 主表名(被引用列) [on delete 模式 on update 模式]</code></td>
<td>建表后，添加外键约束</td>
</tr>
</tbody></table>
<h4 id="4-删除外键约束"><a href="#4-删除外键约束" class="headerlink" title="4 删除外键约束"></a>4 删除外键约束</h4><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>alter table 表名 drop foreign key 外键约束名</code></td>
<td>外键约束名通过系统库 <code>information_schema</code> 的 <code>table_constraints</code> 获取</td>
</tr>
</tbody></table>
<h3 id="5-非空约束"><a href="#5-非空约束" class="headerlink" title="5 非空约束"></a>5 非空约束</h3><ul>
<li><code>not null</code><ol>
<li>列不能为 <code>null</code>，必须插入值，通常配合 <code>default</code> 使用</li>
<li>建表后，增删非空约束通过修改列属性来实现</li>
</ol>
</li>
</ul>
<h3 id="6-默认约束"><a href="#6-默认约束" class="headerlink" title="6 默认约束"></a>6 默认约束</h3><ul>
<li><code>字段 default 默认值</code><ol>
<li>使用默认值<ol>
<li>对应字段没有插入值</li>
<li>对应字段插入值为 <code>default</code></li>
</ol>
</li>
<li>建表后，增删默认约束通过修改列属性来实现</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/anyeansan.github.io/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/anyeansan.github.io/page/8/">8</a><a class="extend next" rel="next" href="/anyeansan.github.io/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          秘笈
        </li>
        <li class="sidebar-nav-overview">
          安₃
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="安₃"
      src="/anyeansan.github.io/images/an3.png">
  <p class="site-author-name" itemprop="name">安₃</p>
  <div class="site-description" itemprop="description">一蓑烟雨任平生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/anyeansan.github.io/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">琅嬛福地</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/anyeansan.github.io/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">门派</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/anyeansan.github.io/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-star-half-full"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">安₃</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/anyeansan.github.io/lib/anime.min.js"></script>
  <script src="/anyeansan.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/anyeansan.github.io/lib/velocity/velocity.ui.min.js"></script>
<script src="/anyeansan.github.io/js/utils.js"></script><script src="/anyeansan.github.io/js/motion.js"></script>
<script src="/anyeansan.github.io/js/schemes/pisces.js"></script>
<script src="/anyeansan.github.io/js/next-boot.js"></script>



  




  <script src="/anyeansan.github.io/js/local-search.js"></script>













  

  

</body>
</html>
