<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/anyeansan.github.io/images/an-apple-180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/anyeansan.github.io/images/an-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/anyeansan.github.io/images/an-16.png">
  <link rel="mask-icon" href="/anyeansan.github.io/images/an.svg" color="#222">
  <link rel="alternate" href="/anyeansan.github.io/atom.xml" title="安₃" type="application/atom+xml">

<link rel="stylesheet" href="/anyeansan.github.io/css/main.css">


<link rel="stylesheet" href="/anyeansan.github.io/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/anyeansan.github.io/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="一蓑烟雨任平生">
<meta property="og:type" content="website">
<meta property="og:title" content="安₃">
<meta property="og:url" content="https:&#x2F;&#x2F;anyeansan.github.io&#x2F;page&#x2F;6&#x2F;">
<meta property="og:site_name" content="安₃">
<meta property="og:description" content="一蓑烟雨任平生">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://anyeansan.github.io/page/6/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>安₃</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/anyeansan.github.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">安₃</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">我未成名君未嫁 可能俱是不如人</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/anyeansan.github.io/" rel="section"><i class="fa fa-fw fa-home"></i>安府</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/anyeansan.github.io/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>琅嬛福地</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/anyeansan.github.io/categories/" rel="section"><i class="fa fa-fw fa-th"></i>门派</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/anyeansan" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/" class="post-title-link" itemprop="url">过滤器和监听器</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:52:35 / 修改时间：20:54:22" itemprop="dateCreated datePublished" datetime="2020-11-08T20:52:35+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-过滤器-Filter"><a href="#一-过滤器-Filter" class="headerlink" title="一 过滤器 Filter"></a>一 过滤器 Filter</h1><h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><ol>
<li>过滤器可以过滤客户端和 WEB 资源之间的请求和响应信息</li>
<li>一般用于完成通用的操作。如：登录验证、统一编码处理、敏感字符过滤…</li>
<li>过滤器都需要直接或间接实现 <code>javax.servlet.Filter</code> 接口</li>
<li>创建过滤器可以继承 <code>javax.servlet.http.HttpFilter</code></li>
</ol>
<h2 id="1-2-API"><a href="#1-2-API" class="headerlink" title="1.2 API"></a>1.2 API</h2><h3 id="1-javax-servlet-Filter"><a href="#1-javax-servlet-Filter" class="headerlink" title="1 javax.servlet.Filter"></a>1 <code>javax.servlet.Filter</code></h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>init(FilterConfig config)</code></td>
<td>初始化</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>doFilter(ServletRequest req, ServletResponse res, FilterChain chain)</code></td>
<td>过滤方法</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>destroy()</code></td>
<td>销毁</td>
</tr>
</tbody></table>
<h3 id="2-javax-servlet-http-HttpFilter"><a href="#2-javax-servlet-http-HttpFilter" class="headerlink" title="2 javax.servlet.http.HttpFilter"></a>2 <code>javax.servlet.http.HttpFilter</code></h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>doFilter(ServletRequest req, ServletResponse res, FilterChain chain)</code></td>
<td>重写方法，会调用特有方法</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>doFilter(HttpServletRequest req, HttpServletResponse res, FilterChain chain)</code></td>
<td>特有的过滤方法</td>
</tr>
<tr>
<td><code>FilterConfig</code></td>
<td><code>getFilterConfig()</code></td>
<td>获取 <code>FilterConfig</code></td>
</tr>
</tbody></table>
<h3 id="3-javax-servlet-FilterChain"><a href="#3-javax-servlet-FilterChain" class="headerlink" title="3 javax.servlet.FilterChain"></a>3 <code>javax.servlet.FilterChain</code></h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>doFilter(ServletRequest req, ServletResponse res)</code></td>
<td>放行</td>
</tr>
</tbody></table>
<h3 id="4-javax-servlet-FilterConfig"><a href="#4-javax-servlet-FilterConfig" class="headerlink" title="4 javax.servlet.FilterConfig"></a>4 <code>javax.servlet.FilterConfig</code></h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>getFilterName()</code></td>
<td>获取过滤器名称</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getInitParameter(String name)</code></td>
<td>根据键获取初始化参数的值</td>
</tr>
<tr>
<td><code>Enumeration&lt;String&gt;</code></td>
<td><code>getInitParameterNames()</code></td>
<td>获取所有初始化参数键的枚举</td>
</tr>
<tr>
<td><code>ServletContext</code></td>
<td><code>getServletContext()</code></td>
<td>获取 <code>ServletContext</code></td>
</tr>
</tbody></table>
<h2 id="1-3-Filter-配置"><a href="#1-3-Filter-配置" class="headerlink" title="1.3 Filter 配置"></a>1.3 Filter 配置</h2><h3 id="1-xml-方式：web-xml"><a href="#1-xml-方式：web-xml" class="headerlink" title="1 xml 方式：web.xml"></a>1 xml 方式：<code>web.xml</code></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span><span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>过滤指定 url<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>过滤指定 servlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dispatcher</span>&gt;</span>过滤哪种模式的请求，必须写在最后<span class="tag">&lt;/<span class="name">dispatcher</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>过滤器链执行顺序由 <code>&lt;filter-mapping&gt;</code> 配置顺序决定</li>
</ul>
<h3 id="2-注解：-WebFilter"><a href="#2-注解：-WebFilter" class="headerlink" title="2 注解：@WebFilter"></a>2 注解：<code>@WebFilter</code></h3><table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>等价于</th>
</tr>
</thead>
<tbody><tr>
<td><code>String filterName()</code></td>
<td>过滤器名称</td>
<td><code>&lt;filter-name&gt;</code></td>
</tr>
<tr>
<td><code>String[] urlPatterns()</code></td>
<td>映射</td>
<td><code>&lt;url-pattern&gt;</code></td>
</tr>
<tr>
<td><code>String[] value()</code></td>
<td>同 <code>urlPatterns</code></td>
<td><code>&lt;url-pattern&gt;</code></td>
</tr>
<tr>
<td><code>String[] servletNames()</code></td>
<td>过滤哪些<code>Servlet</code></td>
<td><code>&lt;servlet-name&gt;</code></td>
</tr>
<tr>
<td><code>DispatcherType dispatcherTypes()</code></td>
<td>过滤哪种模式的请求</td>
<td><code>&lt;dispatcher&gt;</code></td>
</tr>
<tr>
<td><code>WebInitParam[] initParams()</code></td>
<td>初始化参数</td>
<td><code>&lt;init-param&gt;</code></td>
</tr>
</tbody></table>
<ul>
<li>按照类名的字符串比较规则比较，值小的先执行</li>
</ul>
<h3 id="3-映射规则-lt-url-pattern-gt"><a href="#3-映射规则-lt-url-pattern-gt" class="headerlink" title="3 映射规则 &lt;url-pattern&gt;"></a>3 映射规则 <code>&lt;url-pattern&gt;</code></h3><table>
<thead>
<tr>
<th>优先级 高 → 低</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>/XXX/XX</code></td>
<td>精确匹配</td>
</tr>
<tr>
<td><code>/*</code></td>
<td>任意路径</td>
</tr>
<tr>
<td><code>*.do</code></td>
<td>任意扩展名</td>
</tr>
</tbody></table>
<h3 id="4-lt-dispatcher-gt"><a href="#4-lt-dispatcher-gt" class="headerlink" title="4 &lt;dispatcher&gt;"></a>4 <code>&lt;dispatcher&gt;</code></h3><table>
<thead>
<tr>
<th>值</th>
<th>过滤</th>
</tr>
</thead>
<tbody><tr>
<td><code>REQUEST</code> （默认）</td>
<td>直接请求，重定向请求</td>
</tr>
<tr>
<td><code>FORWARD</code></td>
<td>转发请求</td>
</tr>
<tr>
<td><code>INCLUDE</code></td>
<td>包含请求</td>
</tr>
<tr>
<td><code>ERROR</code></td>
<td>声明式异常处理请求</td>
</tr>
</tbody></table>
<h2 id="1-4-Filter-生命周期"><a href="#1-4-Filter-生命周期" class="headerlink" title="1.4 Filter 生命周期"></a>1.4 Filter 生命周期</h2><table>
<thead>
<tr>
<th>阶段</th>
<th>方法</th>
<th>执行时机</th>
<th>执行次数</th>
</tr>
</thead>
<tbody><tr>
<td>1 实例化</td>
<td>构造函数</td>
<td>启动服务器时</td>
<td>执行一次</td>
</tr>
<tr>
<td>2 初始化</td>
<td><code>init()</code></td>
<td>启动服务器时</td>
<td>执行一次</td>
</tr>
<tr>
<td>3 过滤</td>
<td><code>doFilter()</code></td>
<td>过滤请求时</td>
<td>每次过滤都执行，且在请求处理前后各执行一次</td>
</tr>
<tr>
<td>4 销毁</td>
<td><code>destroy()</code></td>
<td>关闭服务器时</td>
<td>执行一次</td>
</tr>
</tbody></table>
<h2 id="1-5-Filter-执行流程"><a href="#1-5-Filter-执行流程" class="headerlink" title="1.5 Filter 执行流程"></a>1.5 Filter 执行流程</h2><p><img src="https://github.com/anyeansan/pics/raw/master/CS/JavaWEB/Filter%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt=""></p>
<ol>
<li>请求</li>
<li>正序执行过滤器链中各个过滤器放行前的代码</li>
<li>处理请求</li>
<li>倒叙执行过滤器链中各个过滤器放行后的代码</li>
<li>响应</li>
</ol>
<h1 id="二-监听器-Listener"><a href="#二-监听器-Listener" class="headerlink" title="二 监听器 Listener"></a>二 监听器 Listener</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><ol>
<li>监听器用于监听 WEB 程序中的事件<ol>
<li>域对象 <code>HttpRequest HttpSession ServletContext</code> 的创建，属性变化，销毁</li>
<li>Session 域中对象的绑定</li>
<li>Session 的钝化活化</li>
</ol>
</li>
<li>监听器基于观察者设计模式</li>
</ol>
<h2 id="2-2-事件监听机制"><a href="#2-2-事件监听机制" class="headerlink" title="2.2 事件监听机制"></a>2.2 事件监听机制</h2><table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>事件源</td>
<td>监听的对象</td>
</tr>
<tr>
<td>事件</td>
<td>监听的事件</td>
</tr>
<tr>
<td>监听器</td>
<td>监听器</td>
</tr>
<tr>
<td>注册监听</td>
<td>将事件源、事件、监听器绑定，当事件源上发生某个事件时，执行监听器代码</td>
</tr>
</tbody></table>
<h2 id="2-3-注册监听器"><a href="#2-3-注册监听器" class="headerlink" title="2.3 注册监听器"></a>2.3 注册监听器</h2><h3 id="1-XML-方式-web-xml"><a href="#1-XML-方式-web-xml" class="headerlink" title="1 XML 方式  web.xml"></a>1 XML 方式  <code>web.xml</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;listener&gt;</span><br><span class="line">	&lt;listener-class&gt;&lt;/listener-class&gt;</span><br><span class="line">&lt;/listener&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-注解-WebListener"><a href="#2-注解-WebListener" class="headerlink" title="2 注解 @WebListener"></a>2 注解 <code>@WebListener</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@WebListener</span><br><span class="line">// 在监听器类上添加此注解即可</span><br></pre></td></tr></table></figure>

<h2 id="2-4-常见监听器"><a href="#2-4-常见监听器" class="headerlink" title="2.4 常见监听器"></a>2.4 常见监听器</h2><h3 id="1-监听域对象的创建与销毁"><a href="#1-监听域对象的创建与销毁" class="headerlink" title="1 监听域对象的创建与销毁"></a>1 监听域对象的创建与销毁</h3><h4 id="1-ServletRequestListener"><a href="#1-ServletRequestListener" class="headerlink" title="1 ServletRequestListener"></a>1 <code>ServletRequestListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>requestInitialized(ServletRequestEvent event)</code></td>
<td>监听 <code>ServletRequest</code> 域的创建</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>requestDestroyed(ServletRequestEvent event)</code></td>
<td>监听 <code>ServletRequest</code> 域的销毁</td>
</tr>
</tbody></table>
<h4 id="2-HttpSessionListener"><a href="#2-HttpSessionListener" class="headerlink" title="2 HttpSessionListener"></a>2 <code>HttpSessionListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>sessionCreated(HttpSessionEvent event)</code></td>
<td>监听 <code>HttpSession</code> 域的创建</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>sessionDestroyed(HttpSessionEvent event)</code></td>
<td>监听 <code>HttpSession</code> 域的销毁</td>
</tr>
</tbody></table>
<h4 id="3-ServletContextListener"><a href="#3-ServletContextListener" class="headerlink" title="3 ServletContextListener"></a>3 <code>ServletContextListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>contextInitialized(ServletContextEvent event)</code></td>
<td>监听 <code>ServletContext</code> 域的创建</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>contextDestroyed(ServletContextEvent event)</code></td>
<td>监听 <code>ServletContext</code> 域的销毁</td>
</tr>
</tbody></table>
<h3 id="2-监听域对象的属性变化"><a href="#2-监听域对象的属性变化" class="headerlink" title="2 监听域对象的属性变化"></a>2 监听域对象的属性变化</h3><h4 id="1-ServletRequestAttributeListener"><a href="#1-ServletRequestAttributeListener" class="headerlink" title="1 ServletRequestAttributeListener"></a>1 <code>ServletRequestAttributeListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>attributeAdded(ServletRequestAttributeEvent event)</code></td>
<td>监听 <code>ServletRequest</code> 域中属性的添加</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>attributeRemoved(ServletRequestAttributeEvent event)</code></td>
<td>监听 <code>ServletRequest</code> 域中属性的删除</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>attributeReplaced(ServletRequestAttributeEvent event)</code></td>
<td>监听 <code>ServletRequest</code> 域中属性的修改</td>
</tr>
</tbody></table>
<h4 id="2-HttpSessionAttributeListener"><a href="#2-HttpSessionAttributeListener" class="headerlink" title="2 HttpSessionAttributeListener"></a>2 <code>HttpSessionAttributeListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>attributeAdded(HttpSessionBindingEvent event)</code></td>
<td>监听 <code>HttpSession</code> 域中属性的添加</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>attributeRemoved(HttpSessionBindingEvent event)</code></td>
<td>监听 <code>HttpSession</code> 域中属性的删除</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>attributeReplaced(HttpSessionBindingEvent event)</code></td>
<td>监听 <code>HttpSession</code>域中属性的修改</td>
</tr>
</tbody></table>
<h4 id="3-ServletContextAttributeListener"><a href="#3-ServletContextAttributeListener" class="headerlink" title="3 ServletContextAttributeListener"></a>3 <code>ServletContextAttributeListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>attributeAdded(ServletContextAttributeEvent event)</code></td>
<td>监听 <code>ServletContext</code> 域中属性的添加</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>attributeRemoved(ServletContextAttributeEvent event)</code></td>
<td>监听 <code>ServletContext</code> 域中属性的删除</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>attributeReplaced(ServletContextAttributeEvent event)</code></td>
<td>监听 <code>ServletContext</code> 域中属性的修改</td>
</tr>
</tbody></table>
<h3 id="3-监听-HttpSession-域中的对象"><a href="#3-监听-HttpSession-域中的对象" class="headerlink" title="3 监听 HttpSession 域中的对象"></a>3 监听 HttpSession 域中的对象</h3><h4 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h4><ol>
<li>此类监听器不用注册</li>
<li>要用被监听对象实现此类监听器</li>
</ol>
<h4 id="2-HttpSessionBindingListener"><a href="#2-HttpSessionBindingListener" class="headerlink" title="2 HttpSessionBindingListener"></a>2 <code>HttpSessionBindingListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>valueBound(HttpSessionBindingEvent event)</code></td>
<td>对象绑定到 <code>HttpSession</code> 域中时触发</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>valueUnBound(HttpSessionBindingEvent event)</code></td>
<td>对象从 <code>HttpSession</code> 域中解绑时触发</td>
</tr>
</tbody></table>
<h4 id="3-HttpSessionActivationListener"><a href="#3-HttpSessionActivationListener" class="headerlink" title="3 HttpSessionActivationListener"></a>3 <code>HttpSessionActivationListener</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>sessionDidActivate(HttpSessionEvetn event)</code></td>
<td>监听 <code>HttpSession</code> 的钝化</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>sessionWillPassivate(HttpSessionEvetn event)</code></td>
<td>监听 <code>HttpSession</code> 的活化</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/" class="post-title-link" itemprop="url">文件上传和下载</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:52:23 / 修改时间：20:54:33" itemprop="dateCreated datePublished" datetime="2020-11-08T20:52:23+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-上传"><a href="#一-上传" class="headerlink" title="一 上传"></a>一 上传</h1><h2 id="1-1-文件上传前提"><a href="#1-1-文件上传前提" class="headerlink" title="1.1 文件上传前提"></a>1.1 文件上传前提</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>form</code> 表单，包含文本域 <code>&lt;input type=&quot;file&quot;&gt;</code></li>
<li><code>method = post</code></li>
<li><code>enctype = multipart/form-data</code></li>
</ol>
<h2 id="1-2-文件上传原理"><a href="#1-2-文件上传原理" class="headerlink" title="1.2 文件上传原理"></a>1.2 文件上传原理</h2><ol>
<li><code>enctype=multipart/form-data</code> 时，使用 <code>request.getParameter(key)</code>取不到表单数据</li>
<li>通过流解析请求体，获取上传文件</li>
</ol>
<h2 id="1-3-Apache-Commons-Fileupload"><a href="#1-3-Apache-Commons-Fileupload" class="headerlink" title="1.3 Apache Commons Fileupload"></a>1.3 <code>Apache Commons Fileupload</code></h2><h3 id="1-API"><a href="#1-API" class="headerlink" title="1 API"></a>1 API</h3><table>
<thead>
<tr>
<th>类/接口</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>DiskFileItemFactory</code></td>
<td>工厂类，用来创建 <code>ServletFileUpload</code></td>
</tr>
<tr>
<td><code>ServletFileUpload</code></td>
<td>解析器对象</td>
</tr>
<tr>
<td><code>FileItem</code></td>
<td>对应一个表单项，分为普通字段和文件字段</td>
</tr>
</tbody></table>
<h4 id="1-DiskFileItemFactory"><a href="#1-DiskFileItemFactory" class="headerlink" title="1 DiskFileItemFactory"></a>1 <code>DiskFileItemFactory</code></h4><h5 id="1-构造"><a href="#1-构造" class="headerlink" title="1 构造"></a>1 构造</h5><table>
<thead>
<tr>
<th>构造函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>DiskFileItemFactory()</code></td>
<td>创建工厂类</td>
</tr>
<tr>
<td><code>DiskFileItemFactory(int sizeThreshold, File repository)</code></td>
<td>创建工厂类，并指定缓存文件的大小和临时文件的位置</td>
</tr>
</tbody></table>
<h5 id="2-方法"><a href="#2-方法" class="headerlink" title="2 方法"></a>2 方法</h5><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>setSizeThreshold(int sizeThreshold)</code></td>
<td>设置缓存文件的大小</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setRepository((File repository))</code></td>
<td>设置临时文件位置</td>
</tr>
</tbody></table>
<h4 id="2-ServletFileUpload"><a href="#2-ServletFileUpload" class="headerlink" title="2 ServletFileUpload"></a>2 <code>ServletFileUpload</code></h4><h5 id="1-构造-1"><a href="#1-构造-1" class="headerlink" title="1 构造"></a>1 构造</h5><table>
<thead>
<tr>
<th>构造函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ServletFileUpload()</code></td>
<td>创建解析器</td>
</tr>
<tr>
<td><code>ServletFileUpload(FileItemFactory factory)</code></td>
<td>根据工厂创建解析器</td>
</tr>
</tbody></table>
<h5 id="2-方法-1"><a href="#2-方法-1" class="headerlink" title="2 方法"></a>2 方法</h5><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>boolean</code></td>
<td><code>isMultipartContent(HttpServletRequest request)</code></td>
<td>判断请求是否包含上传</td>
</tr>
<tr>
<td><code>List&lt;FileItem&gt;</code></td>
<td><code>parseRequest(HttpServletRequest request)</code></td>
<td>解析请求</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setFileSizeMax(long fileSizeMax)</code></td>
<td>单个上传文件大小最大值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setSizeMax(long sizeMax)</code></td>
<td>多上传文件总大小最大值</td>
</tr>
</tbody></table>
<h4 id="3-FileItem"><a href="#3-FileItem" class="headerlink" title="3 FileItem"></a>3 <code>FileItem</code></h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>boolean</code></td>
<td><code>isFormField()</code></td>
<td>判断是否是普通表单项，<code>false</code> ：表示是文件字段</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getFieldName()</code></td>
<td>获取字段名</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getName()</code></td>
<td>获取文件名</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getContentType()</code></td>
<td>获取文件的 MIME 类型</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getString([String encoding])</code></td>
<td>普通字段：返回 value，文件字段：返回内容</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getSize()</code></td>
<td>获取文件大小</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>write(File file)</code></td>
<td>保存上传文件到指定文件</td>
</tr>
<tr>
<td><code>InputStream</code></td>
<td><code>getInputStream()</code></td>
<td>获取上传文件对应的字节输入流</td>
</tr>
<tr>
<td><code>OutputStream</code></td>
<td><code>getOutputStream()</code></td>
<td>获取上传文件对应的字节输出流</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>delete()</code></td>
<td>清理临时文件</td>
</tr>
</tbody></table>
<h3 id="2-使用"><a href="#2-使用" class="headerlink" title="2 使用"></a>2 使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建工厂类 DiskFileItemFactory</span></span><br><span class="line">DiskFileItemFactory factory = <span class="keyword">new</span> DiskFileItemFactory()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 根据工厂创建解析器 ServletFileUpload </span></span><br><span class="line">ServletFileUpload fileUpload = <span class="keyword">new</span> ServletFileUpload(factory)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 解析请求</span></span><br><span class="line">List&lt;FileItem&gt; list = fileUpload.parseRequest(request)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 获取文件名和文件内容。。。，保存文件</span></span><br></pre></td></tr></table></figure>

<h3 id="3-文件上传注意事项"><a href="#3-文件上传注意事项" class="headerlink" title="3 文件上传注意事项"></a>3 文件上传注意事项</h3><ol>
<li>上传的文件名是全路径，有的浏览器会自动处理，有的不会，最好处理一下</li>
<li>存储的文件名唯一，避免文件被覆盖</li>
<li>多目录，避免同一目录文件过多</li>
<li>限制文件的大小：web 方式不适合上传大的文件</li>
<li>临时文件<ol>
<li><code>DiskFileItemFactory</code> 内部有一个默认 <code>10KB</code> 的缓存，如果上传文件超过缓存大小，会用磁盘作为缓存</li>
<li>存放缓存文件的目录即临时文件目录</li>
<li>如果自己用 IO 流实现的文件上传，要在流关闭后，清理临时文件</li>
</ol>
</li>
</ol>
<h2 id="1-4-Apache-Commons-IO"><a href="#1-4-Apache-Commons-IO" class="headerlink" title="1.4 Apache Commons IO"></a>1.4 <code>Apache Commons IO</code></h2><h3 id="1-FilenameUtils"><a href="#1-FilenameUtils" class="headerlink" title="1 FilenameUtils"></a>1 FilenameUtils</h3><h3 id="2-IOUtils"><a href="#2-IOUtils" class="headerlink" title="2 IOUtils"></a>2 IOUtils</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>int</code></td>
<td><code>copy(InputStream in, OutputStream out, [int bufferSize])</code></td>
<td>从字节输入流向字节输出流拷贝</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>copy(Reader in, writer out)</code></td>
<td>从字符输入流向字符输出流拷贝</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>copy(InputStream in, Writer out, String inEncoding)</code></td>
<td>从字节输入流向字符输出流拷贝</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>copy(Reader in, OutputStream out, String outEncoding)</code></td>
<td>从字符输入流向字节输出流拷贝</td>
</tr>
</tbody></table>
<h1 id="二-下载"><a href="#二-下载" class="headerlink" title="二 下载"></a>二 下载</h1><h2 id="2-1-原理"><a href="#2-1-原理" class="headerlink" title="2.1 原理"></a>2.1 原理</h2><ul>
<li><code>Content-disposition</code><ul>
<li>响应头，服务器告诉客户端以什么格式打开响应体数据</li>
<li><code>in-line</code>：默认值，在当前页面内打开</li>
<li><code>attachment;filename=</code>：以附件形式打开响应体（文件下载）</li>
</ul>
</li>
</ul>
<h2 id="2-2-文件下载步骤"><a href="#2-2-文件下载步骤" class="headerlink" title="2.2 文件下载步骤"></a>2.2 文件下载步骤</h2><ol>
<li><p>发送请求，包含要下载的文件名</p>
</li>
<li><p>获取文件在服务器的真实路径</p>
</li>
<li><p>根据文件路径创建输入流</p>
</li>
<li><p>设置响应头</p>
<ol>
<li><p>下载文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(&quot;content-disposition&quot;, &quot;attachment;filename=&quot;+fileName)</span><br></pre></td></tr></table></figure>
</li>
<li><p>文件类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 1 手动设置类型</span><br><span class="line">response.setHeader(&quot;content-type&quot;, &quot;image/jpeg&quot;);</span><br><span class="line">// 2 根据文件名获取类型</span><br><span class="line">response.setContentType(this.getServletContext().getMimeType(fileName))</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>获取响应输出流，不断读写</p>
</li>
</ol>
<h2 id="2-3-下载文件名中文问题"><a href="#2-3-下载文件名中文问题" class="headerlink" title="2.3 下载文件名中文问题"></a>2.3 下载文件名中文问题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// agent就是请求头 User-Agent 的值</span><br><span class="line">public class DownLoadUtils &#123;</span><br><span class="line">    public static String getFileName(String agent, String filename) throws UnsupportedEncodingException &#123;</span><br><span class="line">        if (agent.contains(&quot;MSIE&quot;)) &#123;</span><br><span class="line">            // IE浏览器</span><br><span class="line">            filename = URLEncoder.encode(filename, &quot;utf-8&quot;);</span><br><span class="line">            filename = filename.replace(&quot;+&quot;, &quot; &quot;);</span><br><span class="line">        &#125; else if (agent.contains(&quot;Firefox&quot;)) &#123;</span><br><span class="line">            // 火狐浏览器</span><br><span class="line">            BASE64Encoder base64Encoder = new BASE64Encoder();</span><br><span class="line">            filename = &quot;=?utf-8?B?&quot; + base64Encoder.encode(filename.getBytes(&quot;utf-8&quot;)) + &quot;?=&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 其它浏览器</span><br><span class="line">            filename = URLEncoder.encode(filename, &quot;utf-8&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return filename;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/%E4%BC%9A%E8%AF%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/%E4%BC%9A%E8%AF%9D/" class="post-title-link" itemprop="url">会话</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:52:10 / 修改时间：20:54:27" itemprop="dateCreated datePublished" datetime="2020-11-08T20:52:10+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><ol>
<li>打开浏览器，不管是多标签，还是多窗口，直到全部关闭，是一次会话</li>
<li>本质上：从 Session 对象的创建到最终 Session 的销毁，才是真正意义上的一次完整会话</li>
<li>保存会话数据有两种技术：<ol>
<li>Cookie</li>
<li>Session</li>
</ol>
</li>
</ol>
<h1 id="二-Cookie"><a href="#二-Cookie" class="headerlink" title="二 Cookie"></a>二 Cookie</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><ol>
<li><p>Cookie  基于响应头 <code>set-cookie</code> 和请求头 <code>cookie</code> 实现</p>
</li>
<li><p>Cookie 是由服务器创建，响应给客户端的（一次可响应多个）</p>
<ul>
<li>可以保存在浏览器缓存中（默认），浏览器关闭则 Cookie 消失</li>
<li>可以保存在客户端硬盘中（设置有效时间），浏览器关闭 Cookie 还在，直到失效</li>
</ul>
</li>
<li><p>Cookie 只能存储字符串</p>
</li>
<li><p>Cookie 是与请求路径绑定的，只有有效路径的请求才会携带 Cookie，默认有效路径为创建 Cookie 那个请求路径的父路径</p>
</li>
<li><p>流程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 在服务端创建 Cookie</span></span><br><span class="line">Cookie cookie=<span class="keyword">new</span> Cookie(String name,String value)</span><br><span class="line"><span class="comment">// 2. 设置有效时间</span></span><br><span class="line">cookie.setMaxAge(<span class="number">3600</span>)</span><br><span class="line"><span class="comment">// 3. 响应给客户端，可响应多个 Cookie</span></span><br><span class="line">response.addCookie(cookie)</span><br><span class="line"><span class="comment">// 4. 再次请求时获取 Cookie</span></span><br><span class="line">Cookie[] cs=request.getCookies()</span><br></pre></td></tr></table></figure>

<ol>
<li>第一次请求时，服务器创建 Cookie，然后响应给客户端，并保存在客户端</li>
<li>之后的请求会携带 Cookie，服务器可以获取 Cookie 信息</li>
</ol>
</li>
</ol>
<h2 id="2-2-javax-servlet-http-Cookie"><a href="#2-2-javax-servlet-http-Cookie" class="headerlink" title="2.2 javax.servlet.http.Cookie"></a>2.2 <code>javax.servlet.http.Cookie</code></h2><h3 id="1-构造"><a href="#1-构造" class="headerlink" title="1 构造"></a>1 构造</h3><table>
<thead>
<tr>
<th>构造</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Cookie(String name, String value)</code></td>
<td>创建 Cookie，指定键值</td>
</tr>
</tbody></table>
<h3 id="2-方法"><a href="#2-方法" class="headerlink" title="2 方法"></a>2 方法</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>getName()</code></td>
<td>获取 Cookie 的键</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getValue()</code></td>
<td>获取 Cookie 的值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setValue(String newVal)</code></td>
<td>修改 Cookie 的值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setPath(String url)</code></td>
<td>设置 Cookie 有效路径，只有以此路径开头的请求才可以携带</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getPath()</code></td>
<td>获取 Cookie 有效路径</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setMaxAge(int second)</code></td>
<td>设置有效时间（默认会话结束则消失），正表示有效时间，负表示不保存，0 表示删除</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setDomain(String domain)</code></td>
<td>设置 Cookie 一级域名</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getDomain()</code></td>
<td>获取 Cookie 一级域名</td>
</tr>
</tbody></table>
<h2 id="2-3-Cookie-存中文"><a href="#2-3-Cookie-存中文" class="headerlink" title="2.3 Cookie 存中文"></a>2.3 Cookie 存中文</h2><ol>
<li>Tomcat 8 之前，不可以，需要 URL 编码</li>
<li>Tomcat 8 之后，键可以，但特殊字符不支持，还是建议 URL 编码</li>
<li>URL 编码：使用 <code>URLEncoder</code> 的 <code>encode()</code> 和 <code>decode()</code> 方法</li>
</ol>
<h2 id="2-4-Cookie-共享"><a href="#2-4-Cookie-共享" class="headerlink" title="2.4 Cookie 共享"></a>2.4 Cookie 共享</h2><ol>
<li>同一个服务器下的多个项目<ol>
<li>Cookie 默认 <code>path</code> 是创建时的项目的虚拟路径，所以其它项目是访问不到的</li>
<li>通过 <code>setPath(&quot;/&quot;)</code> 实现共享</li>
</ol>
</li>
<li>不同服务器的共享<ul>
<li><code>setDomain(String path)</code><ul>
<li>如果设置一级域名相同，那么多个服务器间的 Cookie 可以共享</li>
<li><code>setDomain(&quot;.baidu.com&quot;)</code><ul>
<li>则 <code>tieba.baidu.com</code>和 <code>news.baidu.com</code>…之间就可以共享</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="三-Session"><a href="#三-Session" class="headerlink" title="三 Session"></a>三 Session</h1><h2 id="3-1-原理"><a href="#3-1-原理" class="headerlink" title="3.1 原理"></a>3.1 原理</h2><ol>
<li>第一次请求服务器时，服务器创建 HttpSession 对象，并创建一个特殊的 Cookie，此特殊 Cookie：<ul>
<li>键： <code>JSessionID</code></li>
<li>值： Session 的 id</li>
</ul>
</li>
<li>将 Cookie 响应到客户端</li>
<li>再次请求时携带此 Cookie，服务器就可以获取 Session 的 id</li>
<li>服务器中维护了一个 Session 列表，根据获取的 Session 的 id 就可以获取对应的 HttpSession 对象</li>
</ol>
<h2 id="3-2-javax-servlet-http-HttpSession"><a href="#3-2-javax-servlet-http-HttpSession" class="headerlink" title="3.2 javax.servlet.http.HttpSession"></a>3.2 <code>javax.servlet.http.HttpSession</code></h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>getId()</code></td>
<td>获取 Session 的 id</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setMaxInactiveInterval(int second)</code></td>
<td>设置 Session 有效期，默认 30 分钟</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getMaxInactiveInterval()</code></td>
<td>获取 Session 有效时间</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>invalidate</code></td>
<td>销毁 Session</td>
</tr>
</tbody></table>
<h2 id="3-3-Session-的创建-获取"><a href="#3-3-Session-的创建-获取" class="headerlink" title="3.3 Session 的创建/获取"></a>3.3 Session 的创建/获取</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 若存在则获取，不存在则创建</span></span><br><span class="line">HttpSession session = request.getSession()</span><br><span class="line">HttpSession session = request.getSession(<span class="keyword">true</span>)</span><br><span class="line"><span class="comment">// 若存在则获取，不存在则返回 null</span></span><br><span class="line">HttpSession session = request.getSession(<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-4-Session-的有效期"><a href="#3-4-Session-的有效期" class="headerlink" title="3.4 Session 的有效期"></a>3.4 Session 的有效期</h2><ol>
<li>虽然 Session 默认有效期为 30 分钟，但 Session 依赖于 Cookie，而 Cookie 默认是会话级别的，所以 Session 默认也是会话级别</li>
<li>设置 Session 的有效期，需要同时设置 Cookie 和 Session</li>
</ol>
<h2 id="3-5-Session-的销毁"><a href="#3-5-Session-的销毁" class="headerlink" title="3.5 Session 的销毁"></a>3.5 Session 的销毁</h2><ol>
<li>服务器关闭</li>
<li>调用<code>invalidate()</code></li>
<li>Tomcat 的 <code>/conf/web.xml</code> 中的配置 <code>&lt;session-config&gt;</code>，默认是 30 分钟，可修改</li>
</ol>
<h2 id="3-6-Session-的钝化和活化"><a href="#3-6-Session-的钝化和活化" class="headerlink" title="3.6 Session 的钝化和活化"></a>3.6 Session 的钝化和活化</h2><ol>
<li>当服务器关闭再开启时，由于对象的地址是随机性的，可能导致两次的 Session 不一致，通过 Session 的钝化和活化可以解决此问题</li>
<li>钝化<ol>
<li>将 Session 对象和对象中的数据从内存序列化到硬盘的过程</li>
<li>钝化时机：服务器关闭</li>
</ol>
</li>
<li>活化<ol>
<li>将 Session 对象和对象中的数据从硬盘反序列化到内存的过程</li>
<li>活化时机：服务器重启</li>
</ol>
</li>
<li>Tomcat<ol>
<li>DOS 命令下，正常关闭 Tomcat ，会自动钝化 Session，在 <code>work</code> 目录下生成 <code>SESSIONS.ser</code> 文件，再次启动，会活化</li>
<li>IDEA 中，正常关闭 Tomcat ，也会钝化，但由于 IDEA 采用虚拟目录方式部署应用，重启 Tomcat 时，IDEA会先删除虚拟目录中的 <code>work</code> 目录，即钝化文件被删除了，也就无法活化了</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/JSP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/JSP/" class="post-title-link" itemprop="url">JSP</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:52:02 / 修改时间：20:54:43" itemprop="dateCreated datePublished" datetime="2020-11-08T20:52:02+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><ol>
<li><code>Java Server Pages</code></li>
<li>Jsp 本质是 Servlet<ol>
<li><code>.jsp</code> 翻译成的 <code>.java</code> 文件继承了 <code>HttpJspBase</code></li>
<li><code>HttpJspBase</code> 继承了 <code>HttpServlet</code></li>
</ol>
</li>
</ol>
<h1 id="二-执行过程"><a href="#二-执行过程" class="headerlink" title="二 执行过程"></a>二 执行过程</h1><ol>
<li>第一次访问会把 <code>.jsp</code> 先翻译成 <code>.java</code> 文件</li>
<li><code>.java</code>编译成<code>.class</code>文件</li>
<li>此后访问直接只需 <code>.class</code> 文件</li>
<li>如果 <code>.jsp</code> 发生变化，则视为第一次访问，从头开始</li>
</ol>
<h1 id="三-语法"><a href="#三-语法" class="headerlink" title="三 语法"></a>三 语法</h1><h2 id="3-1-注释"><a href="#3-1-注释" class="headerlink" title="3.1 注释"></a>3.1 注释</h2><table>
<thead>
<tr>
<th>注释</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;!-- --&gt;</code></td>
<td>不能注释脚本，会被写到最终页面</td>
</tr>
<tr>
<td><code>&lt;%-- --%&gt;</code></td>
<td>可以注释脚本，不会被写到最终页面</td>
</tr>
</tbody></table>
<h2 id="3-2-脚本"><a href="#3-2-脚本" class="headerlink" title="3.2 脚本"></a>3.2 脚本</h2><table>
<thead>
<tr>
<th>语法</th>
<th>名称</th>
<th>最终位置</th>
</tr>
</thead>
<tbody><tr>
<td>页面内容（HTML, CSS, JS, 文本…）</td>
<td></td>
<td><code>service()</code> 方法中： <code>out.write(&quot;翻译到这里&quot;)</code></td>
</tr>
<tr>
<td><code>&lt;% %&gt;</code></td>
<td>脚本</td>
<td><code>service()</code> 方法中</td>
</tr>
<tr>
<td><code>&lt;%= %&gt;</code></td>
<td>表达式</td>
<td><code>service()</code> 方法中： <code>out.write(&quot;翻译到这里&quot;)</code></td>
</tr>
<tr>
<td><code>&lt;%! %&gt;</code></td>
<td>声明</td>
<td><code>.java</code> 文件下成员位置</td>
</tr>
</tbody></table>
<h2 id="3-3-指令"><a href="#3-3-指令" class="headerlink" title="3.3 指令"></a>3.3 指令</h2><h3 id="1-语法"><a href="#1-语法" class="headerlink" title="1 语法"></a>1 语法</h3><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@指令名 属性<span class="number">1</span>=<span class="string">"值"</span> 属性<span class="number">2</span>=<span class="string">"值"</span>... %&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>jsp 指令不直接产生任何可见输出，而只告诉 jsp 引擎如何处理 jsp 页面中的内容。</li>
<li>页面中可出现多次</li>
</ol>
<h3 id="2-分类"><a href="#2-分类" class="headerlink" title="2 分类"></a>2 分类</h3><table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>page</code></td>
<td>用于定义 jsp 页面的各种属性</td>
</tr>
<tr>
<td><code>taglib</code></td>
<td>在 JSP 页面中导入标签库</td>
</tr>
<tr>
<td><code>include</code></td>
<td>静态包含</td>
</tr>
</tbody></table>
<h4 id="1-page"><a href="#1-page" class="headerlink" title="1 page"></a>1 page</h4><table>
<thead>
<tr>
<th>属性</th>
<th>作用</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>import</code></td>
<td>导包</td>
<td>jsp 默认导入的包：<code>java.lang.*，javax.servlet.*，javax.servlet.http.*，javax.servlet.jsp.*</code></td>
</tr>
<tr>
<td><code>language</code></td>
<td>语言</td>
<td>默认 <code>java</code></td>
</tr>
<tr>
<td><strong><code>pageEncoding</code></strong></td>
<td>设置响应编码方式</td>
<td>告诉服务器用什么编码把 <code>.jsp</code> 翻译成 <code>.java</code> 文件</td>
</tr>
<tr>
<td><code>contentType</code></td>
<td>设置响应内容，同时可以设置响应编码方式</td>
<td>等价于<code>response.setContentType(&quot;text/html;charset=utf-8&quot;);</code>，如果不设置则使用 <code>pageEncoding</code> 的编码</td>
</tr>
<tr>
<td><code>session</code></td>
<td>当前页面是否启用 session</td>
<td>默认 <code>true</code></td>
</tr>
<tr>
<td><code>buffer</code></td>
<td>输出数据的缓存大小(<code>out</code> 的缓冲区)</td>
<td>默认 <code>8KB</code></td>
</tr>
<tr>
<td><code>errorPage</code></td>
<td>配置错误页面</td>
<td>jsp 页面出现错误跳转的页面</td>
</tr>
<tr>
<td><code>isErrorPage</code></td>
<td>是否是错误页面，即是否可以使用内置对象 <code>exception</code></td>
<td>默认 <code>false</code></td>
</tr>
<tr>
<td><code>isELIgnored</code></td>
<td>是否忽略 EL 表达式</td>
<td>默认 <code>false</code></td>
</tr>
</tbody></table>
<h4 id="2-taglib"><a href="#2-taglib" class="headerlink" title="2 taglib"></a>2 taglib</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=&quot;库地址&quot; prefix=&quot;页面使用库所用的前缀&quot; %&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-include"><a href="#3-include" class="headerlink" title="3 include"></a>3 include</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ include file=&quot;&quot; %&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>静态包含</strong>，被包含文件可以是任意网络资源</li>
<li>先合并成一个文件，再翻译，所以被包含的文件不会单独翻译和编译</li>
</ul>
<h2 id="3-4-jsp-编码问题"><a href="#3-4-jsp-编码问题" class="headerlink" title="3.4 jsp 编码问题"></a>3.4 jsp 编码问题</h2><h3 id="1-jsp-编解码过程"><a href="#1-jsp-编解码过程" class="headerlink" title="1 jsp 编解码过程"></a>1 jsp 编解码过程</h3><ol>
<li><code>.jsp</code>的存储编码，<code>pageEncoding</code> 要与此编码一致否则翻译就会乱码</li>
<li><code>.jsp</code> → <code>.java</code><ul>
<li>使用 <code>pageEncoding</code> 指定的编码</li>
</ul>
</li>
<li><code>.java</code>→ <code>.class</code><ul>
<li>jvm 使用 <code>utf-8</code> 编译，不可修改</li>
</ul>
</li>
<li>浏览器解析<ul>
<li>使用的是 <code>contentType</code> 指定的编码</li>
</ul>
</li>
</ol>
<h3 id="2-解决乱码"><a href="#2-解决乱码" class="headerlink" title="2 解决乱码"></a>2 解决乱码</h3><ol>
<li>想要不乱码，保证以下三码一致即可<ol>
<li><code>.jsp</code>的存储编码</li>
<li><code>pageEncoding</code>的编码</li>
<li><code>contentType</code>的编码</li>
</ol>
</li>
<li>由于 <code>contentType</code> 不设置会使用 <code>pageEncoding</code> 的编码，所以保证 <code>.jsp</code>的存储编码和 <code>pageEncoding</code> 的编码一致即可</li>
<li>ide 通常设置为 <code>utf-8</code>，即存储编码为 <code>utf-8</code>，所以只需设置 <code>pageEncoding=&quot;utf-8&quot;</code> 即可</li>
</ol>
<h2 id="3-5-动作"><a href="#3-5-动作" class="headerlink" title="3.5 动作"></a>3.5 动作</h2><table>
<thead>
<tr>
<th>动作</th>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>动态包含</td>
<td><code>&lt;jsp:include page=&quot;&quot;&gt;</code></td>
<td>不会合并文件，当执行到时，才包含另一个文件的内容；被包含文件也会被翻译和编译</td>
</tr>
<tr>
<td>转发</td>
<td><code>&lt;jsp:forward page=&quot;path&quot;/&gt;</code></td>
<td>相当于 <code>req.getRequestDispatcher(path).forward(req,res);</code></td>
</tr>
<tr>
<td>请求参数</td>
<td><code>&lt;jsp:param name=&quot;&quot; value=&quot;&quot; /&gt;</code></td>
<td>相当于 <code>url?name=value</code></td>
</tr>
<tr>
<td>创建对象</td>
<td><code>&lt;jsp:useBean id=&quot;p&quot; class=&quot;a.Person&quot;&gt;</code></td>
<td>相当于 <code>a.Person p = new a.Person()</code></td>
</tr>
<tr>
<td>为对象属性赋值</td>
<td><code>&lt;jsp:setProperty property=&quot;age&quot; name=&quot;p&quot; value=&quot;8&quot;/&gt;</code></td>
<td>相当于 <code>p.setAge(8)</code></td>
</tr>
<tr>
<td>获取对象属性值</td>
<td><code>&lt;jsp:getProperty property=&quot;age&quot; name=&quot;p&quot;/&gt;</code></td>
<td>相当于 <code>p.getAge()</code></td>
</tr>
</tbody></table>
<h1 id="四-内置对象"><a href="#四-内置对象" class="headerlink" title="四 内置对象"></a>四 内置对象</h1><h2 id="4-1-概述"><a href="#4-1-概述" class="headerlink" title="4.1 概述"></a>4.1 概述</h2><table>
<thead>
<tr>
<th>对象名</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>request</code></td>
<td><code>javax.servlet.http.HttpServletRequest</code></td>
<td>请求对象</td>
</tr>
<tr>
<td><code>response</code></td>
<td><code>javax.servlet.http.HttpServletResponse</code></td>
<td>响应对象</td>
</tr>
<tr>
<td><code>session</code></td>
<td><code>javax.servlet.http.HttpSession</code></td>
<td>会话对象</td>
</tr>
<tr>
<td><code>application</code></td>
<td><code>javax.servlet.ServletContext</code></td>
<td><code>ServletContext</code> 对象</td>
</tr>
<tr>
<td><code>pageContext</code></td>
<td><code>javax.servlet.jsp.PageContext</code></td>
<td><code>PageContext</code> 对象</td>
</tr>
<tr>
<td><code>exception</code></td>
<td><code>java.lang.Throwable</code></td>
<td>页面异常对象</td>
</tr>
<tr>
<td><code>page</code></td>
<td><code>java.lang.Object</code></td>
<td>当前 <code>servlet</code> 实例，即 <code>this</code></td>
</tr>
<tr>
<td><code>config</code></td>
<td><code>javax.servlet.ServletConfig</code></td>
<td><code>ServletConfig</code> 对象</td>
</tr>
<tr>
<td><code>out</code></td>
<td><code>javax.servlet.jsp.JspWriter</code></td>
<td>字符输出流</td>
</tr>
</tbody></table>
<ul>
<li>内置对象即 <code>service()</code> 方法中的局部变量，在 <code>&lt;%= %&gt;</code> 和 <code>&lt;% %&gt;</code> 中可以直接使用</li>
</ul>
<h2 id="4-2-out"><a href="#4-2-out" class="headerlink" title="4.2 out"></a>4.2 out</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 1. tomcat 会先从 response 中获取数据，然后才从 out 中获取数据</span></span><br><span class="line"><span class="comment">* 2. 所以无论何时，总是 response 先输出</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">out.write()</span><br><span class="line">response.getWriter().write()</span><br></pre></td></tr></table></figure>

<h2 id="4-3-pageContext"><a href="#4-3-pageContext" class="headerlink" title="4.3 pageContext"></a>4.3 pageContext</h2><h3 id="1-获取其它内置对象"><a href="#1-获取其它内置对象" class="headerlink" title="1 获取其它内置对象"></a>1 获取其它内置对象</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ServletRequest</code></td>
<td><code>getRequest()</code></td>
<td>获取 <code>request</code></td>
</tr>
<tr>
<td><code>ServletResponse</code></td>
<td><code>getResponse()</code></td>
<td>获取 <code>response</code></td>
</tr>
<tr>
<td><code>ServletContext</code></td>
<td><code>getServletContext()</code></td>
<td>获取 <code>application</code></td>
</tr>
<tr>
<td><code>ServletConfig</code></td>
<td><code>getServletConfig()</code></td>
<td>获取 <code>config</code></td>
</tr>
<tr>
<td><code>HttpSession</code></td>
<td><code>getSession()</code></td>
<td>获取 <code>session</code></td>
</tr>
<tr>
<td><code>Object</code></td>
<td><code>getPage()</code></td>
<td>获取 <code>page</code></td>
</tr>
<tr>
<td><code>Exception</code></td>
<td><code>getException</code></td>
<td>获取 <code>exception</code></td>
</tr>
</tbody></table>
<h3 id="2-域对象"><a href="#2-域对象" class="headerlink" title="2 域对象"></a>2 域对象</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>setAttribute(String name, Object value)</code></td>
<td>向 <code>page</code> 域中设置键值对</td>
</tr>
<tr>
<td><code>Object</code></td>
<td><code>getAttribute(String name)</code></td>
<td>根据键获取<code>page</code>域中键值对的值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>removeAttribute(String name)</code></td>
<td>根据键移除<code>page</code>域中键值对</td>
</tr>
</tbody></table>
<h3 id="3-操作其它域对象"><a href="#3-操作其它域对象" class="headerlink" title="3 操作其它域对象"></a>3 操作其它域对象</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>setAttribute(String name, Object value, int scope)</code></td>
<td>向指定域中设置键值对</td>
</tr>
<tr>
<td><code>Object</code></td>
<td><code>getAttribute(String name, int scope)</code></td>
<td>根据键获取指定域中键值对的值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>removeAttribute(String name, int scope)</code></td>
<td>根据键移除指定域中键值对</td>
</tr>
<tr>
<td><code>Object</code></td>
<td><code>findAttribute(String name)</code></td>
<td>按照 <code>page request session application</code> 的顺序查找</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>scope</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>PageContext.PAGE_SCOPE</code></td>
<td><code>page</code> 域</td>
</tr>
<tr>
<td><code>PageContext.REQUEST_SCOPE</code></td>
<td><code>request</code> 域</td>
</tr>
<tr>
<td><code>PageContext.SESSION_SCOPE</code></td>
<td><code>response</code> 域</td>
</tr>
<tr>
<td><code>PageContext.APPLICATION_SCOPE</code></td>
<td><code>application</code> 域</td>
</tr>
</tbody></table>
<h3 id="4-转发-amp-包含"><a href="#4-转发-amp-包含" class="headerlink" title="4 转发 &amp; 包含"></a>4 转发 &amp; 包含</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>forward(String relativeUrlPath)</code></td>
<td>转发</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>include(String relativeUrlPath, [boolean flush])</code></td>
<td>动态包含</td>
</tr>
</tbody></table>
<h1 id="五-EL-表达式"><a href="#五-EL-表达式" class="headerlink" title="五 EL 表达式"></a>五 EL 表达式</h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><ol>
<li><code>expression language</code></li>
<li>EL 是 jsp 的内置表达式语言，可用于获取域中的值，简单的运算或判断操作<ol>
<li>EL 表达式只能从域中获取数据，且只能读不能写</li>
<li>EL 获取的值若为 <code>null</code> 会显示为 <code>&quot;&quot;</code></li>
</ol>
</li>
<li>EL 用于代替 jsp 表达式 <code>&lt;%= %&gt;</code></li>
<li>EL 会自动作类型转换</li>
<li>语法：<code>${表达式}</code></li>
</ol>
<h2 id="5-2-语法"><a href="#5-2-语法" class="headerlink" title="5.2 语法"></a>5.2 语法</h2><h3 id="1-运算"><a href="#1-运算" class="headerlink" title="1 运算"></a>1 运算</h3><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>算术运算符</td>
<td><code>+ - * /(div) %(mod)</code></td>
</tr>
<tr>
<td>比较运算符</td>
<td><code>&gt; &lt; &gt;= &lt;= == !=</code></td>
</tr>
<tr>
<td>逻辑运算符</td>
<td><code>&& || !</code></td>
</tr>
<tr>
<td>空运算符</td>
<td><code>empty</code>，<code>null &quot;&quot; 空集合</code> 这三种情况为 <code>true</code></td>
</tr>
<tr>
<td>三元运算符</td>
<td><code>${empty key?&quot;为空&quot;:&quot;不为空&quot;}</code></td>
</tr>
</tbody></table>
<h3 id="2-获取域中数据"><a href="#2-获取域中数据" class="headerlink" title="2 获取域中数据"></a>2 获取域中数据</h3><table>
<thead>
<tr>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>${key}</code></td>
<td>相当于 <code>pageContext.findAttribute()</code>，从四个域中依次查找</td>
</tr>
<tr>
<td><code>${scope.key}</code></td>
<td>从指定域中查找</td>
</tr>
</tbody></table>
<h2 id="5-3-EL-中的隐式对象"><a href="#5-3-EL-中的隐式对象" class="headerlink" title="5.3 EL 中的隐式对象"></a>5.3 EL 中的隐式对象</h2><table>
<thead>
<tr>
<th>隐式对象</th>
<th>类型</th>
<th>对应 jsp 内置对象</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>pageContext</code></td>
<td><code>javax.servlet.jsp.PageContex</code></td>
<td><code>pageContext</code></td>
<td>二者一样</td>
</tr>
<tr>
<td><code>pageScope</code></td>
<td><code>java.util.Map&lt;String,Object&gt;</code></td>
<td>无</td>
<td><code>page</code> 域</td>
</tr>
<tr>
<td><code>requestScope</code></td>
<td><code>java.util.Map&lt;String,Object&gt;</code></td>
<td>无</td>
<td><code>request</code> 域</td>
</tr>
<tr>
<td><code>sessionScope</code></td>
<td><code>java.util.Map&lt;String,Object&gt;</code></td>
<td>无</td>
<td><code>session</code> 域</td>
</tr>
<tr>
<td><code>applicationScope</code></td>
<td><code>java.util.Map&lt;String,Object&gt;</code></td>
<td>无</td>
<td><code>application</code> 域</td>
</tr>
<tr>
<td><code>param</code></td>
<td><code>java.util.Map&lt;String,String&gt;</code></td>
<td>无</td>
<td>请求参数</td>
</tr>
<tr>
<td><code>paramValues</code></td>
<td><code>java.util.Map&lt;String,String[]&gt;</code></td>
<td>无</td>
<td>请求参数有多个值</td>
</tr>
<tr>
<td><code>header</code></td>
<td><code>java.util.Map&lt;String,String&gt;</code></td>
<td>无</td>
<td>请求消息头</td>
</tr>
<tr>
<td><code>headerValues</code></td>
<td><code>java.util.Map&lt;String,String[]</code></td>
<td>无</td>
<td>请求消息头有多个值</td>
</tr>
<tr>
<td><code>initParam</code></td>
<td><code>java.util.Map&lt;String,String&gt;</code></td>
<td>无</td>
<td>初始化参数</td>
</tr>
<tr>
<td><code>cookie</code></td>
<td><code>java.util.Map&lt;String,Cookie&gt;</code></td>
<td>无</td>
<td><code>cookie</code></td>
</tr>
</tbody></table>
<h1 id="六-JSTL"><a href="#六-JSTL" class="headerlink" title="六 JSTL"></a>六 JSTL</h1><h2 id="6-1-概述"><a href="#6-1-概述" class="headerlink" title="6.1 概述"></a>6.1 概述</h2><ol>
<li><code>JavaServerPages Standard Tag Library</code></li>
<li>JSP 标准标签库，由五个库组成，用于替代 jsp 脚本 </li>
<li>EL 用于简化数据获取方面的 java 代码，而 JSTL 用于简化逻辑方面的 java 代码</li>
</ol>
<h2 id="6-2-组成"><a href="#6-2-组成" class="headerlink" title="6.2 组成"></a>6.2 组成</h2><table>
<thead>
<tr>
<th>功能</th>
<th>URI</th>
<th>前缀</th>
</tr>
</thead>
<tbody><tr>
<td>核心 <code>Core</code></td>
<td><code>http://java.sun.com/jsp/jstl/core</code></td>
<td><code>c</code></td>
</tr>
<tr>
<td>格式化 <code>I18N</code></td>
<td><code>http://java.sun.com/jsp/jstl/fmt</code></td>
<td><code>fmt</code></td>
</tr>
<tr>
<td>函数 <code>Function</code></td>
<td><code>http://java.sun.com/jsp/jstl/functions</code></td>
<td><code>fn</code></td>
</tr>
<tr>
<td>数据库 <code>SQL</code></td>
<td><code>http://java.sun.com/jsp/jstl/sql</code></td>
<td><code>sql</code></td>
</tr>
<tr>
<td>XML</td>
<td><code>http://java.sun.com/jsp/jstl/xml</code></td>
<td><code>x</code></td>
</tr>
</tbody></table>
<h2 id="6-3-使用-JSTL"><a href="#6-3-使用-JSTL" class="headerlink" title="6.3 使用 JSTL"></a>6.3 使用 JSTL</h2><ol>
<li><p>导包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">taglibs-standard-spec-1.2.5.jar (规范包)</span><br><span class="line">taglibs-standard-impl-1.2.5.jar（实现包）</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入 JSTL 核心库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;自定义&quot; %&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="6-4-标签"><a href="#6-4-标签" class="headerlink" title="6.4 标签"></a>6.4 标签</h2><h3 id="1-通用标签"><a href="#1-通用标签" class="headerlink" title="1 通用标签"></a>1 通用标签</h3><h4 id="1-set"><a href="#1-set" class="headerlink" title="1 set"></a>1 set</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:set var=&quot;num&quot; value=&quot;10&quot; scope=&quot;session&quot; /&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>声明变量并赋值，存入指定域中</li>
<li>相当于 <code>setAttribute(String name, Object value, int scope)</code></li>
</ol>
<h4 id="2-out"><a href="#2-out" class="headerlink" title="2 out"></a>2 out</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:out value=&quot;$&#123;num&#125;&quot; scope=&quot;session&quot;/&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>从指定域中获取值，<code>value</code>要使用 EL</li>
<li>相当于 <code>getAttribute(String name, int scope)</code></li>
<li>可以直接使用 EL 代替 <code>out</code> 标签</li>
</ol>
<h4 id="3-remove"><a href="#3-remove" class="headerlink" title="3 remove"></a>3 remove</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:remove var=&quot;num&quot; scope=&quot;session&quot;/&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>从指定域中删除</li>
<li>相当于 <code>removeAttribute(String name, int Scopte)</code></li>
</ol>
<h3 id="2-条件标签"><a href="#2-条件标签" class="headerlink" title="2 条件标签"></a>2 条件标签</h3><h4 id="1-if"><a href="#1-if" class="headerlink" title="1 if"></a>1 if</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:if test=&quot;&quot;&gt;&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-choose"><a href="#2-choose" class="headerlink" title="2 choose"></a>2 choose</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:choose&gt;</span><br><span class="line">	&lt;c:when test=&quot;&quot;&gt;&lt;/c:when&gt;</span><br><span class="line">	&lt;c:when test=&quot;&quot;&gt;&lt;/c:when&gt;</span><br><span class="line">	...</span><br><span class="line">	&lt;c:otherwise&gt;&lt;/c:otherwise&gt;</span><br><span class="line">&lt;/c:choose&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-迭代标签-forEach"><a href="#3-迭代标签-forEach" class="headerlink" title="3 迭代标签 forEach"></a>3 迭代标签 <code>forEach</code></h3><h4 id="1-普通循环"><a href="#1-普通循环" class="headerlink" title="1 普通循环"></a>1 普通循环</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach var=&quot;&quot; begin=&quot;&quot; end=&quot;&quot; step=&quot;&quot; varStatus=&quot;vs&quot;&gt;&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<h4 id="2-增强循环"><a href="#2-增强循环" class="headerlink" title="2 增强循环"></a>2 增强循环</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:forEach items=&quot;&quot; var=&quot;&quot; varStatus=&quot;vs&quot;&gt;&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-varStatus"><a href="#3-varStatus" class="headerlink" title="3 varStatus"></a>3 varStatus</h4><ol>
<li>指向一个对象，此对象记录着当前遍历元素的信息</li>
<li>通过 EL 可以获取当前遍历元素的信息</li>
</ol>
<table>
<thead>
<tr>
<th>语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>${vs.index}</code></td>
<td>获取当前元素索引，索引从 0 开始</td>
</tr>
<tr>
<td><code>${vs.count}</code></td>
<td>获取当前元素是第几个，计数从 1 开始</td>
</tr>
<tr>
<td><code>${vs.current}</code></td>
<td>获取当前元素</td>
</tr>
<tr>
<td><code>${vs.first}</code></td>
<td>判断当前元素是否是第一个</td>
</tr>
<tr>
<td><code>${vs.last}</code></td>
<td>判断当前元素是否是最后一个</td>
</tr>
</tbody></table>
<h1 id="七-域对象"><a href="#七-域对象" class="headerlink" title="七 域对象"></a>七 域对象</h1><table>
<thead>
<tr>
<th>域</th>
<th>对象</th>
<th>生命周期</th>
</tr>
</thead>
<tbody><tr>
<td><code>page</code></td>
<td><code>PageContext</code></td>
<td>当前页面</td>
</tr>
<tr>
<td><code>request</code></td>
<td><code>ServletRequest</code></td>
<td>一次请求</td>
</tr>
<tr>
<td><code>session</code></td>
<td><code>HttpSession</code></td>
<td>一次会话</td>
</tr>
<tr>
<td><code>application</code></td>
<td><code>ServletContext</code></td>
<td>整个应用</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/Servlet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/Servlet/" class="post-title-link" itemprop="url">Servlet</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:51:55 / 修改时间：20:54:50" itemprop="dateCreated datePublished" datetime="2020-11-08T20:51:55+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><h2 id="1-1-JavaEE"><a href="#1-1-JavaEE" class="headerlink" title="1.1 JavaEE"></a>1.1 JavaEE</h2><ol>
<li>Java 企业版</li>
<li>SUN 公司提供的一套庞大类库，用于企业级开发，可以认为是平台或者规范</li>
<li>13 种技术规范<ol>
<li>Servlet</li>
<li>JSP：Java Server Pages</li>
<li>JDBC：Java Data Base Connectivity</li>
<li>XML：Extensible Markup Language</li>
<li>JNDI：Java Naming and Directory Interfaces</li>
<li>EJB：Enterprise Java Beans</li>
<li>RMI：Remote Method Invocation</li>
<li>Java IDL/CORBA：Java Interface Definiyion Language/Common Object Request  Broker Architecture</li>
<li>JMS：Java Message Service</li>
<li>JTA：Java Transaction API</li>
<li>JTS：Java Transaction Service</li>
<li>JavaMail</li>
<li>JAF：JavaBeans Activation Framework</li>
</ol>
</li>
</ol>
<h2 id="1-2-MVC"><a href="#1-2-MVC" class="headerlink" title="1.2 MVC"></a>1.2 MVC</h2><ol>
<li>MVC 是一种概念<ol>
<li><code>Model</code> <ul>
<li><code>&quot;什么&quot;</code></li>
<li>数据模型</li>
</ul>
</li>
<li><code>View</code> <ul>
<li><code>&quot;怎么显示什么</code></li>
<li>显示数据</li>
</ul>
</li>
<li><code>Controller</code> <ul>
<li><code>&quot;怎么操作什么&quot;</code></li>
<li>处理数据</li>
</ul>
</li>
</ol>
</li>
<li>三层架构是一种应用<ol>
<li>表现层</li>
<li>业务层</li>
<li>持久层</li>
</ol>
</li>
</ol>
<h2 id="1-3-Servlet"><a href="#1-3-Servlet" class="headerlink" title="1.3 Servlet"></a>1.3 Servlet</h2><ol>
<li>Server Applet，用 java 编写的运行在服务端的小程序，作为 HTTP 客户端的请求和 HTTP 服务器上的数据库或应用程序之间的中间层</li>
<li>Servlet 必须运行在 Servlet 容器中（如 Tomcat…）</li>
<li>Servlet 对象是单例的（但不符合单例模式，单例模式构造方法是私有的），Tomcat 服务器支持多线程，所以 Servlet 是在单实例多线程的环境下运行的，如果 Servlet 中有实例变量，会存在线程安全问题，所以不建议使用实例变量</li>
<li>所有 Servlet 都要直接或间接实现 <code>javax.servlet.Servlet</code> 接口，所以 Servlet 本质就是一种规范，所有实现 Servlet 的类，或者说，所有想要处理网络请求的类，都需要回答这三个问题：<ul>
<li>你初始化时要做什么</li>
<li>你销毁时要做什么</li>
<li>你接受到请求时要做什么</li>
</ul>
</li>
<li>Web 服务器和 Servlet 容器<ol>
<li>Web 服务器的作用说穿了就是：将某个主机上的资源映射为一个URL供外界访问</li>
<li>通过 URL 访问 Web 服务器资源，通常有三个过程<ul>
<li>接收请求</li>
<li>处理请求</li>
<li>响应请求</li>
</ul>
</li>
<li>其中接收请求和响应请求是共性功能，可以抽取由 Web 服务器完成，而处理请求的逻辑各不相同，抽取出来做成Servlet，交给程序员自己编写</li>
<li>Servlet 容器：顾名思义即用来存放 Servlet 对象</li>
</ol>
</li>
<li>所以 Servlet 并不会直接和客户端打交道，而是由 Tomcat 监听端口，接收请求，然后根据 URL 等信息决定交给哪个 Servlet 处理，之后再由 Tomcat 响应请求</li>
</ol>
<h1 id="二-配置"><a href="#二-配置" class="headerlink" title="二 配置"></a>二 配置</h1><h2 id="2-1-映射规则"><a href="#2-1-映射规则" class="headerlink" title="2.1 映射规则"></a>2.1 映射规则</h2><table>
<thead>
<tr>
<th>优先级（高 →低）</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>/xxx/xx/x</code></td>
<td>绝对匹配</td>
</tr>
<tr>
<td><code>/*</code></td>
<td>所有</td>
</tr>
<tr>
<td><code>*.do</code></td>
<td>指定扩展名</td>
</tr>
<tr>
<td><code>/</code></td>
<td>除了 <code>.jsp</code> 之外的</td>
</tr>
</tbody></table>
<h3 id="和"><a href="#和" class="headerlink" title="/ 和 /*"></a><code>/</code> 和 <code>/*</code></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.DefaultServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.jasper.servlet.JspServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jsp<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jspx<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>上述为 tomcat 的 <code>web.xml</code> 中的配置，可以看到服务器中的所有资源（包括静态）都会经过 Servlet<ol>
<li><code>.jsp</code> 外的资源有匹配则走匹配，没有匹配的 Servlet 则会走默认的 <code>DefaultServlet</code></li>
<li><code>.jsp</code> 会走 <code>JspServlet</code></li>
</ol>
</li>
<li>如果自定义 Servlet 的映射设置为 <code>/</code>，会覆盖默认设置，则结果是<ol>
<li><code>.jsp</code> 外的资源有匹配则走匹配，没有匹配的 Servlet 则会走此自定义 Servlet</li>
<li><code>.jsp</code> 会走 <code>JspServlet</code></li>
</ol>
</li>
<li>如果自定义 <code>servlet</code> 的映射设置为 <code>/*</code>，由于 <code>/*</code> 优先级高于 <code>*.jsp</code> 和 <code>/</code>，则结果是<ul>
<li>所有资源如果没有匹配的 Servlet 则都会走此自定义 Servlet</li>
</ul>
</li>
</ol>
<h2 id="3-2-xml-配置：web-xml"><a href="#3-2-xml-配置：web-xml" class="headerlink" title="3.2 xml 配置：web.xml"></a>3.2 xml 配置：<code>web.xml</code></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;url-pattern&gt; 可以写多个 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-注解配置：-WebServlet"><a href="#3-3-注解配置：-WebServlet" class="headerlink" title="3.3 注解配置：@WebServlet"></a>3.3 注解配置：<code>@WebServlet</code></h2><ul>
<li><code>@WebServlet</code> 注解用在类或接口上，仅在运行阶段生效</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>说明</th>
<th>等价于</th>
</tr>
</thead>
<tbody><tr>
<td><code>String name() default &quot;&quot;</code></td>
<td><code>servlet</code> 名称</td>
<td><code>&lt;Servlet-name&gt;</code></td>
</tr>
<tr>
<td><code>String[] urlPatterns() default {}</code></td>
<td>映射 url</td>
<td><code>&lt;url-pattern&gt;</code></td>
</tr>
<tr>
<td><code>String[] value() default {}</code></td>
<td>同 <code>urlPatterns()</code></td>
<td><code>&lt;url-pattern&gt;</code></td>
</tr>
<tr>
<td><code>int loadOnStartup() default -1</code></td>
<td>实例化顺序</td>
<td><code>&lt;load-on-startup&gt;</code></td>
</tr>
<tr>
<td><code>WebInitParam[] initParams() default {}</code></td>
<td>初始化参数</td>
<td><code>&lt;init-param&gt;</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(name=<span class="string">""</span>, urlPatterns=&#123;<span class="string">""</span>, <span class="string">""</span>, ...&#125;)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. 由于注解直接作用在类上，所以可以省略 name</span></span><br><span class="line"><span class="comment">2. value 等价于 urlPatterns，所以可以使用 value 代替 </span></span><br><span class="line"><span class="comment">3. 注解中只有一个属性且为 value 时可以省略属性名</span></span><br><span class="line"><span class="comment">4. 最终简化版</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@WebServlet</span>(<span class="string">""</span>, <span class="string">""</span>, ...)</span><br></pre></td></tr></table></figure>

<h1 id="三-体系"><a href="#三-体系" class="headerlink" title="三 体系"></a>三 体系</h1><p><img src="https://github.com/anyeansan/pics/raw/master/CS/JavaWEB/Servlet%E4%BD%93%E7%B3%BB.png" alt=""></p>
<ul>
<li>每个 <code>Servlet</code> 都对应一个 <code>ServletConfig</code></li>
<li>所有 <code>Servlet</code> 共享一个 <code>ServletContext</code></li>
</ul>
<h2 id="3-1-Servlet"><a href="#3-1-Servlet" class="headerlink" title="3.1 Servlet"></a>3.1 Servlet</h2><h3 id="1-API"><a href="#1-API" class="headerlink" title="1 API"></a>1 API</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>init(ServletConfig config)</code></td>
<td>初始化</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>destroy()</code></td>
<td>销毁</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>service(ServletRequest req, ServletResponse res)</code></td>
<td>处理请求</td>
</tr>
<tr>
<td><code>ServletConfig</code></td>
<td><code>getServletConfig()</code></td>
<td>获取 <code>ServletConfig</code>（每个 Servlet 对应一个 ）</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getServletInfo()</code></td>
<td>获取 <code>servlet</code> 信息，如作者，版本，版权…</td>
</tr>
</tbody></table>
<h3 id="2-生命周期"><a href="#2-生命周期" class="headerlink" title="2  生命周期"></a>2  生命周期</h3><table>
<thead>
<tr>
<th>阶段</th>
<th>方法</th>
<th>执行时机</th>
<th>执行次数</th>
</tr>
</thead>
<tbody><tr>
<td>1 实例化</td>
<td>构造函数</td>
<td>默认第一接收请求时</td>
<td>只执行一次</td>
</tr>
<tr>
<td>2 初始化</td>
<td><code>init(ServletConfig config)</code></td>
<td>默认第一接收请求时</td>
<td>只执行一次</td>
</tr>
<tr>
<td>3 处理请求</td>
<td><code>service(ServletRequest req, ServletResponse res)</code></td>
<td>接收请求时</td>
<td>每次请求都会执行</td>
</tr>
<tr>
<td>4 销毁</td>
<td><code>destroy()</code></td>
<td>关闭服务器</td>
<td>只执行一次</td>
</tr>
</tbody></table>
<ol>
<li><p>Servlet 的生命周期，包括其相关方法的调用，都是由 Web 容器来管理的，程序员无权干涉</p>
</li>
<li><p>配置 <code>web.xml</code> 或注解实现服务器一启动就实例化 <code>servlet</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Num &gt; 0，web 容器启动时实例化顺序是由小到大 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>Num<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-2-ServletConfig"><a href="#3-2-ServletConfig" class="headerlink" title="3.2 ServletConfig"></a>3.2 ServletConfig</h2><h3 id="1-API-1"><a href="#1-API-1" class="headerlink" title="1 API"></a>1 API</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ServletContext</code></td>
<td><code>getServletContext()</code></td>
<td>获取 <code>ServletContext</code>（所有 Servlet 共享一个）</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getInitParameter(String name)</code></td>
<td>获取 Servlet 初始化配置中指定键的值</td>
</tr>
<tr>
<td><code>Enumeration&lt;String&gt;</code></td>
<td><code>getInitParameterNames()</code></td>
<td>获取 Servlet 初始化配置所有键的枚举</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getServletName()</code></td>
<td>获取 Servlet 的名称</td>
</tr>
</tbody></table>
<h3 id="2-初始化配置"><a href="#2-初始化配置" class="headerlink" title="2 初始化配置"></a>2 初始化配置</h3><h4 id="1-web-xml-中"><a href="#1-web-xml-中" class="headerlink" title="1 web.xml 中"></a>1 <code>web.xml</code> 中</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servelt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span><span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span><span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servelt</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-注解中"><a href="#2-注解中" class="headerlink" title="2 注解中"></a>2 注解中</h4><h2 id="3-3-GenericServlet"><a href="#3-3-GenericServlet" class="headerlink" title="3.3 GenericServlet"></a>3.3 GenericServlet</h2><p><img src="https://github.com/anyeansan/pics/raw/master/CS/JavaWEB/GenericServlet.jpg" alt=""></p>
<table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>init(ServletConfig config)</code></td>
<td>重写 Servlet 的 初始化方法，内部调用了 <code>init()</code></td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>init()</code></td>
<td>特有方法，内容为空，可自定义一些初始化内容</td>
</tr>
</tbody></table>
<h2 id="3-4-HttpServlet"><a href="#3-4-HttpServlet" class="headerlink" title="3.4 HttpServlet"></a>3.4 HttpServlet</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>service(ServletRequest req, ServletResponse res)</code></td>
<td>重写 Servlet 的方法</td>
</tr>
<tr>
<td><code>protected void</code></td>
<td><code>service(HttpServletRequest req, HttpServletResponse resp)</code></td>
<td>特有方法</td>
</tr>
<tr>
<td><code>protected void</code></td>
<td><code>doXxx(HttpServletRequest req, HttpServletResponse resp)</code></td>
<td>处理 <code>GET POST PUT DELETE ...</code></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 1 重写的 service() 方法，内部判断是否是 HTTP 请求，不是则抛异常，是则强转后调用特有的 service() 方法</span></span><br><span class="line"><span class="comment">* 2 特有的 service() 方法，内部根据请求方法的类型，调用对应的 doXxx() 方法</span></span><br><span class="line"><span class="comment">* 3 所以继承 HtttpServlet 的 Servlet 只需要重写 doXxx() 方法即可（模板方法设计模式）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    HttpServletRequest  request;</span><br><span class="line">    HttpServletResponse response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        request = (HttpServletRequest) req;</span><br><span class="line">        response = (HttpServletResponse) res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(lStrings.getString(<span class="string">"http.non_http"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    service(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-ServletContext"><a href="#3-5-ServletContext" class="headerlink" title="3.5 ServletContext"></a>3.5 ServletContext</h2><h3 id="1-API-2"><a href="#1-API-2" class="headerlink" title="1 API"></a>1 API</h3><h4 id="1-获取"><a href="#1-获取" class="headerlink" title="1 获取"></a>1 获取</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>getInitParameter(String name)</code></td>
<td>获取全局配置中指定键的值</td>
</tr>
<tr>
<td><code>Enumeration&lt;String&gt;</code></td>
<td><code>getInitParameterNames()</code></td>
<td>获取全局配置所有键的枚举</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getRealPath(String path)</code></td>
<td>获取资源的绝对路径，<code>path</code> 要以 <code>/</code> 开头</td>
</tr>
<tr>
<td><code>RequestDispatcher</code></td>
<td><code>getRequestDispatcher(String path)</code></td>
<td>获取 <code>RequestDispatcher</code>，<code>path</code> 为要转发到的请求路径</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getMimeType(String file)</code></td>
<td>获取文件的 MIME 类型</td>
</tr>
</tbody></table>
<h4 id="2-域对象"><a href="#2-域对象" class="headerlink" title="2 域对象"></a>2 域对象</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Object</code></td>
<td><code>getAttribute(String name)</code></td>
<td>获取 <code>ServletContext</code> 域中指定键的值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setAttribute(String name, Object obj)</code></td>
<td>添加或修改 <code>ServletContext</code> 域中指定键的键值对</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>removeAttribute(String name)</code></td>
<td>移除 <code>ServletContext</code> 域中指定键的键值对</td>
</tr>
</tbody></table>
<h3 id="2-全局配置：web-xml-中"><a href="#2-全局配置：web-xml-中" class="headerlink" title="2 全局配置：web.xml 中"></a>2 全局配置：<code>web.xml</code> 中</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span><span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span><span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-6-RequestDispatcher"><a href="#3-6-RequestDispatcher" class="headerlink" title="3.6 RequestDispatcher"></a>3.6 RequestDispatcher</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>forward(ServletRequest req, ServletResponse res)</code></td>
<td>请求转发</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>include(ServletRequest req, ServletResponse res)</code></td>
<td>请求包含</td>
</tr>
</tbody></table>
<h2 id="3-7-HttpServletRequest"><a href="#3-7-HttpServletRequest" class="headerlink" title="3.7 HttpServletRequest"></a>3.7 HttpServletRequest</h2><h3 id="1-请求信息"><a href="#1-请求信息" class="headerlink" title="1 请求信息"></a>1 请求信息</h3><h4 id="1-请求行"><a href="#1-请求行" class="headerlink" title="1 请求行"></a>1 请求行</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><strong><code>getContextPath()</code></strong></td>
<td>获取 webapp 根路径，<code>ROOT</code> 为 <code>&quot;&quot;</code></td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getServletPath()</code></td>
<td>获取 Servlet 路径，<code>&lt;url-pattern&gt;</code> 配置的路径</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getMethod()</code></td>
<td>获取请求方法名</td>
</tr>
<tr>
<td><code>StringBuffer</code></td>
<td><code>getRequestURL()</code></td>
<td>获取请求 URL</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getRequestURI()</code></td>
<td>获取请求 URI</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getQueryString()</code></td>
<td>获取请求 URL 中的请求参数</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getProtocol()</code></td>
<td>获取协议</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getRemoteAddr()</code></td>
<td>获取请求客户端的 IP</td>
</tr>
</tbody></table>
<h4 id="2-请求头"><a href="#2-请求头" class="headerlink" title="2 请求头"></a>2 请求头</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>getHeader(String name)</code></td>
<td>获取请求头中指定键的值</td>
</tr>
<tr>
<td><code>Enumeration&lt;String&gt;</code></td>
<td><code>getHeaderNames()</code></td>
<td>获取请求头所有键的枚举</td>
</tr>
</tbody></table>
<h4 id="3-请求体"><a href="#3-请求体" class="headerlink" title="3 请求体"></a>3 请求体</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>BufferedReader</code></td>
<td><code>getReader()</code></td>
<td>获取字符输入流</td>
</tr>
<tr>
<td><code>ServletInputStream</code></td>
<td><code>getInputStream()</code></td>
<td>获取字节输入流</td>
</tr>
</tbody></table>
<h3 id="2-请求参数"><a href="#2-请求参数" class="headerlink" title="2 请求参数"></a>2 请求参数</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><strong><code>getParameter(String name)</code></strong></td>
<td>获取请求参数中指定键的值</td>
</tr>
<tr>
<td><code>String[]</code></td>
<td><code>getParameterValues(String name)</code></td>
<td>获取请求参数中指定键的值的数组</td>
</tr>
<tr>
<td><code>Map&lt;String,String[]&gt;</code></td>
<td><code>getParameterMap()</code></td>
<td>获取请求参数的所有键值<code>map</code></td>
</tr>
<tr>
<td><code>Enumeration&lt;String&gt;</code></td>
<td><code>getParameterNames()</code></td>
<td>获取请求参数所有键的枚举</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setCharacterEncoding(String env)</code></td>
<td>获取请求参数前进行设置，告诉服务器用什么编码接收请求参数（只对 POST 有效）</td>
</tr>
</tbody></table>
<h4 id="请求参数乱码问题"><a href="#请求参数乱码问题" class="headerlink" title="* 请求参数乱码问题"></a>* 请求参数乱码问题</h4><ol>
<li><p>不管哪个国家的文字，在浏览器发给服务器时，都采用 <code>ISO-8859-1</code> 编码，Tomcat 服务器默认编码和解码为 <code>iso-8859-1</code>，可通过 <code>CATALINA_HOME/conf/server.xml</code> 修改</p>
</li>
<li><p>客户端编码为 <code>&lt;meta charset=&quot;UTF-8&quot;&gt;</code> ，默认解码为 <code>GBK</code></p>
</li>
<li><p>解决请求乱码</p>
<ol>
<li><p><code>POST</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在获取参数前，设置解码与客户端编码一致即可 </span></span><br><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>GET</code> 和 <code>POST</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.1 获取请求参数，获取的是由服务器默认 `iso-8859-1` 解码的参数</span></span><br><span class="line">String name = request.getParameter(<span class="string">"name"</span>);</span><br><span class="line"><span class="comment">// 1.2 使用 `iso-8859-1` 编码，获取原始数据</span></span><br><span class="line"><span class="keyword">byte</span>[] bytes = name.getBytes(<span class="string">"iso-8859-1"</span>);</span><br><span class="line"><span class="comment">// 1.3 使用与客户端编码（假如是 utf-8）一致的码表解码即可</span></span><br><span class="line">name = <span class="keyword">new</span> String(bytes, <span class="string">"utf-8"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>GET</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 修改 tomcat 的 server.xml 配置 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br></pre></td></tr></table></figure>



</li>
</ol>
</li>
</ol>
<h3 id="3-获取"><a href="#3-获取" class="headerlink" title="3 获取"></a>3 获取</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>RequestDispatcher</code></td>
<td><code>getRequestDispatcher(String path)</code></td>
<td>获取 <code>RequestDispatcher</code>，<code>path</code> 为要转发到的请求路径</td>
</tr>
<tr>
<td><code>ServletContext</code></td>
<td><code>getServletContext()</code></td>
<td>获取 <code>ServletContext</code></td>
</tr>
<tr>
<td><code>Cookie[]</code></td>
<td><code>getCookies()</code></td>
<td>获取 <code>Cookie</code></td>
</tr>
<tr>
<td><code>HttpSession</code></td>
<td><code>getSession()</code></td>
<td>获取或创建 <code>Session</code></td>
</tr>
</tbody></table>
<h3 id="4-域对象"><a href="#4-域对象" class="headerlink" title="4 域对象"></a>4 域对象</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Object</code></td>
<td><code>getAttribute(String name)</code></td>
<td>获取 <code>request</code> 域中指定键的值</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setAttribute(String name, Object obj)</code></td>
<td>添加或修改 <code>request</code> 域中指定键的键值对</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>removeAttribute(String name)</code></td>
<td>移除 <code>request</code> 域中指定键的键值对</td>
</tr>
</tbody></table>
<h2 id="3-8-HttpServletResponse"><a href="#3-8-HttpServletResponse" class="headerlink" title="3.8 HttpServletResponse"></a>3.8 HttpServletResponse</h2><h3 id="1-响应信息"><a href="#1-响应信息" class="headerlink" title="1 响应信息"></a>1 响应信息</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>setStatus(int sc)</code></td>
<td>设置响应状态码</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setHeader(String name, String value)</code></td>
<td>设置响应头</td>
</tr>
<tr>
<td>`void</td>
<td><code>setChracterEncoding(String charset)</code></td>
<td>设置响应数据编码</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setContentType(String type)</code></td>
<td>设置响应数据 MIME 类型及编码</td>
</tr>
<tr>
<td><code>PrintWriter</code></td>
<td><code>getWriter()</code></td>
<td>获取字符输出流</td>
</tr>
<tr>
<td><code>ServletOutputStream</code></td>
<td><code>getOutputStream()</code></td>
<td>获取字节输出流</td>
</tr>
</tbody></table>
<h4 id="响应乱码"><a href="#响应乱码" class="headerlink" title="* 响应乱码"></a>* 响应乱码</h4><ol>
<li><p>响应乱码原因</p>
<ol>
<li>响应流不是我们自己创建的，而是由 tomcat 获取的，默认码表是<code>iso-8859-1</code></li>
<li>浏览器解码的码表不确定，可能与响应数据码表不一致</li>
</ol>
</li>
<li><p>解决乱码原则</p>
<ol>
<li>设置响应数据的编码</li>
<li>设置浏览器解码与响应数据编码一致</li>
</ol>
</li>
<li><p>编码设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 设置响应数据类型及浏览编码方式</span></span><br><span class="line">response.setheader(<span class="string">"content-type"</span>,<span class="string">"text/html;charset=utf-8"</span>)</span><br><span class="line"><span class="comment">// 2. 设置响应数据编码方式</span></span><br><span class="line">response.setChracterEncoding(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment">// 3. 简化以上两步</span></span><br><span class="line">response.setContentType(<span class="string">"text/html;charset=utf-8"</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="2-重定向"><a href="#2-重定向" class="headerlink" title="2 重定向"></a>2 重定向</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>sendRedirect(String location)</code></td>
<td>重定向，<code>location</code> 要加项目名</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 设置状态码，告诉客户端需要重定向</span></span><br><span class="line">response.setStatus(<span class="number">302</span>)</span><br><span class="line"><span class="comment">// 2. 告诉客户端重定向的地址</span></span><br><span class="line">response.setHeander(<span class="string">"location"</span>, String location)</span><br><span class="line"><span class="comment">// 3. 简化以上两步</span></span><br><span class="line">response.sendRedirect(String location)</span><br></pre></td></tr></table></figure>

<h3 id="3-Cookie"><a href="#3-Cookie" class="headerlink" title="3 Cookie"></a>3 Cookie</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>addCookie(Cookie cookie)</code></td>
<td>将 cookie 响应给客户端</td>
</tr>
</tbody></table>
<h1 id="四-转发-amp-重定向"><a href="#四-转发-amp-重定向" class="headerlink" title="四 转发 &amp; 重定向"></a>四 转发 &amp; 重定向</h1><h2 id="4-1-对比"><a href="#4-1-对比" class="headerlink" title="4.1 对比"></a>4.1 对比</h2><table>
<thead>
<tr>
<th>转发</th>
<th>重定向</th>
</tr>
</thead>
<tbody><tr>
<td><code>request</code> 转发</td>
<td><code>response</code> 重定向</td>
</tr>
<tr>
<td>一次请求</td>
<td>二次请求</td>
</tr>
<tr>
<td>浏览器地址栏不变</td>
<td>浏览器地址栏改变</td>
</tr>
<tr>
<td>只能访问当前应用下的资源</td>
<td>可以访问其它站点下的资源</td>
</tr>
</tbody></table>
<ul>
<li>注：重定向或者转发后，后边的代码还会执行，但通常不会写</li>
<li>重定向可以解决浏览器刷新问题</li>
</ul>
<h2 id="4-2-路径"><a href="#4-2-路径" class="headerlink" title="4.2 路径"></a>4.2 路径</h2><ul>
<li>以 <code>/</code> 开头的叫做绝对路径<ol>
<li>由服务器解析，代表当前项目路径 <code>http://localhost:8080/应用名</code><ol>
<li><code>web.xml</code> 中的 <code>/</code> 路径</li>
<li>转发中的 <code>/</code> 路径</li>
<li><code>servletContext.getRealPath(&quot;/&quot;)</code></li>
</ol>
</li>
<li>由客户端解析，代表当前服务器路径 <code>http://localhost:8080</code>，也就是需要手动添加项目名<ol>
<li><code>html</code> 中的 <code>/</code> 路径</li>
<li>重定向中的 <code>/</code> 路径</li>
<li><code>&lt;form action=&quot;/&quot;&gt;</code> </li>
</ol>
</li>
</ol>
</li>
</ul>
<h1 id="五-web-xml"><a href="#五-web-xml" class="headerlink" title="五 web.xml"></a>五 <code>web.xml</code></h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><ol>
<li>全局配置：<code>CATALINA_HOMT/conf/web.xml</code></li>
<li>局部配置：<code>CATALINA_HOME/webapps/webapp/WEB-INF/web.xml</code></li>
</ol>
<h2 id="5-2-欢迎页面（首页）"><a href="#5-2-欢迎页面（首页）" class="headerlink" title="5.2 欢迎页面（首页）"></a>5.2 欢迎页面（首页）</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span><span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span><span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>如果不配置，则使用全局配置<ul>
<li><code>index.html</code></li>
<li><code>index.htm</code></li>
<li><code>index.jsp</code></li>
</ul>
</li>
<li>欢迎页面可以有多个，前边优先级高，前边找不到则向下查找</li>
<li>欢迎页面不一定是 HTML，可以是任意资源</li>
<li>路径不需要以 <code>/</code> 开头</li>
</ol>
<h2 id="5-3-错误页面"><a href="#5-3-错误页面" class="headerlink" title="5.3 错误页面"></a>5.3 错误页面</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error.html<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/XML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/XML/" class="post-title-link" itemprop="url">XML</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:51:45 / 修改时间：20:54:56" itemprop="dateCreated datePublished" datetime="2020-11-08T20:51:45+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><ol>
<li><code>Extensible Markup Language</code></li>
<li>可扩展标记语言</li>
<li>XML 中全部是自定义标签</li>
</ol>
<h1 id="二-语法"><a href="#二-语法" class="headerlink" title="二 语法"></a>二 语法</h1><h2 id="2-1-文档声明"><a href="#2-1-文档声明" class="headerlink" title="2.1 文档声明"></a>2.1 文档声明</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="默认iso-8859-1" ?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-规范"><a href="#2-2-规范" class="headerlink" title="2.2 规范"></a>2.2 规范</h2><ol>
<li><p>只有一个根元素</p>
</li>
<li><p>元素正确闭合，嵌套</p>
</li>
<li><p>元素名区分大小写，不能以数字开头</p>
</li>
<li><p>属性值必须用引号<code>&#39;&#39;</code>或<code>&quot;&quot;</code></p>
</li>
<li><p>注释<code>&lt;!-- --&gt;</code></p>
</li>
</ol>
<h2 id="2-3-原样输出数据"><a href="#2-3-原样输出数据" class="headerlink" title="2.3 原样输出数据"></a>2.3 原样输出数据</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;![CDATA[要输出的数据]]&gt;</span><br></pre></td></tr></table></figure>

<h1 id="三-约束"><a href="#三-约束" class="headerlink" title="三 约束"></a>三 约束</h1><h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h2><ol>
<li>约束就是 xml 的书写规则</li>
<li>根元素是什么，可以写哪些标签，有哪些属性，顺序….</li>
</ol>
<h2 id="3-2-分类"><a href="#3-2-分类" class="headerlink" title="3.2 分类"></a>3.2 分类</h2><h3 id="1-dtd-约束"><a href="#1-dtd-约束" class="headerlink" title="1 dtd 约束"></a>1 dtd 约束</h3><ol>
<li><p>内部 dtd：将约束规则定义在 xml 文档中</p>
</li>
<li><p>外部 dtd：将约束的规则定义在外部的 dtd 文件中</p>
<ul>
<li><p>本地 <code>dtd</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE 根标签名 SYSTEM "dtd文件位置"&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>网络 <code>dtd</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE 根标签名 PUBLIC "名称空间(dtd文件名)" "dtd文件位置"&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h3 id="2-schema-约束"><a href="#2-schema-约束" class="headerlink" title="2 schema 约束"></a>2 schema 约束</h3><ol>
<li><p>引入实例名称空间， <code>xsi</code> 前缀</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br></pre></td></tr></table></figure>
</li>
<li><p>引入名称空间</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xsi:schemaLocation="xsd地址"</span><br><span class="line">// 如果不声明别名，使用标签格式：<span class="tag">&lt;<span class="name">地址值:标签名</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>命名空间声明：为每一个名称空间设置别名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 默认</span><br><span class="line">xmlns="..."</span><br><span class="line">2. 别名</span><br><span class="line">xmlns:别名="..."</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="四-解析"><a href="#四-解析" class="headerlink" title="四 解析"></a>四 解析</h1><h2 id="4-1-解析方式"><a href="#4-1-解析方式" class="headerlink" title="4.1 解析方式"></a>4.1 解析方式</h2><table>
<thead>
<tr>
<th>方式</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>DOM</code></td>
<td>将文档加载进内存形成 DOM 树，可以增删改查，但占内存，解析速度慢</td>
</tr>
<tr>
<td><code>SAX</code></td>
<td>逐行读取，基于事件驱动，不占内存，解析速度快，只能往下读，不能写</td>
</tr>
</tbody></table>
<h2 id="4-2-解析器"><a href="#4-2-解析器" class="headerlink" title="4.2 解析器"></a>4.2 解析器</h2><table>
<thead>
<tr>
<th>解析器</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>JAXP</code></td>
<td>sun 公司提供的解析，支持 <code>dom</code> 和 <code>sax</code></td>
</tr>
<tr>
<td><code>PULL</code></td>
<td>android 内置的解析器，<code>sax</code> 方式</td>
</tr>
<tr>
<td><code>DOM4J</code></td>
<td><code>dom for java</code>，民间方式，但好用，<code>dom</code> 方式</td>
</tr>
<tr>
<td><code>xpath</code></td>
<td>XML 路径语言，它是一种用来确定 XML 文档中某部分位置的语言，专门用于查询</td>
</tr>
<tr>
<td><code>Jsoup</code></td>
<td>可以解析 <code>html</code> 或 <code>xml</code></td>
</tr>
</tbody></table>
<h3 id="1-DOM4J"><a href="#1-DOM4J" class="headerlink" title="1 DOM4J"></a>1 DOM4J</h3><ol>
<li><p>导入 <code>dom4j.jar</code></p>
</li>
<li><p>创建解析器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SAXReader reader = new SAXReader();</span><br></pre></td></tr></table></figure>
</li>
<li><p>解析 <code>xml</code> 获得 <code>document</code> 对象 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Document document = reader.read(url);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="2-Jsoup"><a href="#2-Jsoup" class="headerlink" title="2 Jsoup"></a>2 Jsoup</h3><table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Jsoup</code></td>
<td>工具类，可以解析 <code>html</code> 或 <code>xml</code> 文档，返回 <code>Document</code> 对象</td>
</tr>
<tr>
<td><code>Document</code></td>
<td>文档对象，继承 <code>Element</code></td>
</tr>
<tr>
<td><code>Element</code></td>
<td>元素对象，继承 <code>Node</code></td>
</tr>
<tr>
<td><code>Elements</code></td>
<td>元素集合</td>
</tr>
<tr>
<td><code>Node</code></td>
<td>节点对象</td>
</tr>
</tbody></table>
<h4 id="1-Jsoup"><a href="#1-Jsoup" class="headerlink" title="1 Jsoup"></a>1 Jsoup</h4><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Document parse(File file, String character)</code></td>
<td>解析 <code>html</code> 或  <code>xml</code>文件</td>
</tr>
<tr>
<td><code>static Document parse(String html)</code></td>
<td>解析 <code>html</code> 或  <code>xml</code> 字符串</td>
</tr>
<tr>
<td><code>static Document parse(Url url, int timoutMillis)</code></td>
<td>解析网络上的 <code>html</code> 或 <code>xml</code></td>
</tr>
</tbody></table>
<h4 id="2-Document"><a href="#2-Document" class="headerlink" title="2 Document"></a>2 Document</h4><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Element getElementById(String id)</code></td>
<td>根据 id 获取元素对象</td>
</tr>
<tr>
<td><code>Elements getElementsByClass(String className)</code></td>
<td>根据 class 获取元素对象集合</td>
</tr>
<tr>
<td><code>Elements getElementsByTag(String tagName)</code></td>
<td>根据标签名获取元素对象集合</td>
</tr>
<tr>
<td><code>Elements getElementsByAttribute(String key)</code></td>
<td>根据属性名获取元素对象集合</td>
</tr>
<tr>
<td><code>Elements getElementsByAttribute(String key, String value)</code></td>
<td>根据属性名和值获取元素对象集合</td>
</tr>
</tbody></table>
<h3 id="3-Element"><a href="#3-Element" class="headerlink" title="3 Element"></a>3 Element</h3><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String attr(String key)</code></td>
<td>根据属性名获取值</td>
</tr>
<tr>
<td><code>String text()</code></td>
<td>获取标签体文本内容</td>
</tr>
<tr>
<td><code>String html()</code></td>
<td>获取标签体所有内容</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">服务器</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:51:29 / 修改时间：20:53:37" itemprop="dateCreated datePublished" datetime="2020-11-08T20:51:29+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><h2 id="1-1-服务器分类"><a href="#1-1-服务器分类" class="headerlink" title="1.1 服务器分类"></a>1.1 服务器分类</h2><table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
<th>例</th>
</tr>
</thead>
<tbody><tr>
<td>WEB 服务器 <code>HTTP Server</code></td>
<td>解析静态资源</td>
<td><code>apache, nginx, ...</code></td>
</tr>
<tr>
<td>应用服务器 <code>Application Server</code></td>
<td>解析静态资源和动态资源</td>
<td><code>tomcat, jetty, weblogic, ...</code></td>
</tr>
</tbody></table>
<h2 id="1-2-前后端分离"><a href="#1-2-前后端分离" class="headerlink" title="1.2 前后端分离"></a>1.2 前后端分离</h2><h3 id="1-Servlet"><a href="#1-Servlet" class="headerlink" title="1 Servlet"></a>1 Servlet</h3><ol>
<li><code>Servlet</code> 即负责业务逻辑又负责页面展示</li>
<li><code>Servlet</code> 页面展示要多痛苦有多痛苦：通过代码将数据和 <code>HTML</code> 响应给客户端</li>
</ol>
<h3 id="2-JSP"><a href="#2-JSP" class="headerlink" title="2 JSP"></a>2 JSP</h3><ol>
<li><code>JSP</code> 即负责业务逻辑又负责页面展示</li>
<li><code>JSP</code> 即能写 java 代码又能使用标签，但会造成 <code>JSP</code> 庞大而混乱</li>
</ol>
<h3 id="3-Servlet-JSP"><a href="#3-Servlet-JSP" class="headerlink" title="3 Servlet + JSP"></a>3 Servlet + JSP</h3><ol>
<li><code>Servlet</code> 负责业务逻辑，<code>JSP</code> 负责页面展示 </li>
<li><code>Servlet</code> 将响应数据存在域对象中，<code>JSP</code> 也是 <code>Servlet</code> ，可以从域中获取响应数据</li>
<li>问题：<ol>
<li><code>JSP</code> 要获取数据还是要在 <code>&lt;% %&gt;</code>  中写 java 代码，于是出现了 <code>EL 表达式</code> 用于获取数据</li>
<li>一些复杂的展示逻辑如循环，判断，也需要在 <code>&lt;% %&gt;</code>  中写 java 代码，于是出现了 <code>JSTL</code> 用于页面展示逻辑</li>
</ol>
</li>
<li>最终就是 <code>Servlet + JSP + EL + JSTL</code></li>
</ol>
<h3 id="4-Servlet-HTML-AJAX-JSON-JS"><a href="#4-Servlet-HTML-AJAX-JSON-JS" class="headerlink" title="4 Servlet + HTML + AJAX + JSON + JS"></a>4 Servlet + HTML + AJAX + JSON + JS</h3><ol>
<li><code>Servlet</code> 负责业务逻辑</li>
<li><code>AJAX</code> 负责请求动态数据，通常是 <code>JSON</code></li>
<li><code>JS</code> 负责 DOM，展示 <code>HTML</code></li>
</ol>
<h2 id="1-3-动静分离"><a href="#1-3-动静分离" class="headerlink" title="1.3 动静分离"></a>1.3 动静分离</h2><ol>
<li>静态资源部署在 <code>nginx</code> 服务器上，动态资源部署在 <code>tomcat</code> 应用服务器上</li>
<li>如果请求静态资源，则直接请求 <code>nginx</code></li>
<li>如果请求动态资源，则 <code>nginx</code> 利用 <strong>反向代理</strong> 将请求交给 <code>tomcat</code></li>
</ol>
<h1 id="二-JavaWeb项目"><a href="#二-JavaWeb项目" class="headerlink" title="二 JavaWeb项目"></a>二 JavaWeb项目</h1><h2 id="2-1-标准目录结构"><a href="#2-1-标准目录结构" class="headerlink" title="2.1 标准目录结构"></a>2.1 标准目录结构</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">部署项目名</span><br><span class="line">	资源文件（html、js、css、img ...）</span><br><span class="line">	WEB-INF</span><br><span class="line">		classes</span><br><span class="line">		lib</span><br><span class="line">		web.xml</span><br></pre></td></tr></table></figure>

<h2 id="2-2-源代码目录结构"><a href="#2-2-源代码目录结构" class="headerlink" title="2.2 源代码目录结构"></a>2.2 源代码目录结构</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 IDEA</span></span><br><span class="line">开发项目名</span><br><span class="line">    src</span><br><span class="line">    web</span><br><span class="line">        WEB-INF</span><br><span class="line">            classes</span><br><span class="line">            lib</span><br><span class="line">            web.xml</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 Eclipse</span></span><br><span class="line">开发项目名</span><br><span class="line">    src</span><br><span class="line">    WebContent</span><br><span class="line">        WEB-INF</span><br><span class="line">            classes</span><br><span class="line">            lib</span><br><span class="line">            web.xml</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 3 MyEclipse</span></span><br><span class="line">开发项目名</span><br><span class="line">    src</span><br><span class="line">    WebRoot    </span><br><span class="line">        WEB-INF</span><br><span class="line">            classes</span><br><span class="line">            lib</span><br><span class="line">            web.xml</span><br></pre></td></tr></table></figure>

<ol>
<li><code>src</code> 目录下的文件，编译后放在  <code>/WEB-INF/classes</code> 下</li>
<li><code>web/WebContent/WebRoot</code> 就相当于标准目录结构</li>
</ol>
<h1 id="二-Tomcat"><a href="#二-Tomcat" class="headerlink" title="二 Tomcat"></a>二 Tomcat</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><ol>
<li>服务器接收客户端请求封装 <code>HttpServletRequest</code> 对象，并传递给 web 应用</li>
<li>web 应用处理请求</li>
<li>服务器将处理结果封装到 <code>HttpServletResponse</code> 对象，响应给客户端</li>
</ol>
<h2 id="2-2-Tomcat-目录结构"><a href="#2-2-Tomcat-目录结构" class="headerlink" title="2.2 Tomcat 目录结构"></a>2.2 Tomcat 目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">├── bin</span><br><span class="line">│   ├── startup.sh </span><br><span class="line">│   ├── shutdown.sh</span><br><span class="line">│   ├── catalina.sh # Tomcat核心管理脚本</span><br><span class="line">│   └── version.sh # Tomcat版本信息脚本</span><br><span class="line">├── conf </span><br><span class="line">│   ├── Catalina</span><br><span class="line">│   ├── context.xml</span><br><span class="line">│   ├── server.xml</span><br><span class="line">│   ├── web.xml</span><br><span class="line">│   └── tomcat-users.xml # Tomcat管理用户配置文件</span><br><span class="line">├── logs</span><br><span class="line">│   ├── catalina.out # 启动信息日志</span><br><span class="line">│   └── localhost_access_log.2020-03-25.txt # 访问日志</span><br><span class="line">├── lib # 存放web应用能访问的JAR包</span><br><span class="line">├── webapps # Web应用程序根目录</span><br><span class="line">└── work # 编译目录</span><br></pre></td></tr></table></figure>

<ol>
<li><code>bin</code> 和 <code>lib</code> 目录可以被多个 Tomcat 实例共用</li>
<li><code>conf</code>、<code>logs</code>、<code>temp</code>、<code>webapps</code> 和 <code>work</code> 目录每个 Tomcat 实例必须拥有自己独立的一份</li>
</ol>
<h2 id="2-3-Tomcat-管理"><a href="#2-3-Tomcat-管理" class="headerlink" title="2.3 Tomcat 管理"></a>2.3 Tomcat 管理</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>Tomcat 管理功能用于对 Tomcat 自身以及部署在 Tomcat 的应用进行管理</li>
<li>测试用，生产环境禁用（默认禁止）</li>
<li>开启管理功能需要配置管理用户</li>
</ol>
<h3 id="2-配置管理用户"><a href="#2-配置管理用户" class="headerlink" title="2 配置管理用户"></a>2 配置管理用户</h3><ul>
<li><code>basedir/conf/tomcat-users.xml</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;tomcat-users xmlns=&quot;http://tomcat.apache.org/xml&quot;</span><br><span class="line">              xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">              xsi:schemaLocation=&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span><br><span class="line">              version=&quot;1.0&quot;&gt;</span><br><span class="line"># 配置角色</span><br><span class="line">&lt;role rolename=&quot;manager-gui&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;admin-gui&quot;/&gt;</span><br><span class="line">&lt;role rolename=&quot;host-gui&quot;/&gt;</span><br><span class="line"># 配置用户和密码并分配角色</span><br><span class="line">&lt;user username=&quot;&quot; password=&quot;&quot; roles=&quot;manager-gui,admin-gui,host-gui&quot;/&gt;</span><br><span class="line">&lt;/tomcat-users&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-允许访问"><a href="#3-允许访问" class="headerlink" title="3 允许访问"></a>3 允许访问</h3><ul>
<li><code>basedir/webapps/[host-]manager/META-INF/context.xml</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context antiResourceLocking=&quot;false&quot; privileged=&quot;true&quot; &gt;</span><br><span class="line">	# allow：允许指定 ip 和 端口</span><br><span class="line">	&lt;Valve className=&quot;org.apache.catalina.valves.RemoteAddrValve&quot;</span><br><span class="line">         allow=&quot;127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1&quot; /&gt;</span><br><span class="line">&lt;/Context&gt;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-配置文件"><a href="#2-4-配置文件" class="headerlink" title="2.4 配置文件"></a>2.4 配置文件</h2><h3 id="1-web-xml"><a href="#1-web-xml" class="headerlink" title="1 web.xml"></a>1 <code>web.xml</code></h3><ol>
<li>Web 应用程序描述文件，都是关于是 Web 应用程序的配置文件</li>
<li>所有 Web 应用的 <code>web.xml</code> 文件的父文件</li>
</ol>
<h3 id="2-context-xml"><a href="#2-context-xml" class="headerlink" title="2 context.xml"></a>2 <code>context.xml</code></h3><ol>
<li>Tomcat 公用的环境配置，tomcat 服务器会定时去扫描这个文件</li>
<li>一旦发现文件被修改（时间戳改变了），就会自动重新加载这个文件，而不需要重启服务器</li>
</ol>
<h3 id="3-server-xml"><a href="#3-server-xml" class="headerlink" title="3 server.xml"></a>3 <code>server.xml</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</span><br><span class="line">	&lt;Service name=&quot;Catalina&quot;&gt;</span><br><span class="line">		&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt;</span><br><span class="line">		&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;</span><br><span class="line">		&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;</span><br><span class="line">			&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt;</span><br><span class="line">				&lt;Context/&gt;</span><br><span class="line">			&lt;/Host&gt;</span><br><span class="line">		&lt;/Engine&gt;</span><br><span class="line">	&lt;/Service&gt;</span><br><span class="line">&lt;/Server&gt;</span><br></pre></td></tr></table></figure>

<h4 id="1-lt-Server-gt"><a href="#1-lt-Server-gt" class="headerlink" title="1 &lt;Server&gt;"></a>1 <code>&lt;Server&gt;</code></h4><ol>
<li><p>顶层元素，表示一个运行于JVM中的 tomcat 实例</p>
</li>
<li><p>一个 Server 可以有多个 Service</p>
</li>
<li><p><code>&lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&gt;</code></p>
<ul>
<li><p><code>port</code>：表示接收 shutdown 指令的端口号</p>
</li>
<li><p><code>shutdonw</code>：表示关闭此 Server 的指令</p>
</li>
</ul>
</li>
</ol>
<h4 id="2-lt-Service-gt"><a href="#2-lt-Service-gt" class="headerlink" title="2 &lt;Service&gt;"></a>2 <code>&lt;Service&gt;</code></h4><ol>
<li>将连接器 Connector 关联至引擎 Engine</li>
<li>一个 Service 可以有多个 Connector，但只能有一个 Engine</li>
</ol>
<h4 id="3-lt-Connector-gt"><a href="#3-lt-Connector-gt" class="headerlink" title="3 &lt;Connector&gt;"></a>3 <code>&lt;Connector&gt;</code></h4><ol>
<li><p>用于从客户端接收请求，之后将请求分配给引擎进行处理</p>
</li>
<li><p>HTTP 协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>表示客户端可以通过 8080 端口使用 HTTP 协议访问 tomcat</li>
<li><code>connectionTimeout</code>：超时时间</li>
<li><code>redirectPort</code>：表示当强制要求 https 而请求却是 http 时，重定向至端口号为 8443 的 Connector</li>
</ol>
</li>
<li><p>AJP协议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>表示客户端可以通过 8009 端口使用 AJP 协议访问 tomcat</li>
<li>AJP 协议负责和其他的 Http 服务器（如Apache）建立连接，在把 Tomcat 与其他服务器集成时，就需要用到这个连接器（动静分离）</li>
</ol>
</li>
</ol>
<h4 id="4-lt-Engine-gt"><a href="#4-lt-Engine-gt" class="headerlink" title="4 &lt;Engine&gt;"></a>4 <code>&lt;Engine&gt;</code></h4><ol>
<li>用于从一个或多个 Connector 中接收请求，然后转至对应的虚拟主机 Host 处理请求，并将响应返回给 Connector，最终传递给客户端</li>
<li>一个 Engine 中可以有多个 Host</li>
<li><code>&lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt;</code><ul>
<li><code>name</code><ul>
<li>用于日志和错误信息，在整个 Server 中应该是唯一的</li>
</ul>
</li>
<li><code>defaultHost</code><ul>
<li>当发往本机的请求指定的 host 不存在时，一律使用 defaultHost 指定的 host 进行处理</li>
<li>因此，defaultHost 的值，必须与 Engine 中的一个 Host 组件的 name 属性值匹配</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="5-lt-Host-gt"><a href="#5-lt-Host-gt" class="headerlink" title="5 &lt;Host&gt;"></a>5 <code>&lt;Host&gt;</code></h4><ol>
<li>一个 Host 组件代表 Engine 中的一个虚拟主机</li>
<li>一个 Host 可以有多个 Context </li>
<li><code>&lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt;</code><ul>
<li><code>name</code><ul>
<li>虚拟主机的主机名</li>
<li>一个 Engine 有且只有一个 Host 组件的 name 属性和 Engine 的 defaultHost 属性相匹配</li>
</ul>
</li>
<li><code>appBase</code><ul>
<li>Web 应用默认所在目录</li>
</ul>
</li>
<li><code>unpackWARS</code><ul>
<li>是否将代表 Web 应用的 WAR 文件解压</li>
<li><code>true</code><ul>
<li>通过解压后的文件结构运行该Web应用</li>
</ul>
</li>
<li><code>false</code><ul>
<li>直接使用WAR文件运行Web应用</li>
</ul>
</li>
</ul>
</li>
<li><code>autoDeploy</code><ul>
<li>是否自动部署</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="6-lt-Context-gt"><a href="#6-lt-Context-gt" class="headerlink" title="6 &lt;Context&gt;"></a>6 <code>&lt;Context&gt;</code></h4><ol>
<li>一个 Context 代表在虚拟主机上运行的一个Web应用</li>
<li><code>&lt;Context docBase=&quot;&quot; path=&quot;&quot; reloadable=&quot;&quot;/&gt;</code><ul>
<li><code>docBase</code><ol>
<li>指定了该Web应用使用的WAR包路径或应用目录</li>
<li>自动部署时<ol>
<li>如果 <code>docBase</code> 指定的WAR包或应用目录就在 <code>appBase</code> 中，不要指定 <code>docBase</code></li>
<li>否则，需要指定 <code>docBase</code></li>
</ol>
</li>
</ol>
</li>
<li><code>path</code><ol>
<li>指定了访问该Web应用的上下文路径，会与请求URI进行匹配</li>
<li><code>path=&quot;&quot;</code> 表示这个 Context 是虚拟主机的默认 Web 应用，当请求的URI与所有的path都不匹配时，使用该默认Web应用来处理</li>
<li>自动部署时<ol>
<li>如果没有XML配置文件且应用不在 <code>appBase</code> 下，则需要配置 <code>path</code></li>
<li>否则，不需配置 <code>path</code>，而是根据配置文件名、WAR文件名或应用目录名推导而出，例：<ol>
<li><code>xmlBase/test.xml</code> 则 <code>path=&quot;test&quot;</code></li>
<li><code>appBase/test.WAR</code> 则 <code>path=&quot;test&quot;</code></li>
<li><code>appBase/test/</code> 则 <code>path=&quot;test&quot;</code></li>
<li>如果上述文件名为 <code>ROOT</code> 则 <code>path=&quot;&quot;</code> </li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li><code>reloadable</code><ul>
<li>指示 tomcat 是否在运行时监控 <code>WEB-INF/classes</code> 和 <code>WEB-INF/lib</code> 目录下变动</li>
<li><code>true</code><ul>
<li>当有变动时，会触发 Web 应用的重新加载</li>
<li>开发环境下，方便调试</li>
</ul>
</li>
<li><code>false</code><ul>
<li>默认，因为在生产环境中设置为 true 会给服务器带来性能压力</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="2-5-Tomcat-请求流程"><a href="#2-5-Tomcat-请求流程" class="headerlink" title="2.5 Tomcat 请求流程"></a>2.5 Tomcat 请求流程</h2><ol>
<li>请求此 Server </li>
<li>根据 Connector 配置协议和端口号选定 Service 和 Engine</li>
<li>根据域名和 IP 选定 Host</li>
<li>根据 URI 选定 Context/Web应用</li>
</ol>
<h2 id="2-6-Tomcat-部署应用"><a href="#2-6-Tomcat-部署应用" class="headerlink" title="2.6 Tomcat 部署应用"></a>2.6 Tomcat 部署应用</h2><h3 id="1-部署形式"><a href="#1-部署形式" class="headerlink" title="1 部署形式"></a>1 部署形式</h3><ol>
<li>应用目录</li>
<li>WAR包</li>
</ol>
<h3 id="2-部署方式"><a href="#2-部署方式" class="headerlink" title="2 部署方式"></a>2 部署方式</h3><h4 id="1-静态部署"><a href="#1-静态部署" class="headerlink" title="1 静态部署"></a>1 静态部署</h4><ol>
<li>在 <code>server.xml</code> 中通过 <code>&lt;context&gt;</code> 元素静态部署Web应用</li>
<li>不推荐静态部署，因为 <code>server.xml</code> 是不可动态重加载的资源，服务器一旦启动，要修改这个文件，就得重启服务器才能重新加载。</li>
<li>自动部署可以在 Tomcat 运行时通过定期的扫描来实现重新部署应用，不需要重启服务器</li>
</ol>
<h4 id="2-自动部署"><a href="#2-自动部署" class="headerlink" title="2 自动部署"></a>2 自动部署</h4><h5 id="1-开启自动部署"><a href="#1-开启自动部署" class="headerlink" title="1 开启自动部署"></a>1 开启自动部署</h5><ol>
<li>要开启自动部署，需要配置所在的虚拟主机，即 <code>server.xml</code> 中的 <code>&lt;Host&gt;</code></li>
<li><code>&lt;Host xmlBase=&quot;&quot; appBase=&quot;&quot; autoDeploy=&quot;true&quot; deployOnStartup=&quot;true&quot;</code><ul>
<li><code>xmlBase</code><ul>
<li>指定Web应用的XML配置文件所在的目录，默认值 <code>basedir/conf/&lt;engine_name&gt;/&lt;host_name&gt;</code></li>
</ul>
</li>
<li><code>appBase</code><ul>
<li>指定Web应用所在的目录，默认值 <code>webapps</code></li>
</ul>
</li>
<li><code>autoDeploy=&quot;true&quot;</code><ul>
<li>表示 Tomcat 在运行时定期检查新的Web应用或Web应用的更新</li>
</ul>
</li>
<li><code>deployOnStartup=&quot;true&quot;</code><ul>
<li>表示 Tomcat 在启动时检查Web应用，且将所有检测到的Web应用视作新应用</li>
</ul>
</li>
</ul>
</li>
<li>开启自动部署之后，通过检查 <code>xmlBase</code> 和 <code>appBase</code> 指定的目录是否有新的或更新的应用来实现自动部署，检查顺序<ol>
<li><code>xmlBase</code> 下的 XML 配置文件</li>
<li><code>appBase</code> 下的 WAR 文件</li>
<li><code>appBase</code> 下的应用目录</li>
</ol>
</li>
</ol>
<h5 id="2-自动部署实现方式"><a href="#2-自动部署实现方式" class="headerlink" title="2 自动部署实现方式"></a>2 自动部署实现方式</h5><ol>
<li>WAR 文件或应用目录直接添加到 tomcat 的 <code>appBase</code> 指定的目录下</li>
<li>WAR 文件或应用目录在别处，通过在 <code>basedir/conf/server.xml</code> 中配置 <code>Conctext</code> 指明应用路径<ul>
<li>由于要配置 <code>server.xml</code> ，所以重新部署需要重启</li>
</ul>
</li>
<li>WAR 文件或应用目录在别处，通过配置 <code>xmlBase</code> 下的 XML 配置文件指明应用路径<ul>
<li>重新部署不需要重启</li>
</ul>
</li>
</ol>
<h5 id="3-IDE-的自动部署"><a href="#3-IDE-的自动部署" class="headerlink" title="3 IDE 的自动部署"></a>3 IDE 的自动部署</h5><h6 id="1-MyEclipse"><a href="#1-MyEclipse" class="headerlink" title="1 MyEclipse"></a>1 MyEclipse</h6><ol>
<li>MyEclipse 使用方式一</li>
<li>直接将 WAR 文件或应用目录复制到 <code>basedir/webapps</code> 下</li>
<li>因为应用就在 <code>appBase</code> 中，所以不需要配置 <code>Context</code></li>
</ol>
<h6 id="2-Eclipse"><a href="#2-Eclipse" class="headerlink" title="2 Eclipse"></a>2 Eclipse</h6><ol>
<li><p>Eclipse 使用方式二</p>
</li>
<li><p>Eclipse 本质是在其 <code>workspace</code> 下映射了一个 tomcat 的镜像，每创建一个 tomcat，就生成文件名为 <code>tmp编号</code> 的 tomcat 镜像，Eclipse 通过这个镜像 tomcat 运行应用</p>
</li>
<li><p><code>Catalina_Base</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp0/wtpwebapps</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>basedir/conf/server.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Host&gt;</span><br><span class="line">	&lt;Context docBase=&quot;应用的真实路径&quot; path=&quot;网络访问的虚拟路径名(自定义)&quot; /&gt;</span><br><span class="line">&lt;/Host&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h6 id="3-Intellij"><a href="#3-Intellij" class="headerlink" title="3 Intellij"></a>3 Intellij</h6><ol>
<li><p>Intellij 使用方式三</p>
</li>
<li><p>Intellij 在 <code>configdir/system/tomcat/</code> 创建了新的 tomcat 实例</p>
</li>
<li><p>部署应用时，会在 tomcat 实例的 <code>conf/catalina/localhost</code> 目录下自动创建 XML 配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Context docBase=&quot;应用的真实路径&quot; path=&quot;与 XML 配置文件名相同，其实不用配置&quot;/&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>如果部署时指定了应用名，如 <code>/test</code>，则 XML 配置文件名称为 <code>test.xml</code>，<code>paht=&quot;test&quot;</code></li>
<li>如果部署时省略了应用名，即 <code>/</code>，则 XML 配置文件名称为 <code>ROOT.xml</code>，<code>paht=&quot;&quot;</code></li>
</ol>
</li>
</ol>
<h2 id="2-7-Tomcat-启动-amp-访问"><a href="#2-7-Tomcat-启动-amp-访问" class="headerlink" title="2.7 Tomcat 启动 &amp; 访问"></a>2.7 Tomcat 启动 &amp; 访问</h2><h3 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1 概述"></a>1 概述</h3><h4 id="1-CATALINA-HOME"><a href="#1-CATALINA-HOME" class="headerlink" title="1 CATALINA_HOME"></a>1 <code>CATALINA_HOME</code></h4><ol>
<li>是 Tomcat 的安装目录</li>
<li>指向公用信息的位置，就是 <code>bin</code> 和 <code>lib</code> 目录的父目录</li>
</ol>
<h4 id="2-CATALINA-BASE"><a href="#2-CATALINA-BASE" class="headerlink" title="2 CATALINA_BASE"></a>2 <code>CATALINA_BASE</code></h4><ol>
<li>是 Tomcat 的工作目录</li>
<li>指向每个 Tomcat 目录私有信息的位置，即 <code>conf、logs、temp、webapps</code> 和 <code>work</code> 目录的父目录</li>
<li>一个 <code>CATALINA_BASE</code> 就代表一个 Tomcat 实例 </li>
<li>如果 <code>CATALINA_BASE</code> 没有值的话，则默认值就是 <code>CATALINA_HOME</code></li>
</ol>
<h3 id="2-启动"><a href="#2-启动" class="headerlink" title="2 启动"></a>2 启动</h3><ol>
<li>执行 <code>startup.bat</code> ，其实最终是执行 <code>catalina.bat</code> </li>
<li>Tomcat 启动时，需要查找 <code>CATALINA_HOME</code> 这个环境变量，并判断是否为空<ol>
<li><code>CATALINA_HOME</code>  不为空，则根据值查找 <code>bin/catalina.bat</code> ，找到就执行，找不到报错</li>
<li><code>CATALINA_HOME</code>  为空<ol>
<li>就将当前目录设为 <code>CATALINA_HOME</code> 的值，接着判断当前目录下是否存在 <code>bin/catalina.bat</code></li>
<li>如果不存在，将当前目录的父目录设为 <code>CATALINA_HOME</code> 的值，继续判断 <code>bin/catalina.bat</code>，一直循环</li>
<li>最后如果找到就执行，找不到就报错</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="3-访问"><a href="#3-访问" class="headerlink" title="3 访问"></a>3 访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://ip:port/path/source</span><br></pre></td></tr></table></figure>

<ol>
<li><code>port</code> <ul>
<li>省略则访问 <code>80</code> 端口</li>
</ul>
</li>
<li><code>path</code> <ul>
<li>省略则访问 <code>ROOT</code></li>
</ul>
</li>
<li><code>source</code><ul>
<li>省略则访问首页</li>
</ul>
</li>
</ol>
<h1 id="三-Nginx"><a href="#三-Nginx" class="headerlink" title="三 Nginx"></a>三 Nginx</h1><h2 id="3-1-安装"><a href="#3-1-安装" class="headerlink" title="3.1 安装"></a>3.1 安装</h2><ol>
<li><p>配置官方yum源（官网查看）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo</span><br><span class="line"></span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx -y</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-2-目录结构"><a href="#3-2-目录结构" class="headerlink" title="3.2 目录结构"></a>3.2 目录结构</h2><table>
<thead>
<tr>
<th>目录</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>/etc/logrotate.d/nginx</code></td>
<td>实现nginx日志切割</td>
</tr>
<tr>
<td><code>/etc/nginx</code></td>
<td>配置文件所在目录</td>
</tr>
<tr>
<td><code>/var/log/nginx</code></td>
<td>日志目录</td>
</tr>
<tr>
<td><code>var/cache/nginx</code></td>
<td>缓存目录</td>
</tr>
<tr>
<td><code>/usr/sbin/nginx</code></td>
<td>命令文件</td>
</tr>
<tr>
<td><code>/usr/sbin/nginx-debug</code></td>
<td>debug命令文件</td>
</tr>
<tr>
<td><code>/usr/share/nginx/html</code></td>
<td>默认站点目录（图片 音视频 附件… ）</td>
</tr>
</tbody></table>
<h2 id="3-3-配置文件"><a href="#3-3-配置文件" class="headerlink" title="3.3 配置文件"></a>3.3 配置文件</h2><h3 id="1-etc-nginx-nginx-conf（主配置文件）"><a href="#1-etc-nginx-nginx-conf（主配置文件）" class="headerlink" title="1 /etc/nginx/nginx.conf（主配置文件）"></a>1 <code>/etc/nginx/nginx.conf</code>（主配置文件）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1 基本配置</span><br><span class="line">user  nginx;  # 定义 worker_process 的管理用户，所有请求都会映射成此用户</span><br><span class="line">worker_processes  1; # 定义有几个worder_process（建议=cpu核数）</span><br><span class="line">error_log  /var/log/nginx/error.log warn; # 定义错误日志路径信息</span><br><span class="line">pid        /var/run/nginx.pid; # 定义pid文件路径信息</span><br><span class="line">2 事件区域配置</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024; # 1 个worker process可以同时接收1024访问请求</span><br><span class="line">&#125;</span><br><span class="line"># http区域配置</span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types; # 加载一个配置文件</span><br><span class="line">    default_type  application/octet-stream; # 指定默认识别文件类型</span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;  # 定义日志的格式</span><br><span class="line">    access_log  /var/log/nginx/access.log  main; # 指定日志路径（main 表示使用main定义的格式）</span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line">    keepalive_timeout  65; # 超时时间</span><br><span class="line">    #gzip  on;</span><br><span class="line">    include /etc/nginx/conf.d/*.conf; # 加载一个配置文件</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Nginx 有两个进程<ol>
<li><code>master process</code><ul>
<li>管理服务是否正常运行</li>
</ul>
</li>
<li><code>worker process</code><ul>
<li>处理用户的访问请求</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="2-etc-nginx-conf-d-default-conf（扩展配置-默认虚拟主机配置文件-）"><a href="#2-etc-nginx-conf-d-default-conf（扩展配置-默认虚拟主机配置文件-）" class="headerlink" title="2 /etc/nginx/conf.d/default.conf（扩展配置(默认虚拟主机配置文件)）"></a>2 <code>/etc/nginx/conf.d/default.conf</code>（扩展配置(默认虚拟主机配置文件)）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">4 server区域信息（配置一个网站，即一个虚拟主机）</span><br><span class="line">server &#123;</span><br><span class="line">    listen       80; # 监听端口</span><br><span class="line">    server_name  localhost; # 网站域名</span><br><span class="line">    location / &#123; # 表示匹配URI以 / 开头的请求</span><br><span class="line">        root   /usr/share/nginx/html; # 定义站点目录的位置</span><br><span class="line">        index  index.html index.htm; # 定义首页文件</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html; # 优雅显示错误页面信息</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-利用-Nginx-搭建网站"><a href="#3-4-利用-Nginx-搭建网站" class="headerlink" title="3.4 利用 Nginx 搭建网站"></a>3.4 利用 Nginx 搭建网站</h2><ol>
<li><p>创建虚拟主机配置文件 <code>/etc/nginx/conf.d/xxx.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       8090;</span><br><span class="line">    server_name  www.iisfive.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">一个端口可配置多个域名 www、blog、bbs...</span><br></pre></td></tr></table></figure>
</li>
<li><p>网站代码文件</p>
</li>
<li><p>DNS 配置</p>
<ol>
<li>真实域名，在域名网站配置</li>
<li>模拟域名，在 Windows 的 hosts 文件配置</li>
</ol>
</li>
</ol>
<h2 id="3-5-虚拟主机访问方式"><a href="#3-5-虚拟主机访问方式" class="headerlink" title="3.5 虚拟主机访问方式"></a>3.5 虚拟主机访问方式</h2><ol>
<li>基于域名访问</li>
<li>基于地址访问<ul>
<li>服务器可能有多个IP，在虚拟主机配置的server中指定只能访问指定地址 <code>listen ip:port</code></li>
</ul>
</li>
<li>基于端口访问</li>
</ol>
<h2 id="3-6-模块-Module"><a href="#3-6-模块-Module" class="headerlink" title="3.6 模块 Module"></a>3.6 模块 Module</h2><ol>
<li><code>ngx_http_access_module</code><ul>
<li>根据访问的服务器地址进行指定资源的控制</li>
</ul>
</li>
<li><code>ngx_http_auth_basic_module</code><ul>
<li>访问认证</li>
</ul>
</li>
<li><code>ngx_http_autoindex_module</code><ul>
<li>文件共享</li>
</ul>
</li>
<li><code>ngx_http_stub_status_module</code><ul>
<li>状态监控</li>
</ul>
</li>
<li><code>ngx_http_rewrite_module</code><ul>
<li>页面跳转</li>
</ul>
</li>
<li><code>ngx_http_upstream_module</code><ul>
<li>负载均衡</li>
</ul>
</li>
<li><code>ngx_http_proxy_module</code><ul>
<li>反向代理</li>
</ul>
</li>
<li><code>ngx_http_core_module</code><ul>
<li>核心模块</li>
<li>location<ol>
<li><code>location = /</code><ul>
<li>精确匹配</li>
</ul>
</li>
<li><code>location /</code><ul>
<li>默认匹配，没有匹配时匹配默认</li>
</ul>
</li>
<li><code>location = /test</code><ul>
<li>目录匹配</li>
</ul>
</li>
<li><code>location ^~ /text</code><ul>
<li>优先匹配</li>
</ul>
</li>
<li><code>location ~* \.jpg</code><ul>
<li>扩展名</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<h2 id="3-7-负载均衡"><a href="#3-7-负载均衡" class="headerlink" title="3.7 负载均衡"></a>3.7 负载均衡</h2><ol>
<li>集群<ul>
<li>完成相同任务的一组服务器</li>
</ul>
</li>
<li>负载均衡<ul>
<li>对用户访问请求进行调度分配，实现用户访问压力分担</li>
</ul>
</li>
<li>正向代理 &amp; 反向代理<ol>
<li>正向代理<ol>
<li>正向代理代理的对象是客户端</li>
<li>客户端明确知道要访问的目标服务器，但由于一些原因不能直接访问，则通过代理服务器来访问。</li>
<li>正向代理隐藏了真实的请求客户端，服务端不知道真实的客户端是谁，客户端请求的服务都被代理服务器代替来请求</li>
</ol>
</li>
<li>反向代理<ol>
<li>反向代理代理的对象是服务端</li>
<li>客户端请求代理服务器，代理服务器帮客户端把请求转发到真实的服务器那里去</li>
<li>反向代理隐藏了真实的服务端，可能有许多台服务器提供服务，客户端并不知道也不需要知道具体是哪一台服务器处理此次请求。</li>
</ol>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/11/08/JavaWeb/JDBC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/11/08/JavaWeb/JDBC/" class="post-title-link" itemprop="url">JDBC</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-11-08 20:49:09 / 修改时间：20:54:04" itemprop="dateCreated datePublished" datetime="2020-11-08T20:49:09+08:00">2020-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><p><img src="https://github.com/anyeansan/pics/raw/master/CS/Java/JDBC.png" alt=""></p>
<ol>
<li><code>Java Database Connectivity</code> </li>
<li>JDBC 是 SUN 公司提供的一套访问数据库的标准规范，由各个数据库厂商来实现（数据库驱动）</li>
<li>Java 开发时面向接口编程，运行时加载对应的数据库驱动即可</li>
<li>JDBC 主要完成三件事<ol>
<li>建立连接</li>
<li>发送SQL语句</li>
<li>处理返回的结果</li>
</ol>
</li>
</ol>
<h1 id="二-API"><a href="#二-API" class="headerlink" title="二 API"></a>二 API</h1><h2 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h2><table>
<thead>
<tr>
<th>接口/类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>java.sql.DriverManager</code></td>
<td>驱动管理类，用于注册驱动</td>
</tr>
<tr>
<td><code>java.sql.Connection</code></td>
<td>连接</td>
</tr>
<tr>
<td><code>java.sql.Statement</code></td>
<td>执行 SQL 语句</td>
</tr>
<tr>
<td><code>java.sql.PreparedStatement</code></td>
<td><code>Statement</code> 子接口，预编译</td>
</tr>
<tr>
<td><code>java.sql.ResultSet</code></td>
<td>结果集，提供一个游标，默认指向结果集第一行之前</td>
</tr>
</tbody></table>
<h2 id="2-2-DriverManager"><a href="#2-2-DriverManager" class="headerlink" title="2.2 DriverManager"></a>2.2 DriverManager</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static void</code></td>
<td><code>registerDriver​(Driver driver)</code></td>
<td>注册驱动</td>
</tr>
<tr>
<td><code>static Connection</code></td>
<td><code>getConnection​(String url)</code></td>
<td>获取连接</td>
</tr>
<tr>
<td><code>static Connection</code></td>
<td><code>getConnection​(String url, String user, String password)</code></td>
<td>获取连接</td>
</tr>
<tr>
<td><code>static Connection</code></td>
<td><code>getConnection​(String url, Properties info)</code></td>
<td>获取连接</td>
</tr>
</tbody></table>
<h2 id="2-3-Connection"><a href="#2-3-Connection" class="headerlink" title="2.3 Connection"></a>2.3 Connection</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Statement</code></td>
<td><code>createStatement()</code></td>
<td>获取 Statement</td>
</tr>
<tr>
<td><code>PreparedStatement</code></td>
<td><code>prepareStatement​(String sql)</code></td>
<td>获取 PreparedStatement</td>
</tr>
<tr>
<td><code>CallableStatement</code></td>
<td><code>prepareCall​(String sql)</code></td>
<td>获取 CallableStatement</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setAutoCommit​(boolean autoCommit)</code></td>
<td>是否开启自动提交</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setTransactionIsolation​(int level)</code></td>
<td>设置隔离级别</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>rollback()</code></td>
<td>回滚</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>commit()</code></td>
<td>提交</td>
</tr>
</tbody></table>
<h2 id="2-4-Statement"><a href="#2-4-Statement" class="headerlink" title="2.4 Statement"></a>2.4 Statement</h2><h3 id="1-方法"><a href="#1-方法" class="headerlink" title="1 方法"></a>1 方法</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ResultSet</code></td>
<td><code>executeQuery​(String sql)</code></td>
<td>执行 DQL <code>select</code>，返回结果集</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>executeUpdate​(String sql)</code></td>
<td>执行 DML <code>insert update delete</code> 返回影响行数，执行 DDL 返回 <code>0</code></td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>execute​(String sql)</code></td>
<td>执行任意 SQL 语句，仅当执行 DQL 且有结果集时返回 <code>true</code></td>
</tr>
</tbody></table>
<h3 id="2-Statement-的问题"><a href="#2-Statement-的问题" class="headerlink" title="2 Statement 的问题"></a>2 Statement 的问题</h3><ol>
<li>SQL 拼接，各种单引号和双引号嵌套，很麻烦</li>
<li>SQL 注入<ul>
<li>使用字符串拼接，导致 SQL 语句判断条件总是为 <code>true</code>，安全隐患</li>
<li>如 <code>select * from test where name = &#39;wangcai&#39; or 1=1</code></li>
</ul>
</li>
<li>无法处理 <code>blob</code> 等二进制类型数据</li>
</ol>
<h2 id="2-5-PreparedStatement"><a href="#2-5-PreparedStatement" class="headerlink" title="2.5 PreparedStatement"></a>2.5 PreparedStatement</h2><h3 id="1-方法-1"><a href="#1-方法-1" class="headerlink" title="1 方法"></a>1 方法</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ResultSet</code></td>
<td><code>executeQuery()</code></td>
<td>执行 DQL <code>select</code>，返回结果集</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>executeUpdate()</code></td>
<td>执行 DML <code>insert update delete</code> 返回影响行数，执行 DDL 返回 <code>0</code></td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>execute()</code></td>
<td>执行任意 SQL 语句，仅当执行 DQL 且有结果集时返回 <code>true</code></td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setInt​(int parameterIndex, int x)</code></td>
<td>为指定类型占位符赋值，根据占位符顺序，从 1 开始</td>
</tr>
</tbody></table>
<ul>
<li>有一系列的 <code>setXxx()</code> 重载方法，为不同的类型赋值</li>
</ul>
<h3 id="2-解决-Statement-的问题"><a href="#2-解决-Statement-的问题" class="headerlink" title="2 解决 Statement 的问题"></a>2 解决 Statement 的问题</h3><ol>
<li>SQL 语句使用 <code>?</code> 占位符，不需要手动拼接，从而也避免了 SQL 注入</li>
<li>为占位符赋值时可以使用二进制</li>
</ol>
<h3 id="3-插入数据后获取自增长的值"><a href="#3-插入数据后获取自增长的值" class="headerlink" title="3 插入数据后获取自增长的值"></a>3 插入数据后获取自增长的值</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// autoGeneratedKeys：Statement 中定义的常量，其中 RETURN_GENERATED_KEYS 可以获取自增值的值</span></span><br><span class="line"><span class="function">PreparedStatement <span class="title">prepareStatement</span><span class="params">(String sql, <span class="keyword">int</span> autoGeneratedKeys)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">// 2 设置之后，插入时可以使用 PreparedStatement 对象获取一个结果集</span></span></span><br><span class="line"><span class="function">ResultSet <span class="title">getGeneratedKeys</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h2 id="2-6-ResultSet"><a href="#2-6-ResultSet" class="headerlink" title="2.6 ResultSet"></a>2.6 ResultSet</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>boolean</code></td>
<td><code>next()</code></td>
<td>将游标从当前位置向下移一行</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getInt​(int columnIndex)</code></td>
<td>根据索引获取指定类型的值，索引从 1 开始</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getInt​(String columnLabel)</code></td>
<td>根据列名获取指定类型的值</td>
</tr>
<tr>
<td><code>Object</code></td>
<td><code>getObject​(int columnIndex)</code></td>
<td>不清楚类型可以使用Object</td>
</tr>
<tr>
<td><code>Object</code></td>
<td><code>getObject​(String columnLabel)</code></td>
<td>不清楚类型可以使用Object</td>
</tr>
<tr>
<td><code>ResultSetMetaData</code></td>
<td><code>getMetaData()</code></td>
<td>获取结果集元数据，包含记录数，字段信息（个数，类型，名称 …）</td>
</tr>
</tbody></table>
<ul>
<li>有一系列的各种数据类型的 <code>getXxx()</code> 重载方法，且都有根据列名和索引获取两种方式</li>
</ul>
<h1 id="三-Mysql-和-java-类型"><a href="#三-Mysql-和-java-类型" class="headerlink" title="三 Mysql 和 java 类型"></a>三 Mysql 和 java 类型</h1><h2 id="3-1-java-sql-ResultSetMetaData（结果集元数据）"><a href="#3-1-java-sql-ResultSetMetaData（结果集元数据）" class="headerlink" title="3.1 java.sql.ResultSetMetaData（结果集元数据）"></a>3.1 <code>java.sql.ResultSetMetaData</code>（结果集元数据）</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>int</code></td>
<td><code>getColumnCount()</code></td>
<td>获取记录数</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getColumnTypeName​(int column)</code></td>
<td>获取字段对应的数据库类型，编号从 1 开始</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getColumnClassName​(int column)</code></td>
<td>获取字段对应的 java 类型，编号从 1 开始</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getColumnName​(int column)</code></td>
<td>获取字段在数据库中的名称</td>
</tr>
<tr>
<td><code>String</code></td>
<td><code>getColumnLabel​(int column)</code></td>
<td>获取字段别名</td>
</tr>
</tbody></table>
<ol>
<li>使用反射根据属性名获取 <code>Field</code> 对象时，如果数据库字段名和类属性名不一致，就获取不到</li>
<li>可以使用别名，让别名=类属性名</li>
<li>类属性名建议都是用引用类型，因为数据库数据可能为空</li>
</ol>
<h2 id="3-2-类型对照"><a href="#3-2-类型对照" class="headerlink" title="3.2 类型对照"></a>3.2 类型对照</h2><table>
<thead>
<tr>
<th><code>Mysql Type name</code>（数据库设计类型）</th>
<th><code>GetColumnTypeName</code>（数据库类型）</th>
<th><code>GetColumnClassName</code>（java 类型）</th>
</tr>
</thead>
<tbody><tr>
<td><code>INT</code></td>
<td><code>INTEGER</code></td>
<td><code>java.lang.Integer</code></td>
</tr>
<tr>
<td><code>INT UNSIGNED</code></td>
<td><code>INTEGER UNSIGNED</code></td>
<td><code>java.lang.Long</code></td>
</tr>
<tr>
<td><code>CHAR(M)</code></td>
<td><code>CHAR</code></td>
<td><code>java.lang.String</code></td>
</tr>
<tr>
<td><code>VARCHAR(M)</code></td>
<td><code>VARCHAR</code></td>
<td><code>java.lang.String</code></td>
</tr>
<tr>
<td><code>ENUM(&#39;value1&#39;,&#39;value2&#39;,...)</code></td>
<td><code>CHAR</code></td>
<td><code>java.lang.String</code></td>
</tr>
<tr>
<td><code>SET(&#39;value1&#39;,&#39;value2&#39;,...)</code></td>
<td><code>CHAR</code></td>
<td><code>java.lang.String</code></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>DATE</code></td>
<td><code>java.sql.Date</code></td>
</tr>
<tr>
<td><code>DATETIME</code></td>
<td><code>DATETIME</code></td>
<td><code>java.sql.Timestamp</code></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>TIMESTAMP</code></td>
<td><code>java.sql.Timestamp</code></td>
</tr>
</tbody></table>
<h1 id="四-JDBC-步骤"><a href="#四-JDBC-步骤" class="headerlink" title="四 JDBC 步骤"></a>四 JDBC 步骤</h1><ol>
<li><p>导入数据库驱动包</p>
</li>
<li><p>注册驱动</p>
<ol>
<li><p>手动注册（不推荐）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> DriverManager.registerDriver(Driver driver)</span><br></pre></td></tr></table></figure>

<ol>
<li>对具体的驱动类产生了依赖，不方便扩展</li>
<li>驱动重复注册<ol>
<li>调用此方法注册一次</li>
<li>加载 <code>Driver</code> 类又注册一次，因为 <code>Driver</code> 类中的静态代码块就是调用了此方法</li>
</ol>
</li>
</ol>
</li>
<li><p>反射注册（推荐）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过反射加载 Driver 类时执行静态代码块，注册驱动</span></span><br><span class="line">Class.forName(<span class="string">"com.mysql..cj.jdbc.Driver"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>获取连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = DriverManager.getConnection(url,user.passwd)</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行 SQL 语句，获取结果集</p>
<ol>
<li>Statement（不推荐）<ol>
<li>编写静态 SQL 语句</li>
<li>根据连接获取 <code>Statement</code> 对象</li>
<li>使用 <code>Statement</code> 对象执行 SQL，获取结果集</li>
</ol>
</li>
<li>PreparedStatement（推荐）<ol>
<li>编写动态 SQL 语句（参数使用 <code>?</code> 作为占位符）</li>
<li>根据连接获取 <code>PreparedStatement</code> 对象</li>
<li>使用 <code>PreparedStatement</code> 对象为 SQL 占位符赋值</li>
<li>使用 <code>PreparedStatement</code> 对象执行，获取结果集</li>
</ol>
</li>
</ol>
</li>
<li><p>处理结果集</p>
</li>
<li><p>关闭资源（ResultSet Statement Connection）</p>
</li>
</ol>
<h1 id="五-批处理"><a href="#五-批处理" class="headerlink" title="五 批处理"></a>五 批处理</h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><ol>
<li>当需要成批插入或者更新记录时，可以采用 Java 的批量更新机制，这一机制允许多条语句一次性提交给数据库批量处理。</li>
<li>通常情况下比单独提交处理更有效率，类似缓冲区的效果</li>
</ol>
<h2 id="5-2-使用"><a href="#5-2-使用" class="headerlink" title="5.2 使用"></a>5.2 使用</h2><ol>
<li>Mysql 服务器默认是关闭批处理的，需要<code>url</code> 配置 <code>rewriteBatchedStatements=true</code> 来开启</li>
<li><code>void addBatch()</code><ul>
<li>将需要批量处理的SQL语句或参数添加到批处理组中，类似添加到缓冲区</li>
</ul>
</li>
<li><code>int[] executeBatch()</code><ul>
<li>执行批处理</li>
</ul>
</li>
</ol>
<h1 id="六-JDBC-事务"><a href="#六-JDBC-事务" class="headerlink" title="六 JDBC 事务"></a>六 JDBC 事务</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 关闭自动提交：开启事务</span></span><br><span class="line">conn.setAutoCommit(<span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 回滚或提交</span></span><br><span class="line">conn.rollback()</span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3 关闭连接前恢复自动提交，因为连接通常从连接池中获取，是重复使用的</span></span><br><span class="line">conn.setAutoCommit(<span class="keyword">true</span>)</span><br></pre></td></tr></table></figure>

<h1 id="七-MySQL-数据库驱动"><a href="#七-MySQL-数据库驱动" class="headerlink" title="七 MySQL 数据库驱动"></a>七 MySQL 数据库驱动</h1><h2 id="7-1-Connector-J-5"><a href="#7-1-Connector-J-5" class="headerlink" title="7.1 Connector/J 5"></a>7.1 Connector/J 5</h2><table>
<thead>
<tr>
<th>属性</th>
<th>语法</th>
</tr>
</thead>
<tbody><tr>
<td><code>driver</code></td>
<td><code>com.mysql.jdbc.Driver</code></td>
</tr>
<tr>
<td><code>url</code></td>
<td><code>jdbc:mysql://localhost:3306/db_name</code></td>
</tr>
</tbody></table>
<h2 id="7-2-Connector-J-8"><a href="#7-2-Connector-J-8" class="headerlink" title="7.2 Connector/J 8"></a>7.2 Connector/J 8</h2><table>
<thead>
<tr>
<th>属性</th>
<th>语法</th>
<th>例</th>
</tr>
</thead>
<tbody><tr>
<td><code>driver</code></td>
<td><code>com.mysql.cj.jdbc.Driver</code></td>
<td><code>com.mysql.cj.jdbc.Driver</code></td>
</tr>
<tr>
<td><code>url</code></td>
<td><code>protocol//[hosts][/database][?properties]</code></td>
<td><code>jdbc:mysql://localhost:3306/db_name?useSSL=false&amp;serverTimezone=GMT%2B8&amp;characterEncoding=UTF-8</code></td>
</tr>
</tbody></table>
<h2 id="7-3-Connector-J-8-中-url-的-properties"><a href="#7-3-Connector-J-8-中-url-的-properties" class="headerlink" title="7.3 Connector/J 8 中 url 的 properties"></a>7.3 Connector/J 8 中 url 的 properties</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li>格式 <code>key=value</code>，多个之间使用 <code>&amp;</code> 连接</li>
<li>在 Xml 中应该使用字符的特殊编码：<code>&amp;</code> 对应 <code>&amp;amp;</code></li>
</ol>
<h3 id="2-key"><a href="#2-key" class="headerlink" title="2 key"></a>2 key</h3><table>
<thead>
<tr>
<th>key</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>useSSL</code></td>
<td>是否使用 SSL 连接，默认 <code>true</code></td>
</tr>
<tr>
<td><code>characterEncoding</code></td>
<td>设置字符集</td>
</tr>
<tr>
<td><code>serverTimezone</code></td>
<td>设置时区</td>
</tr>
<tr>
<td><code>rewriteBatchedStatements</code></td>
<td>是否开启批处理，默认 <code>false</code></td>
</tr>
</tbody></table>
<h4 id="1-SSL-（Secure-Socket-Layer）"><a href="#1-SSL-（Secure-Socket-Layer）" class="headerlink" title="1 SSL （Secure Socket Layer）"></a>1 SSL （Secure Socket Layer）</h4><ol>
<li>安全套接字层，用于安全连接，但是影响性能</li>
<li>若要使用 SSL 需要在 Mysql 服务端配置</li>
<li>Mysql 8.0 之前<ol>
<li><code>5.5.45+，5.6.26+，5.7.6+</code> 默认为 <code>true</code></li>
<li>其它默认为 <code>false</code></li>
</ol>
</li>
<li>Mysql 8.0 之后，默认为 <code>true</code></li>
</ol>
<h4 id="2-serverTimezone"><a href="#2-serverTimezone" class="headerlink" title="2 serverTimezone"></a>2 serverTimezone</h4><ol>
<li><code>UTC</code><ul>
<li>世界标准时间，0 时区时间</li>
</ul>
</li>
<li><code>GMT+8</code> ，url 中写为 <code>GMT%2B8</code><ul>
<li>东八区时间，比 UTC 快 8 个小时</li>
</ul>
</li>
<li>如果不想时间有差异：接收的类型使用的时区和连接设置的时区要相同，因为不管数据库时区和连接时区是什么，从数据库获取的值是不变的，只是所代表的时区会改变<ol>
<li><code>timestamp dateTime localDateTime ...</code> 等类型使用的时区是本地系统时区，所以使用这些类型接收时，<code>serverTimezone</code> 要与本地系统时区一致</li>
<li><code>Instant</code> 是 UTC 时间，使用 <code>Instant</code> 接收时，<code>serverTimezone</code> 要设置为 UTC</li>
</ol>
</li>
</ol>
<h4 id="3-关于时区的例子"><a href="#3-关于时区的例子" class="headerlink" title="3 关于时区的例子"></a>3 关于时区的例子</h4><ol>
<li>数据库都设置为东八区时间 <code>00:00:00</code></li>
<li><code>serverTimezone=UTC</code>，从数据库获取的就是 UTC 时间 <code>00:00:00</code><ol>
<li><code>timestamp dateTime localDateTime ...</code> 这些类型接收会转换为东八区时间，也就是要+8，最终结果为 <code>08:00:00</code></li>
<li><code>Instant</code> 使用的是 UTC 时间，不用转换，最终结果为 <code>00:00:00</code></li>
</ol>
</li>
<li><code>serverTimezone=GMT%2B8</code>，从数据库获取的就是 东八区 时间 <code>00:00:00</code><ol>
<li>使用 <code>timestamp dateTime localDateTime ...</code> 接收不需要转换</li>
<li>使用 <code>Instant</code> 接收需要转为 UTC 时间，也就是要 - 8，最终结果是前一天的 <code>16:00:00</code></li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/09/29/Java/Java-%E6%97%A5%E5%BF%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/09/29/Java/Java-%E6%97%A5%E5%BF%97/" class="post-title-link" itemprop="url">Java-日志</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-09-29 16:04:53 / 修改时间：16:05:08" itemprop="dateCreated datePublished" datetime="2020-09-29T16:04:53+08:00">2020-09-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-概述"><a href="#一-概述" class="headerlink" title="一 概述"></a>一 概述</h1><ol>
<li><p>日志门面（接口）：</p>
<ol>
<li><code>JCL（jakarta commons logging）</code></li>
<li><code>slf4j（simple logging facade for java）</code> </li>
</ol>
</li>
<li><p>日志实现</p>
<ol>
<li><code>JUL（Java util Logging）</code></li>
<li><code>logback</code></li>
<li><code>log4j</code></li>
<li><code>log4j2</code></li>
</ol>
</li>
</ol>
<h1 id="二-日志门面"><a href="#二-日志门面" class="headerlink" title="二 日志门面"></a>二 日志门面</h1><h2 id="2-1-JCL"><a href="#2-1-JCL" class="headerlink" title="2.1 JCL"></a>2.1 <code>JCL</code></h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li><code>Jakarta Commons Logging</code></li>
<li>包： <code>commons-looging.jar</code></li>
<li>Apache 提供的一个通用日志接口，它是为 “所有的 Java 日志实现”提供一个统一的接口，它自身也提供一个日志的实现 <code>SimpleLog</code>，但是功能非常弱</li>
<li>通过动态查找的机制，在程序运行时自动找出真正使用的日志库，如果未提供任何第三方实现，则默认使用 <code>JUL</code></li>
</ol>
<h3 id="2-API"><a href="#2-API" class="headerlink" title="2 API"></a>2 API</h3><ol>
<li><code>Log</code>：日志记录器</li>
<li><code>LogFactory</code>：负责创建 <code>Log</code></li>
</ol>
<h2 id="2-2-slf4j"><a href="#2-2-slf4j" class="headerlink" title="2.2 slf4j"></a>2.2 <code>slf4j</code></h2><h3 id="1-概述-1"><a href="#1-概述-1" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li><p><code>Simple Logging Facade For Java</code></p>
</li>
<li><p>SLF4J 主要是为了给 Java 日志访问提供一套标准、规范的 API 框架，其主要意义在于提供接口，具体的实现可以交由其他日志框架</p>
</li>
<li><p>slf4j 内置一个简单的日志实现 <code>slf4j-simple</code> ，不过很少使用</p>
</li>
<li><p>通常 slf4j 作为门面，配上具体的实现框架，中接使用桥接器完成桥接</p>
</li>
<li><p>主要功能：</p>
<ol>
<li>日志框架的绑定</li>
<li>日志框架的桥接</li>
</ol>
</li>
<li><p><code>slf4j-api.jar</code> 核心 API 包</p>
</li>
<li><p>日志级别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="2-绑定日志实现"><a href="#2-绑定日志实现" class="headerlink" title="2 绑定日志实现"></a>2 绑定日志实现</h3><h4 id="1-步骤"><a href="#1-步骤" class="headerlink" title="1 步骤"></a>1 步骤</h4><ol>
<li>添加 slf4j 的依赖包 <code>slf4j-api.jar</code></li>
<li>绑定具体的日志实现框架<ol>
<li>已经实现 slf4j 的日志框架，如 <code>logback</code>，直接添加其依赖即可</li>
<li>没有实现 slf4j 的日志框架，如 <code>JUL log4j log4j2</code>，除了日志框架的依赖包外，还需要适配器（包）</li>
</ol>
</li>
<li>如果绑定了多个实现，默认使用第一个</li>
</ol>
<h4 id="2-包"><a href="#2-包" class="headerlink" title="2 包"></a>2 包</h4><h5 id="1-slf4j-JUL"><a href="#1-slf4j-JUL" class="headerlink" title="1 slf4j + JUL"></a>1 slf4j + JUL</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slf4j-api.jar</span><br><span class="line">slf4j-jdk14.jar</span><br></pre></td></tr></table></figure>

<h5 id="2-slf4j-log4j"><a href="#2-slf4j-log4j" class="headerlink" title="2 slf4j + log4j"></a>2 slf4j + log4j</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slf4j-api.jar</span><br><span class="line">log4j.jar</span><br><span class="line">slf4j-log4j12.jar</span><br></pre></td></tr></table></figure>

<h5 id="3-slf4j-log4j2"><a href="#3-slf4j-log4j2" class="headerlink" title="3 slf4j + log4j2"></a>3 slf4j + log4j2</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">slf4j-api.jar</span><br><span class="line">log4j-api.jar</span><br><span class="line">log4j-core.jar</span><br><span class="line">log4j-slf4j-impl.jar</span><br></pre></td></tr></table></figure>

<h5 id="4-slf4j-logback"><a href="#4-slf4j-logback" class="headerlink" title="4 slf4j + logback"></a>4 slf4j + logback</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">slf4j-api.jar</span><br><span class="line">logback-core.jar</span><br><span class="line">logback-classic.jar</span><br></pre></td></tr></table></figure>

<h3 id="3-桥接旧的日志框架"><a href="#3-桥接旧的日志框架" class="headerlink" title="3 桥接旧的日志框架"></a>3 桥接旧的日志框架</h3><h4 id="1-步骤-1"><a href="#1-步骤-1" class="headerlink" title="1 步骤"></a>1 步骤</h4><ol>
<li>去除旧的日志依赖</li>
<li>配置桥接器（包）</li>
<li>绑定新的日志实现</li>
</ol>
<h4 id="2-桥接器"><a href="#2-桥接器" class="headerlink" title="2 桥接器"></a>2 桥接器</h4><ol>
<li><code>jul-to-slf4j.jar</code><ul>
<li>将 JUL 的日志桥接到 slf4j ，即不再使用 JUL，而使用新的日志实现</li>
</ul>
</li>
<li><code>log4j-over-slf4j.jar</code><ul>
<li>将 log4j 的日志桥接到 slf4j</li>
</ul>
</li>
<li><code>jcl-over-slf4j.jar</code><ul>
<li>将 JCL 的日志桥接到 slf4j</li>
</ul>
</li>
</ol>
<h3 id="4-API"><a href="#4-API" class="headerlink" title="4 API"></a>4 API</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Logger LoggerFactory.getLogger(字节码文件)</span><br><span class="line">Logger LoggerFactory.getLogger(全限定类名)</span><br></pre></td></tr></table></figure>

<h1 id="三-日志实现"><a href="#三-日志实现" class="headerlink" title="三 日志实现"></a>三 日志实现</h1><h2 id="3-1-log4j2"><a href="#3-1-log4j2" class="headerlink" title="3.1 log4j2"></a>3.1 <code>log4j2</code></h2><h3 id="1-配置"><a href="#1-配置" class="headerlink" title="1 配置"></a>1 配置</h3><ul>
<li>默认加载类路径下 <code>log4j2.xml</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">	日志级别： </span></span><br><span class="line"><span class="comment">		OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL</span></span><br><span class="line"><span class="comment">    日期格式：</span></span><br><span class="line"><span class="comment">        %d 输出的时间</span></span><br><span class="line"><span class="comment">        %t 输出当前线程名称</span></span><br><span class="line"><span class="comment">        %F 输出所在的类文件名</span></span><br><span class="line"><span class="comment">        %L 输出行号</span></span><br><span class="line"><span class="comment">        %M 输出所在方法名</span></span><br><span class="line"><span class="comment">        %n 换行</span></span><br><span class="line"><span class="comment">        %-5level 输出日志级别，-5表示左对齐并且固定输出5个字符，如果不足在右边补0</span></span><br><span class="line"><span class="comment">        %logger 输出logger名称，Root Logger没有名称</span></span><br><span class="line"><span class="comment">        %l 输出语句所在的行数, 包括类名、方法名、文件名、行数</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">status：设置log4j2自身内部的信息输出，可以不设置</span></span><br><span class="line"><span class="comment">monitorInterval：指定每隔多久重新读取配置文件，可以不重启应用的情况下修改配置</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"30"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 1 定义属性--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 2 配置 appender--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 2.1 console--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--输出日志格式--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"[%d&#123;HH:mm:ss:SSS&#125;] [%p] - %l - %m%n"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 2.2 file--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">File</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">fileName</span>=<span class="string">"文件路径"</span> <span class="attr">append</span>=<span class="string">"是否追加"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--输出日志格式--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">File</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 2.3 rollingFile--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">fileName</span>=<span class="string">""</span> <span class="attr">filePattern</span>=<span class="string">"指定当发生Rolling时，文件的转移和重命名规则"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--输出日志格式--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 过滤器--&gt;</span>      </span><br><span class="line">			<span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">""</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 日志拆分规则--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">            	<span class="comment">&lt;!-- 系统启动就触发拆分规则，产生一个新的日志文件--&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">OnStartupTriggeringPolicy</span>/&gt;</span></span><br><span class="line">            	<span class="comment">&lt;!-- 按照时间节点拆分，根据 filePattern 的配置，如最小时间粒度是HH，则表示每小时产生一个新的日志文件--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">TimeBasedTriggeringPolicy</span>/&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 按照文件大小拆分，超过大小就产生一个新的--&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--同一目录最多保存的文件个数，超过则覆盖--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 3 logger 只有定义了logger并引入的appender，appender才会生效--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--3.1 root--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!--3.2 自定义 logger--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">level</span>=<span class="string">""</span> <span class="attr">additivity</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-异步日志"><a href="#2-异步日志" class="headerlink" title="2 异步日志"></a>2 异步日志</h3><h4 id="1-概述-2"><a href="#1-概述-2" class="headerlink" title="1 概述"></a>1 概述</h4><ol>
<li>异步日志需要添加依赖 <code>com.lmax.disruptor</code></li>
<li>有两种实现方式<ol>
<li><code>AsyncLogger</code>（官方推荐）：全局+混合</li>
<li><code>AsyncAppender</code></li>
</ol>
</li>
<li>注意三种方式不要同时使用</li>
</ol>
<h4 id="2-AsyncLogger"><a href="#2-AsyncLogger" class="headerlink" title="2 AsyncLogger"></a>2 <code>AsyncLogger</code></h4><h5 id="1-全局异步"><a href="#1-全局异步" class="headerlink" title="1 全局异步"></a>1 全局异步</h5><ol>
<li><p>所有的日志都异步的记录，在配置文件上不用做任何改动，只需要添加一个 <code>log4j2.component.properties</code> 配置</p>
</li>
<li><p><code>log4j2.component.properties</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Log4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="2-混合异步"><a href="#2-混合异步" class="headerlink" title="2 混合异步"></a>2 混合异步</h5><ol>
<li><p>同时使用同步日志和异步日志，通过配置指定哪些同步哪些异步</p>
</li>
<li><p>配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">		自定义异步 logger</span></span><br><span class="line"><span class="comment">		includeLocation：是否包含日志记录的行号信息，要关闭</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">AsyncLogger</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">level</span>=<span class="string">""</span> <span class="attr">includeLocation</span>=<span class="string">"false"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">AsyncLogger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-AsyncAppender"><a href="#3-AsyncAppender" class="headerlink" title="3 AsyncAppender"></a>3 <code>AsyncAppender</code></h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 定义异步 appender ，之后引入 logger 即可</span><br><span class="line"><span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Async</span> <span class="attr">name</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Async</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-logback"><a href="#3-2-logback" class="headerlink" title="3.2 logback"></a>3.2 <code>logback</code></h2><h3 id="1-模块"><a href="#1-模块" class="headerlink" title="1 模块"></a>1 模块</h3><ol>
<li><code>logback-core</code>：其它两个模块的基础模块</li>
<li><code>logback-classic</code>：它是 log4j 的一个改良版本，同时它完整实现了slf4j API</li>
<li><code>logback-access</code>：访问模块与 Servlet 容器集成提供通过 Http 来访问日志的功能</li>
</ol>
<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2 配置"></a>2 配置</h3><h4 id="1-依次读取"><a href="#1-依次读取" class="headerlink" title="1 依次读取"></a>1 依次读取</h4><ol>
<li><code>logback.groovy</code></li>
<li><code>logback-test.xml</code></li>
<li><code>logback.xml</code></li>
</ol>
<h4 id="2-详解"><a href="#2-详解" class="headerlink" title="2 详解"></a>2 详解</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 1 配置集中管理属性，获取value语法 $&#123;name&#125; --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">value</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 2 Appdender 配置 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 2.1 console --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--输出流对象 默认 System.out--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">target</span>&gt;</span><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--日志输出格式--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span>	</span><br><span class="line">	<span class="comment">&lt;!-- 2.2 file --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.FileAppender"</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">file</span>&gt;</span><span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--日志输出格式--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">    <span class="comment">&lt;!-- 2.3 htmlFile --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.FileAppender"</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">file</span>&gt;</span><span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--日志输出格式--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.encoder.LayoutWrappingEncoder"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.html.HTMLLayout"</span>&gt;</span></span><br><span class="line">    			<span class="tag">&lt;<span class="name">pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">	<span class="comment">&lt;!-- 2.4 rollingFile --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--日志输出路径--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">file</span>&gt;</span><span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--日志输出格式--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.encoder.PatternLayoutEncoder"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--指定日志文件拆分和压缩规则--&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!--按照时间和压缩格式声明拆分的文件名--&gt;</span></span><br><span class="line">   		 	<span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span><span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">    		<span class="comment">&lt;!--按照文件大小拆分--&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span><span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!--日志级别过滤器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">      		<span class="comment">&lt;!--过滤规则--&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">level</span>&gt;</span><span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">      		// 超过指定级别放行还是拦截</span><br><span class="line">      		<span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">      		// 低于指定级别放行还是拦截</span><br><span class="line">      		<span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 2.5 异步 async --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.AsyncAppender"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 3 root Logger 配置--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"默认debug"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"console"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!--4 自定义 logger --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"com.itheima"</span> <span class="attr">level</span>=<span class="string">"debug"</span> <span class="attr">additivity</span>=<span class="string">"是否继承rootLogger，默认true"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-JUL"><a href="#3-3-JUL" class="headerlink" title="3.3 JUL"></a>3.3 <code>JUL</code></h2><h3 id="1-概述-3"><a href="#1-概述-3" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li><code>Java util Logging</code></li>
<li>是 Java 原生的日志框架，使用时不需要另外引用第三方类库</li>
<li>配置文件：<code>$JAVA_HOME\conf\logging.properties</code></li>
<li>所在包：<code>java.util.logging</code> </li>
</ol>
<h3 id="2-架构"><a href="#2-架构" class="headerlink" title="2 架构"></a>2 架构</h3><table>
<thead>
<tr>
<th>对象</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Logger</code></td>
<td>日志记录器，程序通过此对象的 API 来发布日志，每个 <code>Logger</code> 可以关联多个 <code>Appender / Handler</code></td>
</tr>
<tr>
<td><code>Appender / Handler</code></td>
<td>日志处理器，决定日志记录的位置，如 控制台、文件…</td>
</tr>
<tr>
<td><code>Layout / Formatter</code></td>
<td>负责日志记录的数据转换和格式化</td>
</tr>
<tr>
<td><code>Level</code></td>
<td>日志级别</td>
</tr>
</tbody></table>
<h3 id="2-API-1"><a href="#2-API-1" class="headerlink" title="2 API"></a>2 API</h3><h4 id="1-Logger"><a href="#1-Logger" class="headerlink" title="1 Logger"></a>1 Logger</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Logger</code></td>
<td><code>getLogger(String name)</code></td>
<td>获取或创建 <code>Logger</code> 对象</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>log(Level, String msg)</code></td>
<td>输出指定级别的信息</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>info(String msg)</code></td>
<td>输出指定级别的信息，还有其它级别方法</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>addHandler(Handler handler)</code></td>
<td>关联 <code>Handler</code></td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setUseParentHandlers(Boolean useParentHandlers)</code></td>
<td>是否会输出到父 <code>Logger</code></td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setLevel(Level newLevel)</code></td>
<td>设置日志级别</td>
</tr>
</tbody></table>
<ol>
<li><code>Logger</code> 之间存在父子关系，根据名称会自动继承，如 <code>com.cn.an 和 com.cn 和 com</code></li>
<li>最顶层是一个 <code>RootLogger</code></li>
<li>子 <code>Logger</code> 输出会同时传递给父 <code>Logger</code> 输出</li>
</ol>
<h4 id="2-Lever"><a href="#2-Lever" class="headerlink" title="2 Lever"></a>2 Lever</h4><table>
<thead>
<tr>
<th>静态属性</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ALL</code></td>
<td>启用所有级别信息</td>
</tr>
<tr>
<td><code>OFF</code></td>
<td>关闭日志</td>
</tr>
<tr>
<td><code>SEVERE</code></td>
<td>错误</td>
</tr>
<tr>
<td><code>WARNING</code></td>
<td>警告</td>
</tr>
<tr>
<td><code>INFO</code>（默认）</td>
<td>信息</td>
</tr>
<tr>
<td><code>CONFIG</code></td>
<td>配置</td>
</tr>
<tr>
<td><code>FINE FINER FINEST</code></td>
<td>debug <code>详细 较详细 非常详细</code></td>
</tr>
</tbody></table>
<h4 id="3-Handler"><a href="#3-Handler" class="headerlink" title="3 Handler"></a>3 Handler</h4><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>void</code></td>
<td><code>setLevel(Level newLevel)</code></td>
<td>设置日志级别</td>
</tr>
<tr>
<td><code>void</code></td>
<td><code>setForMatter(Formater newFormatter)</code></td>
<td>关联  <code>Formatter</code></td>
</tr>
</tbody></table>
<h2 id="3-4-Log4j"><a href="#3-4-Log4j" class="headerlink" title="3.4 Log4j"></a>3.4 <code>Log4j</code></h2><h3 id="1-配置文件"><a href="#1-配置文件" class="headerlink" title="1 配置文件"></a>1 配置文件</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定日志级别和使用的输出端appender：console为自定义名称</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO,console</span></span><br><span class="line"><span class="comment"># 控制台输出配置</span></span><br><span class="line"><span class="meta">log4j.appender.console</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.console.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.console.layout.ConversionPattern</span>=<span class="string">%d [%t] %-5p [%c] - %m%n</span></span><br></pre></td></tr></table></figure>

<ol>
<li>名称：<code>log4j.properties</code></li>
<li>将配置文件放在类路径下，会自动读取</li>
</ol>
<h3 id="2-组件"><a href="#2-组件" class="headerlink" title="2 组件"></a>2 组件</h3><h4 id="1-Looger"><a href="#1-Looger" class="headerlink" title="1 Looger"></a>1 Looger</h4><ol>
<li>Log4j 有一个根 <code>Logger</code>：<code>root</code></li>
<li>其它所有的 <code>Logger</code> 都会直接或间接继承 <code>root</code></li>
</ol>
<h4 id="2-Appender"><a href="#2-Appender" class="headerlink" title="2 Appender"></a>2 Appender</h4><ol>
<li><code>ConsoleAppender</code></li>
<li><code>FileAppender</code></li>
<li><code>DailyRollingFileAppender</code></li>
<li><code>RollingFileAppender</code></li>
<li><code>JDBCAppender</code></li>
</ol>
<h4 id="3-Layout"><a href="#3-Layout" class="headerlink" title="3 Layout"></a>3 Layout</h4><ol>
<li><code>HTMLLayout</code></li>
<li><code>SimpleLayout</code></li>
<li><code>PatternLayout</code></li>
</ol>
<ul>
<li><h1 id="配置文件log4j2-xml"><a href="#配置文件log4j2-xml" class="headerlink" title="配置文件log4j2.xml"></a><strong>配置文件<code>log4j2.xml</code></strong></h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n"</span> /&gt;</span></span><br><span class="line">        	<span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">   	 <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span> /&gt;</span></span><br><span class="line">        	<span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>log4j2默认会在classpath目录下寻找log4j.json、log4j.jsn、log4j2.xml等名称的文件，如果都没有找到，则会按默认配置输出，也就是输出到控制台。</li>
<li><code>status</code><ul>
<li>表示log4j2本身的日志信息打印级别</li>
<li>用于设置log4j2自身内部的信息输出,可以不设置,当设置成trace时,会看到log4j2内部各种详细输出</li>
</ul>
</li>
<li><code>monitorInterval</code><ul>
<li>Log4j能够自动检测修改配置文件和重新配置本身, 设置间隔秒数。</li>
</ul>
</li>
<li><code>Appender</code><ul>
<li>定义日志的输出目的地</li>
<li><code>Console</code><ul>
<li>定义输出到控制台的Appender</li>
<li><code>name</code><ul>
<li>指定Appender的名字</li>
</ul>
</li>
<li><code>target</code><ul>
<li>SYSTEM_OUT 或 SYSTEM_ERR,一般只设置默认:SYSTEM_OUT.</li>
</ul>
</li>
<li><code>PatternLayout</code><ul>
<li>输出格式，不设置默认为:%m%n.</li>
</ul>
</li>
</ul>
</li>
<li><code>File</code><ul>
<li>定义输出到指定位置的文件的Appender</li>
<li><code>name</code><ul>
<li>指定Appender的名字</li>
</ul>
</li>
<li><code>fileName</code><ul>
<li>指定输出日志的目的文件带全路径的文件名</li>
</ul>
</li>
<li><code>PatternLayout</code><ul>
<li>输出格式，不设置默认为:%m%n.</li>
</ul>
</li>
</ul>
</li>
<li><code>RollingFile</code><ul>
<li>定义超过指定大小自动删除旧的创建新的的Appender.</li>
<li><code>name</code><ul>
<li>指定Appender的名字</li>
</ul>
</li>
<li><code>fileName</code><ul>
<li>指定输出日志的目的文件带全路径的文件名</li>
</ul>
</li>
<li><code>PatternLayout</code><ul>
<li>输出格式，不设置默认为:%m%n.</li>
</ul>
</li>
<li><code>filePattern</code><ul>
<li>指定新建日志文件的名称格式.</li>
</ul>
</li>
<li><code>Policies</code><ul>
<li>指定滚动日志的策略，就是什么时候进行新建日志文件输出日志</li>
<li><code>TimeBasedTriggeringPolicy</code><ul>
<li>基于时间的滚动策略</li>
<li><code>interval</code><ul>
<li>指定多久滚动一次，默认是1 hour</li>
</ul>
</li>
<li><code>modulate</code><ul>
<li>=true用来调整时间</li>
<li>比如现在是早上3am，interval是4，那么第一次滚动是在4am，接着是8am，12am…而不是7am</li>
</ul>
</li>
</ul>
</li>
<li><code>SizeBasedTriggeringPolicy</code><ul>
<li>基于指定文件大小的滚动策略</li>
<li><code>size</code><ul>
<li>定义每个日志文件的大小</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>DefaultRolloverStrategy</code><ul>
<li>指定同一个文件夹下最多有几个日志文件时开始删除最旧的，创建新的</li>
<li><code>max</code><ul>
<li>配置最多日志文件数</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>Loggers</code><ul>
<li><code>Root</code><ul>
<li>指定项目的根日志，如果没有单独指定Logger，那么就会默认使用该Root日志输出</li>
<li><code>level</code><ul>
<li>日志输出级别，共有8个级别，按照从低到高为：All &lt; Trace &lt; Debug &lt; Info &lt; Warn &lt; Error &lt; Fatal &lt; OFF</li>
</ul>
</li>
<li><code>AppenderRef</code><ul>
<li>指定该日志输出到哪个Appender</li>
</ul>
</li>
</ul>
</li>
<li><code>Logger</code><ul>
<li>单独指定日志的形式，比如要为指定包下的class指定不同的日志级别等</li>
<li><code>level</code></li>
<li><code>name</code><ul>
<li>指定该Logger所适用的类或者类所在的包全路径,继承自Root节点</li>
</ul>
</li>
<li><code>AppenderRef</code><ul>
<li>指定该日志输出到哪个Appender,如果没有指定，就会默认继承自Root.如果指定了，那么会在指定的这个Appender和Root的Appender中都会输出。<ul>
<li>若设置Logger的additivity=”false”只在自定义的Appender中进行输出。        </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://anyeansan.github.io/anyeansan.github.io/2020/09/29/Java/Java-%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/anyeansan.github.io/images/an3.png">
      <meta itemprop="name" content="安₃">
      <meta itemprop="description" content="一蓑烟雨任平生">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="安₃">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/anyeansan.github.io/2020/09/29/Java/Java-%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F/" class="post-title-link" itemprop="url">Java-时间日期</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">✦</span>
              

              <time title="创建时间：2020-09-29 16:04:17 / 修改时间：16:04:27" itemprop="dateCreated datePublished" datetime="2020-09-29T16:04:17+08:00">2020-09-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">☛</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/" itemprop="url" rel="index">
                    <span itemprop="name">CS</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/anyeansan.github.io/categories/CS/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一-JDK8-之前的日期时间"><a href="#一-JDK8-之前的日期时间" class="headerlink" title="一 JDK8 之前的日期时间"></a>一 JDK8 之前的日期时间</h1><h2 id="1-1-java-util-Date"><a href="#1-1-java-util-Date" class="headerlink" title="1.1 java.util.Date"></a>1.1 <code>java.util.Date</code></h2><h3 id="1-构造方法"><a href="#1-构造方法" class="headerlink" title="1 构造方法"></a>1 构造方法</h3><table>
<thead>
<tr>
<th>构造方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>Date()</code></td>
<td>当前时间，使用的是当前时间到 <code>1970-01-01 00:00:00</code> 的毫秒值创建</td>
</tr>
<tr>
<td><code>Date​(long date)</code></td>
<td>使用指定毫秒值</td>
</tr>
</tbody></table>
<h3 id="2-方法"><a href="#2-方法" class="headerlink" title="2 方法"></a>2 方法</h3><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>long getTime()</code></td>
<td>获取 <code>1970-01-01 00:00:00</code> 到此时间的毫秒值</td>
</tr>
</tbody></table>
<h2 id="1-2-java-util-Calendar"><a href="#1-2-java-util-Calendar" class="headerlink" title="1.2 java.util.Calendar"></a>1.2 <code>java.util.Calendar</code></h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><ol>
<li><code>Calendar</code> 类是一个抽象类，提供了很多关于日期时间计算的方法</li>
<li><code>GregorianCalendar</code>（公历）是 <code>Calendar</code> 的一个具体子类，提供了世界上大多数国家/地区使用的标准日历系统</li>
</ol>
<h3 id="2-方法-1"><a href="#2-方法-1" class="headerlink" title="2 方法"></a>2 方法</h3><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Calendar getInstance()</code></td>
<td>使用默认时区和语言环境获得一个日历</td>
</tr>
<tr>
<td><code>static Calendar getInstance​(TimeZone zone, Locale aLocale)</code></td>
<td>使用指定时区和语言环境获得一个日历</td>
</tr>
</tbody></table>
<h2 id="1-3-java-text-SimpleDateFormat"><a href="#1-3-java-text-SimpleDateFormat" class="headerlink" title="1.3 java.text.SimpleDateFormat"></a>1.3 <code>java.text.SimpleDateFormat</code></h2><table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>SimpleDateFormat​(String pattern)</code></td>
<td>指定格式创建对象</td>
</tr>
<tr>
<td><code>String format​(Date date)</code></td>
<td>日期 → 字符串</td>
</tr>
<tr>
<td><code>Date parse​(String source)</code></td>
<td>字符串 → 日期</td>
</tr>
</tbody></table>
<h1 id="二-JDK8-的日期时间"><a href="#二-JDK8-的日期时间" class="headerlink" title="二 JDK8 的日期时间"></a>二 JDK8 的日期时间</h1><table>
<thead>
<tr>
<th>包</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>java.time</code></td>
<td>基础包，使用标准的 <code>iso-8601</code> 历法（公历）</td>
</tr>
<tr>
<td><code>java.time.format</code></td>
<td>格式化和解析日期时间</td>
</tr>
<tr>
<td><code>java.time.temporal</code></td>
<td>包括底层框架和扩展特性</td>
</tr>
<tr>
<td><code>java.time.chrono</code></td>
<td>提供对不同的日历系统的访问</td>
</tr>
<tr>
<td><code>java.time.zone</code></td>
<td>包含支持不同时区以及相关规定的类</td>
</tr>
</tbody></table>
<h1 id="三-java-time-包"><a href="#三-java-time-包" class="headerlink" title="三 java.time 包"></a>三 <code>java.time</code> 包</h1><h2 id="3-1-概述"><a href="#3-1-概述" class="headerlink" title="3.1 概述"></a>3.1 概述</h2><table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>LocalDateTime</code></td>
<td>本地日期时间（不包含时区）</td>
</tr>
<tr>
<td><code>LocalDate</code></td>
<td>本地日期</td>
</tr>
<tr>
<td><code>LocalTime</code></td>
<td>本地时间</td>
</tr>
<tr>
<td><code>Instant</code></td>
<td>瞬时（时间戳），是 UTC 时间，没有时区概念</td>
</tr>
<tr>
<td><code>Period</code></td>
<td>日期间隔</td>
</tr>
<tr>
<td><code>Duration</code></td>
<td>时间间隔</td>
</tr>
<tr>
<td><code>ZoneOffset</code></td>
<td>时区偏移量</td>
</tr>
<tr>
<td><code>ZonedDateTime</code></td>
<td>指定时区的日期时间</td>
</tr>
<tr>
<td><code>ZoneId</code></td>
<td>包含了所有的时区信息，格式 <code>区域/城市</code></td>
</tr>
<tr>
<td><code>Clock</code></td>
<td>时钟</td>
</tr>
</tbody></table>
<h2 id="3-2-LocalDateTime-amp-LocalDate-amp-LocalTime"><a href="#3-2-LocalDateTime-amp-LocalDate-amp-LocalTime" class="headerlink" title="3.2 LocalDateTime &amp; LocalDate &amp; LocalTime"></a>3.2 <code>LocalDateTime &amp; LocalDate &amp; LocalTime</code></h2><h3 id="1-创建（now，of）"><a href="#1-创建（now，of）" class="headerlink" title="1 创建（now，of）"></a>1 创建（<code>now，of</code>）</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static LocalDateTime</code></td>
<td><code>now()</code></td>
<td>获取当前日期时间（默认时区）</td>
</tr>
<tr>
<td><code>static LocalDateTime</code></td>
<td><code>now​(ZoneId zone)</code></td>
<td>获取当前日期时间（指定时区）</td>
</tr>
<tr>
<td><code>static LocalDateTime</code></td>
<td><code>of(xxx)</code></td>
<td>获取指定日期时间（一系列重载）</td>
</tr>
</tbody></table>
<h3 id="2-获取（get）"><a href="#2-获取（get）" class="headerlink" title="2 获取（get）"></a>2 获取（<code>get</code>）</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>int</code></td>
<td><code>getYear()</code></td>
<td>获取年份</td>
</tr>
<tr>
<td><code>Month</code></td>
<td><code>getMonth()</code></td>
<td>获取月份（<code>Month</code> 是枚举类）</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getMonthValue()</code></td>
<td>获取一年中的第几个月 <code>1 ~ 12</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getDayOfYear()</code></td>
<td>获取一年中的第几天 <code>1 ~ 365/366</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getDayOfMonth()</code></td>
<td>获取一月中的第几天 <code>1 ~ 31</code></td>
</tr>
<tr>
<td><code>DayOfWeek</code></td>
<td><code>getDayOfWeek()</code></td>
<td>获取星期几（<code>DayOfWeek</code> 是枚举类）</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getHour()</code></td>
<td>获取时</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getMinute()</code></td>
<td>获取分</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getSecond()</code></td>
<td>获取秒</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getNano()</code></td>
<td>获取纳秒</td>
</tr>
</tbody></table>
<h3 id="3-格式化和解析（format，parse）"><a href="#3-格式化和解析（format，parse）" class="headerlink" title="3 格式化和解析（format，parse）"></a>3 格式化和解析（<code>format，parse</code>）</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>format​(DateTimeFormatter formatter)</code></td>
<td>日期时间转成指定格式的字符串</td>
</tr>
<tr>
<td><code>static LocalDateTime</code></td>
<td><code>parse​(CharSequence text)</code></td>
<td>解析默认格式字序列</td>
</tr>
<tr>
<td><code>static LocalDateTime</code></td>
<td><code>parse​(CharSequence text, DateTimeFormatter formatter)</code></td>
<td>解析指定格式字符序列</td>
</tr>
</tbody></table>
<h3 id="4-判断（is）"><a href="#4-判断（is）" class="headerlink" title="4 判断（is）"></a>4 判断（<code>is</code>）</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>boolean</code></td>
<td><code>isAfter​(ChronoLocalDate other)</code></td>
<td>是否在之后</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>isBefore(ChronoLocalDate other)</code></td>
<td>是否在之前</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>isEqual(ChronoLocalDate other)</code></td>
<td>是否相等</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td><code>isLeapYear()</code></td>
<td>是否是闰年</td>
</tr>
</tbody></table>
<h3 id="5-修改（with）"><a href="#5-修改（with）" class="headerlink" title="5 修改（with）"></a>5 修改（<code>with</code>）</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>LocalDateTime</code></td>
<td><code>with​(TemporalAdjuster adjuster)</code></td>
<td>将当前日期时间设置为校对器指定的日期时间</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withYear(int year)</code></td>
<td>修改年</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withMonth(int month)</code></td>
<td>修改月</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withDayOfYear(int dayOfYear)</code></td>
<td>修改年第几天</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withDayOfMonth(int dayOfMonth)</code></td>
<td>修改月第几天</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withHour(int hour)</code></td>
<td>修改时</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withMinute(int minute)</code></td>
<td>修改分</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>withSecond(int second)</code></td>
<td>修改秒</td>
</tr>
</tbody></table>
<h3 id="6-计算-plus，minus"><a href="#6-计算-plus，minus" class="headerlink" title="6 计算 plus，minus"></a>6 计算 <code>plus，minus</code></h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>LocalDateTime</code></td>
<td><code>minus(TemporalAmount amountToSubtract)</code></td>
<td>减去一个 <code>Duration</code> 或 <code>Period</code></td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plus(TemporalAmount amountToAdd)</code></td>
<td>添加一个 <code>Duration</code> 或 <code>Period</code></td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusYears(long years)</code></td>
<td>当前日期时间加指定年</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusMonths(long months)</code></td>
<td>当前日期时间加指定月</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusDays(long days)</code></td>
<td>当前日期时间加指定日</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusWeeks(long weeks)</code></td>
<td>当前日期时间加指定周</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusHours(long hours)</code></td>
<td>当前日期时间加指定时</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusMinutes(long minutes)</code></td>
<td>当前日期时间加指定分</td>
</tr>
<tr>
<td><code>LocalDateTime</code></td>
<td><code>plusSeconds(long seconds)</code></td>
<td>当前日期时间加指定秒</td>
</tr>
</tbody></table>
<h3 id="7-转换（to）"><a href="#7-转换（to）" class="headerlink" title="7 转换（to）"></a>7 转换（<code>to</code>）</h3><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>String</code></td>
<td><code>toString()</code></td>
<td>获取字符串</td>
</tr>
<tr>
<td><code>LocalDate</code></td>
<td><code>toLocalDate()</code></td>
<td>获取日期</td>
</tr>
<tr>
<td><code>LocalTime</code></td>
<td><code>toLocalTime()</code></td>
<td>获取时间</td>
</tr>
</tbody></table>
<h2 id="3-3-Instant"><a href="#3-3-Instant" class="headerlink" title="3.3 Instant"></a>3.3 <code>Instant</code></h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Instant</code></td>
<td><code>now()</code></td>
<td>获取当前UTC时间的时间戳</td>
</tr>
<tr>
<td><code>static Instant</code></td>
<td><code>ofEpochMilli​(long epochMilli)</code></td>
<td>获取指定毫秒值距元时间的时间戳</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toEpochMilli()</code></td>
<td>获取距元时间的毫秒数</td>
</tr>
<tr>
<td><code>OffsetDateTime</code></td>
<td><code>atOffset​(ZoneOffset offset)</code></td>
<td>结合时区偏移创建 <code>OffsetDateTime</code></td>
</tr>
</tbody></table>
<h2 id="3-4-Period"><a href="#3-4-Period" class="headerlink" title="3.4 Period"></a>3.4 <code>Period</code></h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Period</code></td>
<td><code>between​(LocalDate startDateInclusive, LocalDate endDateExclusive)</code></td>
<td>获取两个日期的间隔对象  <code>Period</code></td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getYears()</code></td>
<td>相隔年份</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getMonths()</code></td>
<td>相隔月份（只比较月字段）</td>
</tr>
<tr>
<td><code>int</code></td>
<td><code>getDays()</code></td>
<td>相隔天数（只比较日字段）</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toTotalMonths()</code></td>
<td>相隔总月份</td>
</tr>
</tbody></table>
<h2 id="3-5-Duration"><a href="#3-5-Duration" class="headerlink" title="3.5 Duration"></a>3.5 <code>Duration</code></h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Duration</code></td>
<td><code>between​(Temporal startInclusive, Temporal endExclusive)</code></td>
<td>获取两个时间的间隔对象  <code>Duration</code></td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toDays()</code></td>
<td>相隔总天数</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toHours()</code></td>
<td>相隔总小时数</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toMinutes()</code></td>
<td>相隔总分钟数</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toSeconds()</code></td>
<td>相隔总秒数</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toMillis()</code></td>
<td>相隔总毫秒数</td>
</tr>
<tr>
<td><code>long</code></td>
<td><code>toNanos()</code></td>
<td>相隔总纳秒数</td>
</tr>
</tbody></table>
<h2 id="3-6-ZoneId"><a href="#3-6-ZoneId" class="headerlink" title="3.6 ZoneId"></a>3.6 <code>ZoneId</code></h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static Set&lt;String&gt;</code></td>
<td><code>getAvailableZoneIds()</code></td>
<td>获取所有时区ID，格式<code>区域/城市</code></td>
</tr>
<tr>
<td><code>static ZoneId</code></td>
<td><code>systemDefault()</code></td>
<td>获取系统默认时区</td>
</tr>
<tr>
<td><code>static ZoneId</code></td>
<td><code>of​(String zoneId)</code></td>
<td>根据时区ID获取时区</td>
</tr>
</tbody></table>
<h1 id="四-DateTimeFormatter"><a href="#四-DateTimeFormatter" class="headerlink" title="四 DateTimeFormatter"></a>四 <code>DateTimeFormatter</code></h1><h2 id="4-1-预定义标准格式"><a href="#4-1-预定义标准格式" class="headerlink" title="4.1 预定义标准格式"></a>4.1 预定义标准格式</h2><table>
<thead>
<tr>
<th>字段</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>ISO_LOCAL_DATE_TIME</code></td>
<td><code>YYYY-MM-DD HH:MM:SS</code></td>
</tr>
<tr>
<td><code>ISO_LOCAL_DATE</code></td>
<td><code>YYYY-MM-DD</code></td>
</tr>
<tr>
<td><code>ISO_LOCAL_TIME</code></td>
<td><code>HH:MM:SS</code></td>
</tr>
<tr>
<td><code>...</code></td>
<td><code>...</code></td>
</tr>
</tbody></table>
<h2 id="4-2-本地化相关格式"><a href="#4-2-本地化相关格式" class="headerlink" title="4.2 本地化相关格式"></a>4.2 本地化相关格式</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static DateTimeFormatter</code></td>
<td><code>ofLocalizedDateTime​(FormatStyle dateTimeStyle)</code></td>
<td><code>FormatStyle</code> 是枚举类，其中 <code>FULL，LONG</code>适用于 <code>DateTime</code></td>
</tr>
<tr>
<td><code>static DateTimeFormatter</code></td>
<td><code>ofLocalizedDate​(FormatStyle dateStyle)</code></td>
<td><code>MEDIUM，SHORT</code> 适用于 <code>Date</code></td>
</tr>
<tr>
<td><code>static DateTimeFormatter</code></td>
<td><code>ofLocalizedTime​(FormatStyle timeStyle)</code></td>
<td><code>MEDIUM，SHORT</code> 适用于 <code>Time</code></td>
</tr>
</tbody></table>
<h2 id="4-3-自定义格式"><a href="#4-3-自定义格式" class="headerlink" title="4.3 自定义格式"></a>4.3 自定义格式</h2><table>
<thead>
<tr>
<th>修饰</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>static DateTimeFormatter</code></td>
<td><code>ofPattern​(String pattern)</code></td>
<td>使用自定义格式和默认地区</td>
</tr>
<tr>
<td><code>static DateTimeFormatter</code></td>
<td><code>ofPattern​(String pattern, Locale locale)</code></td>
<td>使用自定义格式和指定地区</td>
</tr>
</tbody></table>
<h1 id="五-TemporalAdjusters"><a href="#五-TemporalAdjusters" class="headerlink" title="五 TemporalAdjusters"></a>五 <code>TemporalAdjusters</code></h1><h2 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h2><ol>
<li>时间校正器工具类</li>
<li>获取时间校正器对象，之后可以通过日期时间对象的 <code>with</code> 方法来调整</li>
</ol>
<h2 id="5-2-API"><a href="#5-2-API" class="headerlink" title="5.2 API"></a>5.2 API</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> TemporalAdjuster <span class="title">firstXxx</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> TemporalAdjuster <span class="title">lastXxx</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> TemporalAdjuster <span class="title">nextXxx</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> TemporalAdjuster <span class="title">previousXxx</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<h1 id="六-新旧日期时间的转换"><a href="#六-新旧日期时间的转换" class="headerlink" title="六 新旧日期时间的转换"></a>六 新旧日期时间的转换</h1><table>
<thead>
<tr>
<th>旧类</th>
<th>新类</th>
<th>旧 → 新</th>
<th>新 → 旧</th>
</tr>
</thead>
<tbody><tr>
<td><code>java.util.Date</code></td>
<td><code>java.time.Instant</code></td>
<td><code>date.toInstant()</code></td>
<td><code>Date.from(instant)</code></td>
</tr>
<tr>
<td><code>java.sql.Timestamp</code></td>
<td><code>java.time.Instant</code></td>
<td><code>timestamp.toInstant()</code></td>
<td><code>Timestamp.from(instant)</code></td>
</tr>
<tr>
<td><code>java.sql.Timestamp</code></td>
<td><code>java.time.LocalDateTime</code></td>
<td><code>timestamp.toLocalDateTime()</code></td>
<td><code>Timestamp.valueOf(localDateTIme)</code></td>
</tr>
<tr>
<td><code>java.sql.Date</code></td>
<td><code>java.time.LocalDate</code></td>
<td><code>date.toLocalDate()</code></td>
<td><code>Date.valueOf(LocalDate)</code></td>
</tr>
<tr>
<td><code>java.sql.Time</code></td>
<td><code>java.time.LocalTime</code></td>
<td><code>time.toLocalTime()</code></td>
<td><code>TIme.valueOf(LocalTime)</code></td>
</tr>
</tbody></table>
<ol>
<li>旧转为新 <code>to</code></li>
<li>新转为旧 <code>from，valueOf</code></li>
</ol>

      
    </div>

    
    
    

    <div>
      
    </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/anyeansan.github.io/page/5/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/anyeansan.github.io/">1</a><span class="space">&hellip;</span><a class="page-number" href="/anyeansan.github.io/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/anyeansan.github.io/page/7/">7</a><a class="page-number" href="/anyeansan.github.io/page/8/">8</a><a class="extend next" rel="next" href="/anyeansan.github.io/page/7/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          秘笈
        </li>
        <li class="sidebar-nav-overview">
          安₃
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="安₃"
      src="/anyeansan.github.io/images/an3.png">
  <p class="site-author-name" itemprop="name">安₃</p>
  <div class="site-description" itemprop="description">一蓑烟雨任平生</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/anyeansan.github.io/archives/">
        
          <span class="site-state-item-count">71</span>
          <span class="site-state-item-name">琅嬛福地</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/anyeansan.github.io/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">门派</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/anyeansan.github.io/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-star-half-full"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">安₃</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/anyeansan.github.io/lib/anime.min.js"></script>
  <script src="/anyeansan.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/anyeansan.github.io/lib/velocity/velocity.ui.min.js"></script>
<script src="/anyeansan.github.io/js/utils.js"></script><script src="/anyeansan.github.io/js/motion.js"></script>
<script src="/anyeansan.github.io/js/schemes/pisces.js"></script>
<script src="/anyeansan.github.io/js/next-boot.js"></script>



  




  <script src="/anyeansan.github.io/js/local-search.js"></script>













  

  

</body>
</html>
